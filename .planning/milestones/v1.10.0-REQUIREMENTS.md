# Milestone v1.10.0: Installation CLI Optimization - Requirements

**Status:** Planning
**Version:** v1.10.0
**Type:** Breaking Change (hard removal of old flags)

## Overview

Redesign the installation command-line interface to support multi-platform selection with intuitive flags and interactive menus. **BREAKING CHANGE:** Remove old `--local`/`--global` flags entirely (no backward compatibility).

## Requirements by Category

### FLAG: Platform-Specific Flag System

**FLAG-01**: Platform selection flags
- `--claude` flag selects Claude Code platform
- `--copilot` flag selects GitHub Copilot CLI platform
- `--codex` flag selects Codex CLI platform
- `--all` flag selects all three platforms
- Multiple flags can be combined: `--claude --copilot`
- Priority: P0

**FLAG-02**: Scope modifier flags
- `--global` (or `-g`) installs to global directory
- `--local` (or `-l`) installs to local directory (default)
- Scope modifiers combine with platform flags: `--claude --global`
- Default behavior is local if no scope specified
- Priority: P0

**FLAG-03**: Platform-specific scope validation
- Claude: Supports both `--global` and `--local`
- Copilot: Supports both `--global` and `--local`
- Codex: Only supports `--local` (global shows warning)
- `--codex --global` shows warning: "Global installation not supported for Codex. Installing locally in current folder."
- Priority: P0

**FLAG-04**: Bulk installation with `--all`
- `--all` alone installs all platforms locally
- `--all --global` installs Claude and Copilot globally, Codex locally (with warning)
- Priority: P0

**FLAG-05**: HARD REMOVAL of old flags
- Remove `--local` flag completely (no backward compatibility)
- Remove `--global` flag completely (no backward compatibility)
- Remove `--codex-global` flag completely (no backward compatibility)
- Show clear error if old flags detected
- Error message includes migration instructions with link
- Priority: P0

**FLAG-06**: Error handling for removed flags
- Detect usage of removed flags: `--local`, `--global`, `--codex-global`
- Show clear error message: "The flag '{flag}' has been removed in v1.10.0."
- Include example of new syntax: "Use '--claude --local' instead of '--local'"
- Provide link to migration guide: "See MIGRATION.md for full migration details"
- Exit with non-zero code
- **Important**: Use language that clearly indicates removal (NOT "deprecated" or "will be removed") - the change is effective NOW
- Priority: P0

### PATH: Platform Installation Paths

**PATH-01**: Claude platform paths
- Local: `[repo-root]/.claude/`
- Global: `~/.claude/`
- **Breaking change**: Replace current macOS path `~/Library/Application Support/Claude` with `~/.claude/`
- **Implementation approach**: Clean break - act as if old path never existed, no migration documentation
- Priority: P0

**PATH-02**: Copilot platform paths
- Local: `[repo-root]/.github/`
- Global: `~/.copilot/`
- Priority: P0

**PATH-03**: Codex platform paths
- Local: `[repo-root]/.codex/` (only mode)
- Global: NOT SUPPORTED (show warning if requested)
- Priority: P0

### MENU: Interactive Menu System

**MENU-01**: Interactive mode activation
- No command-line flags triggers interactive menu
- Menu uses checkbox multi-selection UI
- Priority: P0

**MENU-02**: Platform selection in menu
- Checkbox options: Claude, Copilot, Codex, All
- Multi-select enabled (can choose multiple)
- Default: None selected
- Priority: P0

**MENU-03**: Scope selection in menu
- Radio button options: Local, Global
- Single selection only
- Default: Local
- Shown after platform selection
- Priority: P0

**MENU-04**: Non-TTY environment handling
- Detect non-interactive environment (CI/CD, Docker, scripts)
- Error and exit with code 1 (not auto-proceed with defaults)
- Show message: "Interactive menu requires TTY. Use explicit flags for non-interactive environments."
- Rationale: Forces explicit flags in CI/CD, prevents silent failures
- Priority: P0

### MSG: Message Optimization

**MSG-01**: Clean output principle
- Only show messages that are necessary/relevant
- Remove generic platform notes (e.g., "Note: Linux: XDG Base Directory support...")
- Context-aware message display
- Priority: P0

**MSG-02**: Codex global warning
- When `--codex --global` detected
- Show: "⚠️  Global installation not supported for Codex. Installing locally in current folder."
- Continue with local installation
- Priority: P0

**MSG-03**: Installation confirmation messages
- Show clear success/failure for each platform
- Use Unicode symbols consistently: ✓ (success), ✗ (error), ⠿ (progress)
- Format: "✓ Claude Code installed to ~/.claude/"
- Priority: P0

### DEPS: Dependency Management

**DEPS-01**: Add Commander.js
- Install Commander.js v14+ for argument parsing
- Add to package.json dependencies
- Priority: P0

**DEPS-02**: Add Prompts library
- Install Prompts v2.4+ for interactive menus
- Add to package.json dependencies
- Priority: P0

### UNINST: Uninstall Implementation

**UNINST-01**: Uninstall flag system
- Implement same flag system as install.js
- Support `--claude`, `--copilot`, `--codex`, `--all`
- Support `--global` and `--local` modifiers
- Priority: P0

**UNINST-02**: Uninstall validation
- Verify platform exists before uninstall
- Show clear error if platform not installed
- Prompt confirmation for `--all` flag
- Priority: P0

**UNINST-03**: Uninstall consistency
- Apply same error handling as install.js
- Use same message optimization principles
- Handle removed flags with same error messages
- Priority: P0

### DOCS: Documentation & Migration

**DOCS-01**: README updates
- Update installation section with new flag syntax
- Add examples for common use cases
- Document all platform flags
- Document interactive menu
- Priority: P0

**DOCS-02**: Migration guide
- Create simple MIGRATION.md in repo root
- Focus ONLY on `--local`/`--global` → platform flags transition (no other topics)
- Provide clear before/after examples
- Keep it as simple as possible - one-page reference
- No complex scenarios, no edge cases, no advanced usage
- **Goal**: User can glance and immediately know new syntax
- Priority: P0

**DOCS-03**: CHANGELOG with two sections
- Section 1: "End Users" (who use install.js output)
- Section 2: "Contributors" (who maintain the project)
- Document breaking changes clearly
- Include migration examples
- Priority: P0

**DOCS-04**: Installation documentation
- Update any installation guides or tutorials
- Add examples for multi-platform installation
- Document interactive menu workflow
- Priority: P0

### TEST: Testing Requirements

**TEST-01**: Flag parsing tests
- Unit tests for all flag combinations
- Test platform flag validation
- Test scope modifier validation
- Test error handling for removed flags
- Coverage target: >80%
- Priority: P0

**TEST-02**: Interactive menu tests
- Test platform selection logic
- Test scope selection logic
- Test non-TTY fallback behavior
- Mock Prompts library
- Priority: P0

**TEST-03**: Installation workflow tests
- Integration tests for each platform
- Test multi-platform installation
- Test `--all` flag with global/local
- Verify correct paths for each platform
- Priority: P0

**TEST-04**: Uninstall workflow tests
- Integration tests for uninstall operations
- Test flag consistency with install
- Test validation and error handling
- Priority: P0

## Priority Definitions

- **P0**: Must-have for v1.10.0 launch (blocking)
- **P1**: Nice-to-have, defer to v1.10.1 if time constrained
- **P2**: Future enhancement, v1.10.2+

## Out of Scope for v1.10.0

The following are explicitly NOT included in this milestone:

- **Soft deprecation warnings**: No backward compatibility, hard removal only
- **Windows testing**: Defer to v1.10.1 (focus macOS/Linux)
- **Verbose mode**: `--verbose` flag deferred to v1.10.1
- **Help message enhancements**: Commander.js defaults sufficient for v1.10.0
- **Performance optimization**: No benchmarking required for v1.10.0

## Scope Changes from Original Research

The following adjustments were made from the original research summary:

1. **Codex global support**: NOT implemented (show warning only)
2. **Backward compatibility**: NONE (hard removal, not soft deprecation)
3. **Migration guide**: Simplified (basic flag transition only)
4. **Uninstall**: NOW P0 (was considered for deferral)
5. **Version**: Keeping v1.10.0 despite breaking change
6. **CHANGELOG**: Two distinct sections required

## Success Metrics

Milestone is complete when:

- ✅ All P0 requirements implemented and tested
- ✅ Platform flags work for all 3 platforms
- ✅ Interactive menu with multi-select functional
- ✅ Old flags removed, clear errors shown
- ✅ Codex global shows warning, installs locally
- ✅ Clean output (no noise)
- ✅ uninstall.js fully implemented
- ✅ Documentation complete (README, MIGRATION.md, CHANGELOG.md)
- ✅ Tests passing (>80% coverage)
- ✅ Manual QA completed on macOS + Linux

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| FLAG-01 | Phase 2 | Complete |
| FLAG-02 | Phase 2 | Complete |
| FLAG-03 | Phase 2 | Complete |
| FLAG-04 | Phase 2 | Complete |
| FLAG-05 | Phase 2 | Complete |
| FLAG-06 | Phase 2 | Complete |
| PATH-01 | Phase 4 | Complete |
| PATH-02 | Phase 4 | Complete |
| PATH-03 | Phase 4 | Complete |
| MENU-01 | Phase 3 | Complete |
| MENU-02 | Phase 3 | Complete |
| MENU-03 | Phase 3 | Complete |
| MENU-04 | Phase 3 | Pending |
| MSG-01 | Phase 5 | Complete |
| MSG-02 | Phase 2 | Complete |
| MSG-03 | Phase 5 | Complete |
| DEPS-01 | Phase 1 | Complete |
| DEPS-02 | Phase 1 | Complete |
| UNINST-01 | Phase 6 | Pending |
| UNINST-02 | Phase 6 | Pending |
| UNINST-03 | Phase 6 | Pending |
| DOCS-01 | Phase 8 | Pending |
| DOCS-02 | Phase 8 | Pending |
| DOCS-03 | Phase 8 | Pending |
| DOCS-04 | Phase 8 | Pending |
| TEST-01 | Phase 7 | Pending |
| TEST-02 | Phase 7 | Pending |
| TEST-03 | Phase 7 | Pending |
| TEST-04 | Phase 7 | Pending |

---

*Requirements extracted from: .planning/research/v1.10.0/BRIEF.md (Updated 2026-01-24)*
