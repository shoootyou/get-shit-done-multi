# Milestone v1.10.0: Installation CLI Optimization

**Status:** In Progress
**Phases:** 15 (8 original + 7 inserted)
**Total Requirements:** 29 P0 + 15 new (Architecture Optimization) + 17 new (Function-level Audit)
**Breaking Changes:** Yes (hard removal of old flags)

## Overview

This milestone redesigns the installation CLI from implicit platform assumptions (`--local` = Claude) to explicit platform selection (`--claude --local`) with flexible scope modifiers. The redesign enables multi-platform installation in a single command and provides an intuitive interactive menu. **This is a breaking change** â€” old flags (`--local`, `--global`, `--codex-global`) are completely removed with clear migration errors.

Key deliverables: Commander.js-based flag system, Prompts-based interactive menu, full uninstall.js implementation, platform path clarification (Codex local only), and comprehensive documentation with simple migration guide.

## Phases

### Phase 1: Dependency Setup
**Goal**: Development environment has modern CLI libraries installed and verified compatible
**Depends on**: Nothing (first phase)
**Requirements**: DEPS-01, DEPS-02
**Timeline**: 1 day
**Plans**: 1 plan

**Plans:**
- [x] 01-01-PLAN.md â€” Install Commander.js v14+ and verify both CLI libraries

**Success Criteria:**
1. Commander.js v14+ installed and importable in install.js
2. Prompts v2.4+ installed and importable in install.js
3. No dependency conflicts in package.json
4. Basic import test passes (verify libraries load)

**Why this first**: Foundation for all subsequent phases. Commander.js and Prompts are zero-config libraries that need no integration work beyond installation.

---

### Phase 2: Flag System Redesign
**Goal**: Users can select platforms explicitly via flags with scope modifiers, and receive clear errors if old flags are used
**Depends on**: Phase 1
**Requirements**: FLAG-01, FLAG-02, FLAG-03, FLAG-04, FLAG-05, FLAG-06
**Timeline**: 3-4 days
**Plans**: 3 plans

**Plans:**
- [x] 02-01-PLAN.md â€” Core flag parsing infrastructure (three-stage architecture)
- [x] 02-02-PLAN.md â€” Codex global warning & edge cases
- [x] 02-03-PLAN.md â€” Flag system test suite

**Success Criteria:**
1. Platform flags work: `--claude`, `--copilot`, `--codex` install correct platforms
2. Scope flags work: `--global`, `--local` modify installation path correctly
3. Multi-platform works: `--claude --copilot` installs both platforms
4. Bulk installation works: `--all` installs all platforms, `--all --global` handles Codex warning
5. Old flags rejected: `--local`, `--global`, `--codex-global` show clear "removed" error (not "deprecated") with migration guide link
6. Codex global warning shown when `--codex --global` used, installs locally

**Technical approach:**
- Implement Commander.js program with `.option()` for each flag
- Define platform options: `--claude`, `--copilot`, `--codex`, `--all`
- Define scope options: `--global/-g`, `--local/-l`
- Add validation logic for invalid combinations (e.g., multiple scopes)
- Detect old flag patterns and show migration error
- Extract routing logic to separate module (replace 100+ line if/else)

---

### Phase 3: Interactive Menu Implementation
**Goal**: Users without flags enter intuitive multi-select menu for platform and scope choice
**Depends on**: Phase 2
**Requirements**: MENU-01, MENU-02, MENU-03, MENU-04
**Timeline**: 2-3 days
**Plans**: 1 plan

Plans:
- [ ] 03-01-PLAN.md â€” Interactive menu with Prompts (multiselect platforms, radio scope, TTY detection)

**Success Criteria:**
1. No flags triggers interactive menu automatically
2. Platform selection uses checkbox (multi-select) for Claude, Copilot, Codex, All
3. Scope selection uses radio (single select) for Local/Global, defaults to Local
4. Non-TTY environment detected, shows error and exits (not auto-proceed)
5. Menu integrates with Phase 2 routing (produces same result as flags)

**Technical approach:**
- Use Prompts library for UI
- First prompt: `type: 'multiselect'` for platforms
- Second prompt: `type: 'select'` for scope
- Detect TTY with `process.stdin.isTTY`
- Transform menu selections into flag-equivalent structure
- Route through same logic as flag-based installation

---

### Phase 4: Platform Path Implementation
**Goal**: Each platform installs to correct local and global directories per updated specification
**Depends on**: Phase 2
**Requirements**: PATH-01, PATH-02, PATH-03
**Timeline**: 2-3 days
**Plans**: 2 plans

Plans:
- [x] 04-01-PLAN.md â€” Path resolution & validation (cross-platform support)
- [x] 04-02-PLAN.md â€” Conflict resolution & installation integration

**Success Criteria:**
1. Claude local installs to `[repo-root]/.claude/`
2. Claude global installs to `~/.claude/`
3. Copilot local installs to `[repo-root]/.github/`
4. Copilot global installs to `~/.copilot/`
5. Codex local installs to `[repo-root]/.codex/`
6. Codex global shows warning and installs locally (no global support)

**Technical approach:**
- Update `bin/lib/paths.js` with correct path mappings
- **Claude global path**: Replace `~/Library/Application Support/Claude` with `~/.claude/` (clean break, no migration)
- Verify Claude adapter uses `.claude/` for local (not legacy paths)
- Verify Copilot adapter uses `~/.copilot/` for global (not hardcoded local-only)
- Add Codex global warning in routing logic
- Test path resolution on macOS and Linux
- Update platform adapters if path logic needs changes
- Remove all references to old Claude paths from codebase

---

### Phase 5: Message Optimization
**Goal**: Installation output is clean, context-aware, and shows only necessary information
**Depends on**: Phase 4
**Requirements**: MSG-01, MSG-02, MSG-03
**Timeline**: 2 days
**Plans**: 2 plans

Plans:
- [x] 05-01-PLAN.md â€” Reporter infrastructure with boxen integration
- [x] 05-02-PLAN.md â€” Integration into install.js and message optimization

**Success Criteria:**
1. Generic platform notes removed (e.g., "Linux XDG Base Directory support...")
2. Only relevant messages shown based on platform/OS/scope
3. Codex global warning displays when `--codex --global` used
4. Success messages use consistent Unicode: âœ“ (success), âœ— (error), â ¿ (progress)
5. Output format: "âœ“ Claude Code installed to ~/.claude/"

**Technical approach:**
- Build message manager module with context-aware logic
- Remove hardcoded verbose messages from install.js
- Add conditional message display based on:
  - Platform being installed (Claude, Copilot, Codex)
  - Scope (global vs local)
  - Operating system (macOS, Linux, Windows)
- Standardize Unicode symbols across all messages
- Extract message templates to separate file

---

### Phase 5.1: Codebase Architecture Optimization (INSERTED)
**Goal**: Restructure `bin/` and `lib-ghcc/` following SOLID principles, eliminate low-value files, and modernize dependencies **BEFORE** implementing new features
**Depends on**: Phase 5
**Requirements**: ARCH-OPT-01 to ARCH-OPT-08
**Timeline**: 4-5 days
**Status**: âœ… COMPLETE (2026-01-25)
**Plans**: 5 plans (all complete)

Plans:
- [x] 01-01-PLAN.md â€” Codebase audit & dependency analysis âœ…
- [x] 02-01-PLAN.md â€” Foundation & cleanup âœ…
- [x] 02-02-PLAN.md â€” Domain migration âœ…
- [x] 02-03-PLAN.md â€” Test unification & verification âœ…
- [x] 03-01-PLAN.md â€” Dependency modernization & documentation âœ…

**Success Criteria:**
1. `bin/` and `lib-ghcc/` restructured with clear organization by tool/scope/phase
2. All files evaluated for value - low-value files removed with references cleaned
3. `install.js` remains central execution point, processes in separate organized modules
4. `doc-generator` moved to `/bin/lib` following new structure
5. Test structure unified - single convention (`__tests__/` OR `bin/` tests, not both)
6. `coverage/` directory evaluated and cleaned (removed or added to `.gitignore` if no value)
7. All library dependencies updated to latest compatible versions (with justification for any that can't be updated)
8. Detailed report generated documenting all changes, removals, and library updates
9. All existing functionality works - no regressions from restructuring
10. Code follows SOLID principles and best practices

**Technical approach:**
- **Phase 1: Audit & Planning**
  - Analyze every file in `bin/` and `lib-ghcc/`
  - Categorize by: tool (install/uninstall), scope (paths/flags/messages), phase (detection/migration/generation)
  - Identify files with no value for elimination
  - Design target structure following SOLID principles

- **Phase 2: Restructuring**
  - Move files to new organized structure under `/bin/lib`
  - Update all imports and references
  - Consolidate duplicated logic
  - Move `doc-generator` to `/bin/lib`
  
- **Phase 3: Test Unification**
  - Decide on single test convention
  - Move all tests to chosen location
  - Update test configurations
  - Clean up `coverage/` directory

- **Phase 4: Dependency Modernization**
  - Audit all dependencies in `package.json`
  - Update to latest compatible versions
  - Document any dependencies that cannot be updated with justification
  - Run full test suite after each update

- **Phase 5: Documentation**
  - Create detailed report of all changes
  - Document new structure and organization principles
  - List all removed files with justification
  - Document library updates and version decisions

**Architecture principles:**
- Keep `install.js` as central orchestrator
- Organize by function: `/bin/lib/paths/`, `/bin/lib/flags/`, `/bin/lib/platforms/`
- Follow single responsibility principle
- Minimize files in root `/bin` directory
- Clear naming conventions

**Future integration preparation:**
- Structure must accommodate GPT-4All, Mistral, Gemini integrations
- Platform adapters should be easily extensible
- Path resolution should support new AI tools without major refactoring

**Testing requirements:**
- All tests execute in `/tmp` temporary directories
- Test all current parameter combinations
- Validate no regressions after restructuring
- Run `node bin/install.js` with all flag combinations in `/tmp`

**Deliverable: Detailed Report**
Must include:
- Before/after directory structure comparison
- List of files removed with justification
- List of files moved/renamed with mapping
- Library updates table (old version â†’ new version, reason)
- Any libraries NOT updated with detailed justification
- Test results showing no regressions
- Architecture diagram of new structure

---

### Phase 5.2: Function-level Inventory of `bin/**` (Stage 1) (INSERTED)
**Goal**: Create comprehensive function-by-function inventory and analysis of entire `bin/**` folder with mandatory user confirmation at each step
**Depends on**: Phase 5.1
**Requirements**: FN-AUDIT-01 to FN-AUDIT-05
**Timeline**: 3-4 days
**Plans**: 3 plans

Plans:
- [ ] 05.2-01-PLAN.md â€” Analysis Infrastructure Setup (Wave 1)
- [ ] 05.2-02-PLAN.md â€” Function Analysis & Confirmation (Wave 2)
- [ ] 05.2-03-PLAN.md â€” Documentation Finalization (Wave 3)

**Success Criteria:**
1. All `.txt` test artifacts from Phase 5.1 cleaned up before starting analysis
2. Every function in `bin/**` analyzed individually (not file-by-file)
3. Stage 1 analysis documents created in `/eval/stage_1/` with mandatory YAML headers
4. User confirmation obtained via `ask_user` for each function's interpretation
5. All functions documented: purpose, inputs/outputs, side effects, dependencies, reuse potential
6. Variables, constants, and their roles identified for each module
7. Relationships to main flow (install.js, index.js) mapped

**Mandatory Interaction:**
- MUST use `ask_user` to confirm interpretation and missing context before finalizing each Stage 1 write-up
- MUST present options as explicit choices when alternatives exist (e.g., "utility" vs "tool adapter")
- MUST request inputs for paths, naming conventions, and acceptance criteria

**Stage 1 YAML Header Format:**
```yaml
subject: <function|module>  # recommended: function
name: <function-name>
source_file: <file-name>
source_location: <file-path>
function_count_in_file: <N>
analysis_stage: 1
last_updated: <timestamp>
```

**Analysis Unit:** Per-function (if file has N functions, analyze each individually)

**Mandatory Pre-Cleanup:**
- Delete all `.txt` artifacts from Phase 5.1 tests (analysis-*.txt, test-*.txt, coverage-*.txt, deps-*.txt, etc.)
- Confirm cleanup scope with user via `ask_user` before deletion

**Workflow:**
1. Clean up test artifacts with user confirmation
2. Read and understand each file in `bin/**`
3. Enumerate all functions and describe purpose
4. Identify variables/constants and their role
5. ASK USER for clarification/confirmation (mandatory)
6. Present alternatives as options when applicable
7. Record finalized analysis to `/eval/stage_1/`

---

### Phase 5.3: Function-level Consolidation and Optimization (Stage 2) (INSERTED)
**Goal**: Evaluate repeated/overlapping logic across all functions and propose consolidation with mandatory user decisions
**Depends on**: Phase 5.2
**Requirements**: FN-CONSOL-01 to FN-CONSOL-04
**Timeline**: 3-4 days
**Plans**: 0 plans

Plans:
- [ ] TBD (run /gsd-plan-phase 5.3 to break down)

**Success Criteria:**
1. Stage 2 analysis documents created in `/eval/stage_2/` with mandatory YAML headers
2. Every function evaluated for: duplication, overlap, unification opportunities
3. Consolidation results specified: merge/keep/rename/move
4. User approval obtained via `ask_user` before committing any consolidation plan
5. Merge details documented when functions are unified
6. Clear rationale for each decision (keep vs rename vs move vs merge)

**Mandatory Interaction:**
- MUST present options for each function when multiple reasonable outcomes exist
- MUST use `ask_user` to request user selection before finalizing Stage 2 plans
- MUST confirm merge targets and merge details with user

**Stage 2 YAML Header Format:**
```yaml
subject: <function|module>  # recommended: function
name: <function-name-or-new-name>
source_file: <file-name>
source_location: <file-path>
function_count_in_file: <N>
analysis_stage: 2
analysis_result: <merge|keep|rename|move>
merge_details: <optional>  # if analysis_result=merge, specify what merges into what
last_updated: <timestamp>
```

**Analysis Results:**
- **merge**: At least 1 function unified with another (state which ones)
- **keep**: Remains as-is
- **rename**: Renamed to better reflect intent
- **move**: Relocated for clarity (logical move)

---

### Phase 5.4: Function-level Review of `index.js` (Stage 3) (INSERTED)
**Goal**: Apply function-level analysis to `index.js` with focus on clarity, duplication, and safe optimization
**Depends on**: Phase 5.3
**Requirements**: FN-INDEX-01 to FN-INDEX-03
**Timeline**: 2-3 days
**Plans**: 0 plans

Plans:
- [ ] TBD (run /gsd-plan-phase 5.4 to break down)

**Success Criteria:**
1. `index.js` analyzed function-by-function using Stage 1 and Stage 2 criteria
2. Stage 3 analysis documents created with findings and improvement proposals
3. All proposed changes reviewed with user via `ask_user`
4. Alternative approaches presented when applicable
5. Clarity issues identified and documented
6. Duplication opportunities found
7. Side effects and coupling analyzed
8. Safe optimization opportunities identified without breaking compatibility

**Mandatory Interaction:**
- MUST review all proposed changes with user via `ask_user`
- MUST include alternative approaches for user selection
- MUST confirm behavior-sensitive changes before planning implementation

---

### Phase 5.5: Execute Unification and Improvements (INSERTED)
**Goal**: Implement all approved consolidation, optimization, and structural improvements with preserved behavior
**Depends on**: Phase 5.4
**Requirements**: FN-EXEC-01 to FN-EXEC-04
**Timeline**: 3-5 days
**Plans**: 0 plans

Plans:
- [ ] TBD (run /gsd-plan-phase 5.5 to break down)

**Success Criteria:**
1. `index.js` is clean and well-structured with reduced accidental complexity
2. `bin/**` folder has fewest files possible with optimal organization
3. All merge/rename/move plans executed successfully
4. No breaking changes - existing behavior preserved
5. Code optimized where safe to do so
6. User confirmation obtained for implementation steps via `ask_user`
7. Final folder structure and naming approved by user
8. All behavior-sensitive changes confirmed before execution

**Mandatory Interaction:**
- MUST execute implementation only after user confirmation via `ask_user`
- MUST confirm merge/rename/move plan with user
- MUST confirm behavior-sensitive changes
- MUST confirm final folder structure and naming

**Critical Note about `lib-ghcc/`:**
- Primary objective: clean and consolidate to ideally end with **only `bin/**`** as main execution surface
- Minimize or remove residual dependencies on `lib-ghcc/` when feasible
- MUST confirm via `ask_user` any decision to delete, deprecate, or retain `lib-ghcc/` components
- MUST present options (e.g., "deprecate then remove" vs "move into bin/lib adapters")

**Expected Outcome:**
- Modern, maintainable, minimal structure
- Existing behavior preserved
- Foundation prepared for future integrations (GPT-4All, Mistral, Gemini)
- Clear path from legacy `lib-ghcc/` to modern `bin/**`

---

### Phase 5.6: Codex Global Support & Path Unification (INSERTED)
**Goal**: Implement missing `--codex --global` support and unify path logic across all platforms (built on clean architecture from 5.1)
**Depends on**: Phase 5.5
**Requirements**: CODEX-GLOBAL-01, CODEX-GLOBAL-02, PATH-UNIF-01
**Timeline**: 1-2 days

**Success Criteria:**
1. `--codex --global` reads/writes configuration from `~/.codex/`
2. `--codex` (without `--global`) uses local configuration at `[repo-root]/.codex/`
3. Path resolution logic unified across Claude, Copilot, and Codex
4. All tests execute in `/tmp` directories (never touch real `.claude/`, `.copilot/`, `.codex/`)
5. No breaking of existing functionality - all current flag combinations work

**Technical approach:**
- Implement Codex global path support in `bin/lib/paths.js` (or new location after 5.1)
- Unify path resolution logic to reduce duplication
- Update Codex adapter to handle both global and local scopes
- Create test suite in `/tmp` for all path combinations
- Validate all platform + scope combinations work correctly

**Testing requirements:**
- All tests run in temporary directories under `/tmp`
- Never use actual `.claude/`, `.copilot/`, `.codex/` directories from project
- Simulate environments in isolated `/tmp` locations
- Test all combinations: `--codex`, `--codex --local`, `--codex --global`

---

### Phase 5.7: Future Integration Preparation & Validation (INSERTED)
**Goal**: Prepare structure for GPT-4All/Mistral/Gemini integration and validate all functionality works
**Depends on**: Phase 5.6
**Requirements**: FUTURE-PREP-01 to FUTURE-PREP-04
**Timeline**: 2-3 days

**Success Criteria:**
1. Architecture ready for GPT-4All, Mistral, Gemini integration
2. Extension points clearly documented for adding new AI platforms
3. All existing functionality validated with comprehensive test suite in `/tmp`
4. All parameter combinations tested (flags, platforms, scopes)
5. Codebase mapping updated with `gsd-map-codebase`
6. No regressions - everything that worked before still works
7. Clean test report showing 100% validation coverage

**Technical approach:**
- **Phase 1: Extension Point Design**
  - Document how to add new AI platform (GPT-4All/Mistral/Gemini)
  - Create template adapter structure
  - Define interface for new platforms
  - Update documentation with extension guide

- **Phase 2: Comprehensive Validation**
  - Execute `node bin/install.js` in `/tmp` with all combinations:
    - Single platform: `--claude`, `--copilot`, `--codex`
    - Multi-platform: `--claude --copilot`, `--all`
    - Scope variations: `--local`, `--global`
    - All permutations of platform + scope
  - Test interactive menu flows
  - Test error cases (old flags, invalid combinations)
  - Validate uninstall functionality

- **Phase 3: Test Documentation**
  - Document all test cases executed
  - Create validation matrix (feature Ã— test result)
  - Generate test coverage report
  - Document any edge cases discovered

- **Phase 4: Codebase Mapping Update**
  - Run `gsd-map-codebase` to update project structure
  - Ensure mapping reflects all Phase 5.2 changes
  - Update documentation references

**Testing requirements:**
- All validation tests run in `/tmp`
- Never modify actual project configuration directories
- Test matrix covering all combinations:
  - 3 platforms Ã— 2 scopes = 6 base combinations
  - Multi-platform combinations
  - Interactive menu paths
  - Error handling paths
- Performance validation (no significant slowdown from restructuring)

**Deliverable: Validation Report**
Must include:
- Complete test matrix with results
- Performance comparison (before/after restructuring)
- Extension guide for new AI platforms
- Updated codebase map
- Sign-off that all functionality validated

---

### Phase 6: Uninstall Implementation
**Goal**: uninstall.js has feature parity with install.js using same flag system and message optimization
**Depends on**: Phase 5.7
**Requirements**: UNINST-01, UNINST-02, UNINST-03
**Timeline**: 2-3 days

**Success Criteria:**
1. Uninstall supports same flags: `--claude`, `--copilot`, `--codex`, `--all`, `--global`, `--local`
2. Validation checks platform exists before uninstall, shows error if not installed
3. `--all` flag prompts confirmation before uninstalling all platforms
4. Error handling matches install.js (same messages for removed flags)
5. Message optimization applied (same context-aware display)

**Technical approach:**
- Refactor shared code into modules:
  - Flag parsing (shared between install/uninstall)
  - Routing logic (shared)
  - Message display (shared)
- Apply Commander.js to uninstall.js
- Implement validation: check if platform installed before uninstall
- Add confirmation prompt for `--all` uninstall
- Share test utilities with install.js tests

---

### Phase 7: Testing & Quality Assurance
**Goal**: All installation and uninstall workflows are tested with >80% coverage and manual QA completed
**Depends on**: Phase 6
**Requirements**: TEST-01, TEST-02, TEST-03, TEST-04
**Timeline**: 3-4 days

**Success Criteria:**
1. Unit tests cover flag parsing (all combinations, validation, errors)
2. Unit tests cover interactive menu logic (selections, non-TTY fallback)
3. Integration tests cover installation workflows (each platform, multi-platform, --all)
4. Integration tests cover uninstall workflows (validation, confirmation, error handling)
5. Manual QA completed on macOS and Linux for all platforms

**Technical approach:**
- Write unit tests with Jest:
  - Flag parsing: 20+ test cases for all combinations
  - Menu logic: Mock Prompts, test selections
  - Error handling: Test removed flag detection
- Write integration tests:
  - Full install workflows (actual file operations in temp dirs)
  - Full uninstall workflows
  - Multi-platform scenarios
- Create manual QA checklist:
  - Install each platform individually (local and global)
  - Install multiple platforms in one command
  - Interactive menu workflow
  - Error messages for removed flags
  - Uninstall each platform
- Run tests on macOS and Linux environments
- Target: >80% code coverage

---

### Phase 8: Documentation & Migration
**Goal**: Documentation is complete, migration guide is clear, and users can upgrade smoothly
**Depends on**: Phase 7
**Requirements**: DOCS-01, DOCS-02, DOCS-03, DOCS-04
**Timeline**: 2-3 days

**Success Criteria:**
1. README updated with new flag syntax and examples
2. MIGRATION.md created in repo root with simple flag transition guide
3. CHANGELOG.md has two sections: "End Users" and "Contributors"
4. Installation documentation updated with interactive menu workflow
5. All examples use new flag syntax (no old flags in docs)

**Technical approach:**
- Update README.md:
  - Installation section with new flags
  - Add examples: `--claude --local`, `--copilot --global`, `--all`
  - Document interactive menu
  - Remove references to old flags
- Create MIGRATION.md:
  - Keep as simple as possible - one-page quick reference
  - Simple before/after table ONLY
  - Old: `--local` â†’ New: `--claude --local`
  - Old: `--global` â†’ New: `--claude --global`
  - Old: `--codex-global` â†’ New: `--codex` (local only)
  - Link from error messages
  - **Do not include**: edge cases, advanced scenarios, troubleshooting
- Update CHANGELOG.md:
  - Section 1 "End Users": Breaking changes, new features, migration
  - Section 2 "Contributors": Implementation details, architecture changes
- Update any installation guides in docs/
- Add CI/CD examples with new flags

---

## Progress Tracking

| Phase | Goal | Requirements | Status |
|-------|------|--------------|--------|
| 1 | Dependency setup | DEPS-01, DEPS-02 | âœ… Complete |
| 2 | Flag system redesign | FLAG-01 to FLAG-06 | âœ… Complete |
| 3 | Interactive menu | MENU-01 to MENU-04 | âœ… Complete |
| 4 | Platform paths | PATH-01 to PATH-03 | âœ… Complete |
| 5 | Message optimization | MSG-01 to MSG-03 | âœ… Complete |
| 5.1 | Architecture optimization | ARCH-OPT-01 to ARCH-OPT-08 | âœ… Complete |
| 5.2 | Function-level inventory (Stage 1) | FN-AUDIT-01 to FN-AUDIT-05 | ðŸ”„ Next |
| 5.3 | Function-level consolidation (Stage 2) | FN-CONSOL-01 to FN-CONSOL-04 | Pending |
| 5.4 | Function-level index.js review (Stage 3) | FN-INDEX-01 to FN-INDEX-03 | Pending |
| 5.5 | Execute unification | FN-EXEC-01 to FN-EXEC-04 | Pending |
| 5.6 | Codex global & path unification | CODEX-GLOBAL-01, CODEX-GLOBAL-02, PATH-UNIF-01 | Pending |
| 5.7 | Future integration prep | FUTURE-PREP-01 to FUTURE-PREP-04 | Pending |
| 6 | Uninstall implementation | UNINST-01 to UNINST-03 | Pending |
| 7 | Testing & QA | TEST-01 to TEST-04 | Pending |
| 8 | Documentation | DOCS-01 to DOCS-04 | Pending |

**Total:** 6/15 phases complete (40%)

## Requirement Coverage

| Category | Requirements | Phase | Coverage |
|----------|--------------|-------|----------|
| FLAG | 6 | Phase 2 | 6/6 âœ“ |
| PATH | 3 | Phase 4 | 3/3 âœ“ |
| MENU | 4 | Phase 3 | 4/4 âœ“ |
| MSG | 3 | Phase 5 | 3/3 âœ“ |
| DEPS | 2 | Phase 1 | 2/2 âœ“ |
| ARCH-OPT | 8 | Phase 5.1 | 8/8 âœ“ |
| FN-AUDIT | 5 | Phase 5.2 | 0/5 |
| FN-CONSOL | 4 | Phase 5.3 | 0/4 |
| FN-INDEX | 3 | Phase 5.4 | 0/3 |
| FN-EXEC | 4 | Phase 5.5 | 0/4 |
| CODEX-GLOBAL | 2 | Phase 5.6 | 0/2 |
| PATH-UNIF | 1 | Phase 5.6 | 0/1 |
| FUTURE-PREP | 4 | Phase 5.7 | 0/4 |
| UNINST | 3 | Phase 6 | 0/3 |
| TEST | 4 | Phase 7 | 0/4 |
| DOCS | 4 | Phase 8 | 0/4 |

**Total:** 26/61 requirements mapped (43% coverage) | 26/61 complete (43%)

## Technical Decisions

| Decision | Rationale | Phase |
|----------|-----------|-------|
| Use Commander.js v14+ | Zero dependencies, clean API, built-in validation, widely adopted | Phase 1 |
| Use Prompts v2.4+ | Lightweight, beautiful UI, minimal code, checkbox support | Phase 1 |
| Hard removal of old flags | Clean break, no confusion, forces migration | Phase 2 |
| Codex global support added | Implement after architecture cleanup, avoid refactoring new code | Phase 5.2 |
| Restructure before any new features | Avoid refactoring new code, build on clean foundation | Phase 5.1 |
| SOLID principles mandatory | Prepare for future AI tool integrations (GPT-4All, Mistral, Gemini) | Phase 5.2 |
| Extract routing to module | Replace 100+ line if/else with clean router | Phase 2 |
| Message manager module | Context-aware output, shared between install/uninstall | Phase 5 |
| Shared code for install/uninstall | DRY principle, consistent behavior | Phase 6 |
| Focus on unit/integration tests | Less brittle than E2E, faster feedback | Phase 7 |
| Simple migration guide | Focus on flag transition only, avoid complexity | Phase 8 |
| Two-section CHANGELOG | Separate user-facing and contributor-facing changes | Phase 8 |

## Critical Path

The following dependencies define the critical path:

```
Phase 1 (Dependencies) 
  â†’ Phase 2 (Flags) 
    â†’ Phase 3 (Menu)
    â†’ Phase 4 (Paths)
      â†’ Phase 5 (Messages)
        â†’ Phase 5.1 (Architecture Optimization) âš ï¸ COMPLETE
          â†’ Phase 5.2 (Function-level Inventory - Stage 1) ðŸ”„ NEXT
            â†’ Phase 5.3 (Function-level Consolidation - Stage 2)
              â†’ Phase 5.4 (Function-level Index Review - Stage 3)
                â†’ Phase 5.5 (Execute Unification)
                  â†’ Phase 5.6 (Codex Global) - built on clean architecture
                    â†’ Phase 5.7 (Future Prep & Validation)
                      â†’ Phase 6 (Uninstall)
                        â†’ Phase 7 (Testing)
                          â†’ Phase 8 (Documentation)
```

**Parallel work opportunities:**
- Phase 3 and Phase 4 could have run in parallel after Phase 2 (already completed)
- Phase 8 documentation can start during Phase 7 testing

**Critical bottleneck:**
- **Phases 5.2-5.5 (Function-level Audit)** are now the critical path - comprehensive function-by-function analysis and consolidation
- Estimated 11-16 days for function audit phases (longest sequence)
- All phases require mandatory user interaction via `ask_user`
- Phase 5.6 (Codex Global) waits for clean, consolidated codebase from 5.5
- Phase 6 (Uninstall) waits for final architecture from 5.5

## Risk Management

| Risk | Likelihood | Impact | Mitigation |
|------|-----------|--------|------------|
| Breaking user CI/CD pipelines | HIGH | HIGH | Clear error messages with migration guide link, announce breaking change in advance |
| Claude path breaking change | HIGH | HIGH | Clean break to ~/.claude/, update all docs, clear CHANGELOG communication |
| Flag validation complexity | MEDIUM | MEDIUM | Comprehensive unit tests, Commander.js built-in validation |
| Interactive menu in non-TTY | LOW | MEDIUM | Early detection, sensible fallback (all local) |
| Uninstall inconsistency | MEDIUM | MEDIUM | Shared modules, parallel test suite |
| Scope creep | MEDIUM | HIGH | Strict adherence to requirements, defer nice-to-haves |
| Timeline slip | MEDIUM | MEDIUM | Weekly check-ins, cut scope if needed |

**Mitigation strategies:**
- **Breaking changes**: Announce in advance, provide detailed migration guide, monitor issues
- **Claude path change**: Clean break strategy - document in CHANGELOG, update all examples, no migration helpers
- **Scope management**: Define MVP clearly (all P0 requirements), defer Windows testing to v1.10.1
- **Quality assurance**: Write tests alongside implementation, focus on high-value areas
- **Timeline**: Break into clear phases, track progress weekly, ready to cut non-critical features

## Out of Scope

Explicitly NOT included in v1.10.0:

- âŒ Soft deprecation warnings (hard removal only)
- âŒ Backward compatibility (breaking change)
- âŒ Windows testing (defer to v1.10.1)
- âŒ Verbose mode `--verbose` flag (defer to v1.10.1)
- âŒ Help message enhancements beyond Commander.js defaults
- âŒ Performance benchmarking
- ~~âŒ Codex global support (show warning, install locally)~~ â†’ âœ… NOW IN SCOPE (Phase 5.1)

## Timeline Estimate

Updated with 3 inserted phases:

| Phase | Estimate | Notes |
|-------|----------|-------|
| Phase 1: Dependencies | âœ… Complete | ~2 min actual |
| Phase 2: Flag System | âœ… Complete | ~15 min actual |
| Phase 3: Interactive Menu | âœ… Complete | ~45 min actual |
| Phase 4: Platform Paths | âœ… Complete | ~8 min actual (2 plans) |
| Phase 5: Messages | âœ… Complete | ~9 min actual (2 plans) |
| Phase 5.1: Architecture Optimization | âœ… Complete | ~5 days actual (5 plans) |
| Phase 5.2: Function-level Inventory | 3-4 days | **NEXT** - Stage 1 analysis, user confirmations |
| Phase 5.3: Function-level Consolidation | 3-4 days | Stage 2 consolidation plans |
| Phase 5.4: Function-level Index Review | 2-3 days | Stage 3 index.js analysis |
| Phase 5.5: Execute Unification | 3-5 days | Implementation of approved changes |
| Phase 5.6: Codex Global | 1-2 days | Path unification, testing in /tmp |
| Phase 5.7: Future Prep & Validation | 2-3 days | Extension points, comprehensive validation |
| Phase 6: Uninstall | 2-3 days | Feature parity with install |
| Phase 7: Testing | 3-4 days | Comprehensive test coverage |
| Phase 8: Documentation | 2-3 days | README, migration guide, CHANGELOG |

**Original estimate: 17-23 days (~3-4 weeks)**  
**With 3 insertions: 24-33 days (~4-6 weeks)**
**With 7 insertions: 35-50 days (~5-7 weeks)**

**Optimistic:** 5 weeks (efficient analysis, clear consolidation paths)  
**Realistic:** 6-7 weeks (includes thorough function-level work with user confirmations)  
**Pessimistic:** 8-9 weeks (complex consolidation decisions, extensive validation)

## Milestone Completion Criteria

Milestone is complete when:

- âœ… All 61 requirements implemented (29 original + 15 architecture + 17 function-level audit)
- âœ… All 15 phases complete with success criteria met
- âœ… Function-level audit complete (Stages 1-3)
- âœ… Bin/** consolidated and optimized
- âœ… Index.js clean and well-structured
- âœ… Codex global support implemented and tested
- âœ… Architecture optimized following SOLID principles
- âœ… Detailed architecture optimization report delivered
- âœ… Project prepared for GPT-4All/Mistral/Gemini integration
- âœ… >80% test coverage achieved
- âœ… Manual QA checklist completed (macOS + Linux)
- âœ… Documentation complete (README, MIGRATION.md, CHANGELOG.md)
- âœ… Codebase mapping updated with gsd-map-codebase
- âœ… No P0 bugs open
- âœ… Pre-launch validation passed

**Pre-launch validation checklist:**
1. Install all platforms with new flags (manual test)
2. Install with old flags, verify error shown with migration guide link
3. Interactive menu selects multiple platforms correctly
4. CI/CD example script works (non-interactive)
5. Uninstall all platforms works
6. Migration guide examples tested
7. README examples tested

---

## Research Context

This roadmap is based on comprehensive research:

- **Technology stack**: Commander.js v14+ (argument parsing), Prompts v2.4+ (interactive menus)
- **Current architecture**: Monolithic install.js (1612 lines), strong adapter pattern, template system
- **Platform patterns**: Claude (local + global), Copilot (local + global), Codex (local only)
- **Scope changes**: Hard removal (not soft deprecation), uninstall now P0, Codex global not implemented

**Research files:**
- `.planning/research/v1.10.0/BRIEF.md` â€” Updated requirements (scope changes)
- `.planning/research/v1.10.0/SUMMARY.md` â€” Technology analysis and technical approach
- `.planning/research/v1.10.0/01-cli-frameworks.md` â€” Commander.js vs alternatives
- `.planning/research/v1.10.0/02-current-architecture.md` â€” Codebase analysis
- `.planning/research/v1.10.0/03-platform-patterns.md` â€” Platform-specific requirements
- `.planning/research/v1.10.0/04-migration-testing.md` â€” Testing and migration strategy

**Key findings from research:**
- Commander.js + Prompts is optimal stack (zero dependencies, clean API)
- Existing adapter pattern is solid foundation for refactoring
- 60+ discrete tasks across 8 implementation phases
- Single milestone is feasible with aggressive scope management
- Focus on unit/integration tests over brittle E2E tests

---

*Roadmap created: 2026-01-24*  
*Depth: Comprehensive*  
*Requirements: 29 (all P0)*  
*Coverage: 100%*
