# Milestone v1.10.0: Installation CLI Optimization

**Status:** Planning
**Phases:** 8
**Total Requirements:** 29 (all P0)
**Breaking Changes:** Yes (hard removal of old flags)

## Overview

This milestone redesigns the installation CLI from implicit platform assumptions (`--local` = Claude) to explicit platform selection (`--claude --local`) with flexible scope modifiers. The redesign enables multi-platform installation in a single command and provides an intuitive interactive menu. **This is a breaking change** — old flags (`--local`, `--global`, `--codex-global`) are completely removed with clear migration errors.

Key deliverables: Commander.js-based flag system, Prompts-based interactive menu, full uninstall.js implementation, platform path clarification (Codex local only), and comprehensive documentation with simple migration guide.

## Phases

### Phase 1: Dependency Setup
**Goal**: Development environment has modern CLI libraries installed and verified compatible
**Depends on**: Nothing (first phase)
**Requirements**: DEPS-01, DEPS-02
**Timeline**: 1 day
**Plans**: 1 plan

**Plans:**
- [x] 01-01-PLAN.md — Install Commander.js v14+ and verify both CLI libraries

**Success Criteria:**
1. Commander.js v14+ installed and importable in install.js
2. Prompts v2.4+ installed and importable in install.js
3. No dependency conflicts in package.json
4. Basic import test passes (verify libraries load)

**Why this first**: Foundation for all subsequent phases. Commander.js and Prompts are zero-config libraries that need no integration work beyond installation.

---

### Phase 2: Flag System Redesign
**Goal**: Users can select platforms explicitly via flags with scope modifiers, and receive clear errors if old flags are used
**Depends on**: Phase 1
**Requirements**: FLAG-01, FLAG-02, FLAG-03, FLAG-04, FLAG-05, FLAG-06
**Timeline**: 3-4 days
**Plans**: 3 plans

**Plans:**
- [x] 02-01-PLAN.md — Core flag parsing infrastructure (three-stage architecture)
- [x] 02-02-PLAN.md — Codex global warning & edge cases
- [x] 02-03-PLAN.md — Flag system test suite

**Success Criteria:**
1. Platform flags work: `--claude`, `--copilot`, `--codex` install correct platforms
2. Scope flags work: `--global`, `--local` modify installation path correctly
3. Multi-platform works: `--claude --copilot` installs both platforms
4. Bulk installation works: `--all` installs all platforms, `--all --global` handles Codex warning
5. Old flags rejected: `--local`, `--global`, `--codex-global` show clear "removed" error (not "deprecated") with migration guide link
6. Codex global warning shown when `--codex --global` used, installs locally

**Technical approach:**
- Implement Commander.js program with `.option()` for each flag
- Define platform options: `--claude`, `--copilot`, `--codex`, `--all`
- Define scope options: `--global/-g`, `--local/-l`
- Add validation logic for invalid combinations (e.g., multiple scopes)
- Detect old flag patterns and show migration error
- Extract routing logic to separate module (replace 100+ line if/else)

---

### Phase 3: Interactive Menu Implementation
**Goal**: Users without flags enter intuitive multi-select menu for platform and scope choice
**Depends on**: Phase 2
**Requirements**: MENU-01, MENU-02, MENU-03, MENU-04
**Timeline**: 2-3 days
**Plans**: 1 plan

Plans:
- [ ] 03-01-PLAN.md — Interactive menu with Prompts (multiselect platforms, radio scope, TTY detection)

**Success Criteria:**
1. No flags triggers interactive menu automatically
2. Platform selection uses checkbox (multi-select) for Claude, Copilot, Codex, All
3. Scope selection uses radio (single select) for Local/Global, defaults to Local
4. Non-TTY environment detected, shows error and exits (not auto-proceed)
5. Menu integrates with Phase 2 routing (produces same result as flags)

**Technical approach:**
- Use Prompts library for UI
- First prompt: `type: 'multiselect'` for platforms
- Second prompt: `type: 'select'` for scope
- Detect TTY with `process.stdin.isTTY`
- Transform menu selections into flag-equivalent structure
- Route through same logic as flag-based installation

---

### Phase 4: Platform Path Implementation
**Goal**: Each platform installs to correct local and global directories per updated specification
**Depends on**: Phase 2
**Requirements**: PATH-01, PATH-02, PATH-03
**Timeline**: 2-3 days

**Success Criteria:**
1. Claude local installs to `[repo-root]/.claude/`
2. Claude global installs to `~/.claude/`
3. Copilot local installs to `[repo-root]/.github/`
4. Copilot global installs to `~/.copilot/`
5. Codex local installs to `[repo-root]/.codex/`
6. Codex global shows warning and installs locally (no global support)

**Technical approach:**
- Update `bin/lib/paths.js` with correct path mappings
- **Claude global path**: Replace `~/Library/Application Support/Claude` with `~/.claude/` (clean break, no migration)
- Verify Claude adapter uses `.claude/` for local (not legacy paths)
- Verify Copilot adapter uses `~/.copilot/` for global (not hardcoded local-only)
- Add Codex global warning in routing logic
- Test path resolution on macOS and Linux
- Update platform adapters if path logic needs changes
- Remove all references to old Claude paths from codebase

---

### Phase 5: Message Optimization
**Goal**: Installation output is clean, context-aware, and shows only necessary information
**Depends on**: Phase 4
**Requirements**: MSG-01, MSG-02, MSG-03
**Timeline**: 2 days

**Success Criteria:**
1. Generic platform notes removed (e.g., "Linux XDG Base Directory support...")
2. Only relevant messages shown based on platform/OS/scope
3. Codex global warning displays when `--codex --global` used
4. Success messages use consistent Unicode: ✓ (success), ✗ (error), ⠿ (progress)
5. Output format: "✓ Claude Code installed to ~/.claude/"

**Technical approach:**
- Build message manager module with context-aware logic
- Remove hardcoded verbose messages from install.js
- Add conditional message display based on:
  - Platform being installed (Claude, Copilot, Codex)
  - Scope (global vs local)
  - Operating system (macOS, Linux, Windows)
- Standardize Unicode symbols across all messages
- Extract message templates to separate file

---

### Phase 6: Uninstall Implementation
**Goal**: uninstall.js has feature parity with install.js using same flag system and message optimization
**Depends on**: Phase 5
**Requirements**: UNINST-01, UNINST-02, UNINST-03
**Timeline**: 2-3 days

**Success Criteria:**
1. Uninstall supports same flags: `--claude`, `--copilot`, `--codex`, `--all`, `--global`, `--local`
2. Validation checks platform exists before uninstall, shows error if not installed
3. `--all` flag prompts confirmation before uninstalling all platforms
4. Error handling matches install.js (same messages for removed flags)
5. Message optimization applied (same context-aware display)

**Technical approach:**
- Refactor shared code into modules:
  - Flag parsing (shared between install/uninstall)
  - Routing logic (shared)
  - Message display (shared)
- Apply Commander.js to uninstall.js
- Implement validation: check if platform installed before uninstall
- Add confirmation prompt for `--all` uninstall
- Share test utilities with install.js tests

---

### Phase 7: Testing & Quality Assurance
**Goal**: All installation and uninstall workflows are tested with >80% coverage and manual QA completed
**Depends on**: Phase 6
**Requirements**: TEST-01, TEST-02, TEST-03, TEST-04
**Timeline**: 3-4 days

**Success Criteria:**
1. Unit tests cover flag parsing (all combinations, validation, errors)
2. Unit tests cover interactive menu logic (selections, non-TTY fallback)
3. Integration tests cover installation workflows (each platform, multi-platform, --all)
4. Integration tests cover uninstall workflows (validation, confirmation, error handling)
5. Manual QA completed on macOS and Linux for all platforms

**Technical approach:**
- Write unit tests with Jest:
  - Flag parsing: 20+ test cases for all combinations
  - Menu logic: Mock Prompts, test selections
  - Error handling: Test removed flag detection
- Write integration tests:
  - Full install workflows (actual file operations in temp dirs)
  - Full uninstall workflows
  - Multi-platform scenarios
- Create manual QA checklist:
  - Install each platform individually (local and global)
  - Install multiple platforms in one command
  - Interactive menu workflow
  - Error messages for removed flags
  - Uninstall each platform
- Run tests on macOS and Linux environments
- Target: >80% code coverage

---

### Phase 8: Documentation & Migration
**Goal**: Documentation is complete, migration guide is clear, and users can upgrade smoothly
**Depends on**: Phase 7
**Requirements**: DOCS-01, DOCS-02, DOCS-03, DOCS-04
**Timeline**: 2-3 days

**Success Criteria:**
1. README updated with new flag syntax and examples
2. MIGRATION.md created in repo root with simple flag transition guide
3. CHANGELOG.md has two sections: "End Users" and "Contributors"
4. Installation documentation updated with interactive menu workflow
5. All examples use new flag syntax (no old flags in docs)

**Technical approach:**
- Update README.md:
  - Installation section with new flags
  - Add examples: `--claude --local`, `--copilot --global`, `--all`
  - Document interactive menu
  - Remove references to old flags
- Create MIGRATION.md:
  - Keep as simple as possible - one-page quick reference
  - Simple before/after table ONLY
  - Old: `--local` → New: `--claude --local`
  - Old: `--global` → New: `--claude --global`
  - Old: `--codex-global` → New: `--codex` (local only)
  - Link from error messages
  - **Do not include**: edge cases, advanced scenarios, troubleshooting
- Update CHANGELOG.md:
  - Section 1 "End Users": Breaking changes, new features, migration
  - Section 2 "Contributors": Implementation details, architecture changes
- Update any installation guides in docs/
- Add CI/CD examples with new flags

---

## Progress Tracking

| Phase | Goal | Requirements | Status |
|-------|------|--------------|--------|
| 1 | Dependency setup | DEPS-01, DEPS-02 | Pending |
| 2 | Flag system redesign | FLAG-01 to FLAG-06 | Pending |
| 3 | Interactive menu | MENU-01 to MENU-04 | Pending |
| 4 | Platform paths | PATH-01 to PATH-03 | Pending |
| 5 | Message optimization | MSG-01 to MSG-03 | Pending |
| 6 | Uninstall implementation | UNINST-01 to UNINST-03 | Pending |
| 7 | Testing & QA | TEST-01 to TEST-04 | Pending |
| 8 | Documentation | DOCS-01 to DOCS-04 | Pending |

**Total:** 0/8 phases complete

## Requirement Coverage

| Category | Requirements | Phase | Coverage |
|----------|--------------|-------|----------|
| FLAG | 6 | Phase 2 | 6/6 ✓ |
| PATH | 3 | Phase 4 | 3/3 ✓ |
| MENU | 4 | Phase 3 | 4/4 ✓ |
| MSG | 3 | Phase 5 | 3/3 ✓ |
| DEPS | 2 | Phase 1 | 2/2 ✓ |
| UNINST | 3 | Phase 6 | 3/3 ✓ |
| DOCS | 4 | Phase 8 | 4/4 ✓ |
| TEST | 4 | Phase 7 | 4/4 ✓ |

**Total:** 29/29 requirements mapped (100% coverage)

## Technical Decisions

| Decision | Rationale | Phase |
|----------|-----------|-------|
| Use Commander.js v14+ | Zero dependencies, clean API, built-in validation, widely adopted | Phase 1 |
| Use Prompts v2.4+ | Lightweight, beautiful UI, minimal code, checkbox support | Phase 1 |
| Hard removal of old flags | Clean break, no confusion, forces migration | Phase 2 |
| Codex local only (no global) | Simplified scope for v1.10.0, global can be added in v1.11.0 | Phase 4 |
| Extract routing to module | Replace 100+ line if/else with clean router | Phase 2 |
| Message manager module | Context-aware output, shared between install/uninstall | Phase 5 |
| Shared code for install/uninstall | DRY principle, consistent behavior | Phase 6 |
| Focus on unit/integration tests | Less brittle than E2E, faster feedback | Phase 7 |
| Simple migration guide | Focus on flag transition only, avoid complexity | Phase 8 |
| Two-section CHANGELOG | Separate user-facing and contributor-facing changes | Phase 8 |

## Critical Path

The following dependencies define the critical path:

```
Phase 1 (Dependencies) 
  → Phase 2 (Flags) 
    → Phase 3 (Menu)
    → Phase 4 (Paths)
      → Phase 5 (Messages)
        → Phase 6 (Uninstall)
          → Phase 7 (Testing)
            → Phase 8 (Documentation)
```

**Parallel work opportunities:**
- Phase 3 and Phase 4 can run in parallel after Phase 2 completes
- Phase 8 documentation can start during Phase 7 testing

**Bottlenecks:**
- Phase 2 blocks all feature work (foundational)
- Phase 6 blocks testing (must test both install and uninstall)
- Phase 7 blocks shipping (quality gate)

## Risk Management

| Risk | Likelihood | Impact | Mitigation |
|------|-----------|--------|------------|
| Breaking user CI/CD pipelines | HIGH | HIGH | Clear error messages with migration guide link, announce breaking change in advance |
| Claude path breaking change | HIGH | HIGH | Clean break to ~/.claude/, update all docs, clear CHANGELOG communication |
| Flag validation complexity | MEDIUM | MEDIUM | Comprehensive unit tests, Commander.js built-in validation |
| Interactive menu in non-TTY | LOW | MEDIUM | Early detection, sensible fallback (all local) |
| Uninstall inconsistency | MEDIUM | MEDIUM | Shared modules, parallel test suite |
| Scope creep | MEDIUM | HIGH | Strict adherence to requirements, defer nice-to-haves |
| Timeline slip | MEDIUM | MEDIUM | Weekly check-ins, cut scope if needed |

**Mitigation strategies:**
- **Breaking changes**: Announce in advance, provide detailed migration guide, monitor issues
- **Claude path change**: Clean break strategy - document in CHANGELOG, update all examples, no migration helpers
- **Scope management**: Define MVP clearly (all P0 requirements), defer Windows testing to v1.10.1
- **Quality assurance**: Write tests alongside implementation, focus on high-value areas
- **Timeline**: Break into clear phases, track progress weekly, ready to cut non-critical features

## Out of Scope

Explicitly NOT included in v1.10.0:

- ❌ Soft deprecation warnings (hard removal only)
- ❌ Backward compatibility (breaking change)
- ❌ Windows testing (defer to v1.10.1)
- ❌ Verbose mode `--verbose` flag (defer to v1.10.1)
- ❌ Help message enhancements beyond Commander.js defaults
- ❌ Performance benchmarking
- ❌ Codex global support (show warning, install locally)

## Timeline Estimate

Based on research analysis:

| Phase | Estimate | Notes |
|-------|----------|-------|
| Phase 1: Dependencies | 1 day | Simple installation |
| Phase 2: Flag System | 3-4 days | Core functionality, routing refactor |
| Phase 3: Interactive Menu | 2-3 days | Prompts integration |
| Phase 4: Platform Paths | 2-3 days | Path resolution, adapter updates |
| Phase 5: Messages | 2 days | Message manager extraction |
| Phase 6: Uninstall | 2-3 days | Feature parity with install |
| Phase 7: Testing | 3-4 days | Comprehensive test coverage |
| Phase 8: Documentation | 2-3 days | README, migration guide, CHANGELOG |

**Total: 17-23 days (~3-4 weeks)**

**Optimistic:** 3 weeks (experienced developer, no blockers)  
**Realistic:** 4 weeks (includes learning, testing, documentation)  
**Pessimistic:** 5 weeks (unforeseen complications, scope issues)

## Milestone Completion Criteria

Milestone is complete when:

- ✅ All 29 P0 requirements implemented
- ✅ All 8 phases complete with success criteria met
- ✅ >80% test coverage achieved
- ✅ Manual QA checklist completed (macOS + Linux)
- ✅ Documentation complete (README, MIGRATION.md, CHANGELOG.md)
- ✅ No P0 bugs open
- ✅ Pre-launch validation passed

**Pre-launch validation checklist:**
1. Install all platforms with new flags (manual test)
2. Install with old flags, verify error shown with migration guide link
3. Interactive menu selects multiple platforms correctly
4. CI/CD example script works (non-interactive)
5. Uninstall all platforms works
6. Migration guide examples tested
7. README examples tested

---

## Research Context

This roadmap is based on comprehensive research:

- **Technology stack**: Commander.js v14+ (argument parsing), Prompts v2.4+ (interactive menus)
- **Current architecture**: Monolithic install.js (1612 lines), strong adapter pattern, template system
- **Platform patterns**: Claude (local + global), Copilot (local + global), Codex (local only)
- **Scope changes**: Hard removal (not soft deprecation), uninstall now P0, Codex global not implemented

**Research files:**
- `.planning/research/v1.10.0/BRIEF.md` — Updated requirements (scope changes)
- `.planning/research/v1.10.0/SUMMARY.md` — Technology analysis and technical approach
- `.planning/research/v1.10.0/01-cli-frameworks.md` — Commander.js vs alternatives
- `.planning/research/v1.10.0/02-current-architecture.md` — Codebase analysis
- `.planning/research/v1.10.0/03-platform-patterns.md` — Platform-specific requirements
- `.planning/research/v1.10.0/04-migration-testing.md` — Testing and migration strategy

**Key findings from research:**
- Commander.js + Prompts is optimal stack (zero dependencies, clean API)
- Existing adapter pattern is solid foundation for refactoring
- 60+ discrete tasks across 8 implementation phases
- Single milestone is feasible with aggressive scope management
- Focus on unit/integration tests over brittle E2E tests

---

*Roadmap created: 2026-01-24*  
*Depth: Comprehensive*  
*Requirements: 29 (all P0)*  
*Coverage: 100%*
