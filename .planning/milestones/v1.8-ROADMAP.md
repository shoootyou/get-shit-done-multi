# Milestone v1.8: GSD Milestone & Codebase Management

**Status:** ✅ SHIPPED 2026-01-20
**Phases:** 1-4 (plus 2.1 inserted)
**Total Plans:** 9

## Overview

This roadmap delivers milestone archiving with full historical traceability and enhanced codebase mapping that excludes infrastructure directories. Starting with safe archive operations (Phase 1), we build the exclusion system for accurate codebase analysis (Phase 2), add discovery and recovery capabilities (Phase 3), and complete integration with existing workflows (Phase 4). The result is a complete milestone lifecycle: archive → map → restore → verify, enabling clean project evolution.

## Phases

### Phase 1: Archive Foundation
**Goal**: Users can safely archive completed milestones with full metadata preservation and git-based traceability
**Depends on**: Nothing (first phase)
**Requirements**: ARCH-01, ARCH-02, ARCH-03, ARCH-04, ARCH-05, ARCH-06, ARCH-07, ARCH-08, ARCH-09, ARCH-10, ARCH-11, ARCH-12
**Plans**: 3 plans

Plans:
- [x] 01-01-PLAN.md — Git utilities & transaction framework for atomic operations
- [x] 01-02-PLAN.md — Milestone registry management with archive tracking  
- [x] 01-03-PLAN.md — Archive milestone command + workflow with validation

**Status:** COMPLETE (2026-01-20)

### Phase 2: Codebase Mapping Enhancement
**Goal**: Codebase analysis accurately reflects application code only by excluding infrastructure and respecting .gitignore patterns
**Depends on**: Phase 1
**Requirements**: MAP-01, MAP-02, MAP-03, MAP-04, MAP-05, MAP-06, MAP-07, MAP-08, MAP-09, MAP-10
**Plans**: 2 plans

Plans:
- [x] 02-01-PLAN.md — Exclusion system: default patterns, .gitignore support, config file
- [x] 02-02-PLAN.md — Metrics & tree: file/line counts, directory tree visualization

**Status:** INCOMPLETE - Exclusions not enforced in practice (see Phase 2.1)

### Phase 2.1: Exclusion Enforcement (INSERTED)
**Goal**: Codebase mapping agents actually exclude infrastructure directories when exploring
**Depends on**: Phase 2
**Requirements**: FIX-01, FIX-02, FIX-03, FIX-04
**Plans**: 1 plan

Plans:
- [x] 02.1-01-PLAN.md — Fix exclusion enforcement: workflow builds list, passes to agents

**Why inserted:** Phase 2 implementation was incomplete. Exclusion patterns exist in agent instructions but workflow doesn't pass them to agents in spawn prompts. Agents ignore vague "see instructions" directive and scan all directories including GSD infrastructure.

**Status:** COMPLETE (2026-01-20)

### Phase 3: Discovery & Restore
**Goal**: Users can discover archived milestones and restore them if needed, providing safety valve for archiving operations
**Depends on**: Phase 2
**Requirements**: LIST-01, LIST-02, REST-01, REST-02, REST-03, REST-04
**Plans**: 2 plans

Plans:
- [x] 03-01-PLAN.md — List milestones: command + workflow to display archive registry
- [x] 03-02-PLAN.md — Restore milestone: command + workflow with validation and registry update

**Status:** COMPLETE (2026-01-20)

### Phase 4: Workflow Integration
**Goal**: Archive workflow integrates seamlessly with existing GSD workflows, providing smooth milestone transitions
**Depends on**: Phase 3
**Requirements**: INT-01, INT-02, INT-03, INT-04, INT-05
**Plans**: 1 plan

Plans:
- [x] 04-01-PLAN.md — Workflow integration: verify→archive suggestion, MILESTONES.md headers, atomic operations

**Status:** COMPLETE (2026-01-20)

---

## Milestone Summary

**Decimal Phases:**
- Phase 2.1: Exclusion Enforcement (inserted after Phase 2 to fix incomplete implementation)

**Key Decisions:**
- Archive to .planning/history/ (not .planning/archive/) — "history" clearly communicates chronological milestone progression
- Use milestone name for folder (not sequential numbers) — Descriptive names more meaningful
- Preserve .planning/codebase/ during archive — Keep most recent codebase map active
- Validate git clean state before archive — Safety-first: prevent accidental loss of uncommitted work
- Use built-in child_process instead of execa — Zero dependencies maintained for git utilities
- Return null from getActive() when no active milestone set — Graceful handling for callers
- Validate milestone ID format to prevent path traversal — Security protection
- Build exclusion list once in workflow (not in each agent) — Single source of truth prevents inconsistency
- Pass EXCLUDE_DIRS as explicit parameter in spawn prompts — Explicit parameter removes agent interpretation
- Display full MILESTONES.md table content (not custom formatting) — Preserves registry structure

**Issues Resolved:**
- Fixed exclusion enforcement in codebase mapping (Phase 2.1)
- Established atomic operations for archive safety
- Created milestone discovery and restore capabilities
- Integrated archive workflow with existing verify workflow

**Technical Debt Incurred:**
None significant - all planned functionality delivered and verified

---

*For current project status, see .planning/ROADMAP.md*
