---
phase: 05.2-function-level-inventory-bin
plan: 01b
subsystem: analysis
tags: [ast, complexity, side-effects, classifier, confidence, relationships, static-analysis]

# Dependency graph
requires:
  - phase: 05.2-01a
    provides: AST parser with dual-parser fallback strategy
provides:
  - I/O side effects detector (file_system, console, process_io, network_import)
  - 3-heuristic helper function classifier (scope + naming + usage)
  - Confidence calculator with deduction formula (start 100%, min 30%)
  - Relationships tracker for direct function calls
affects: [05.2-02, 05.2-03, analysis-pipeline, function-inventory]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "3-heuristic algorithm for helper detection (2+ matches = helper)"
    - "Deduction-based confidence scoring (start high, subtract penalties)"
    - "Direct call tracking only (Stage 1), transitive deferred to Stage 2"

key-files:
  created:
    - bin/lib/analysis/side-effects.js
    - bin/lib/analysis/classifier.js
    - bin/lib/analysis/relationships.js
    - bin/lib/analysis/confidence.js
  modified: []

key-decisions:
  - "I/O side effects only (file system, console, network) - NOT state mutations"
  - "3-heuristic helper detection: scope + naming + usage, 2+ matches = helper"
  - "Confidence deductions: dynamic requires -20%, unclear naming -10%, no JSDoc -5%, complex without docs -15%, unclear deps -10%"
  - "Direct call relationships only in Stage 1 (one level deep)"
  - "Minimum confidence score: 30%"

patterns-established:
  - "Side effects detection via AST traversal of member expressions"
  - "Multi-criteria classification with threshold-based decision making"
  - "Penalty-based scoring with floor constraints"
  - "Reverse dependency mapping via buildCalledByMap"

# Metrics
duration: 3.5min
completed: 2026-01-25
---

# Phase 05.2 Plan 01b: Advanced Analysis Utilities Summary

**4 advanced analysis utilities implementing resolved research questions: I/O side effects detector, 3-heuristic helper classifier, deduction-based confidence calculator, and direct call relationships tracker**

## Performance

- **Duration:** 3.5 min
- **Started:** 2026-01-25T16:29:40Z
- **Completed:** 2026-01-25T16:33:10Z
- **Tasks:** 3
- **Files modified:** 4

## Accomplishments
- Side effects detector finds I/O operations only (file_system, console, process_io, network_import)
- Classifier implements 3-heuristic algorithm with 2+ match threshold for helper detection
- Confidence calculator uses deduction formula starting at 100% with 5 penalty rules, minimum 30%
- Relationships tracker records direct function calls with reverse dependency mapping

## Task Commits

Each task was committed atomically:

1. **Task 1: Build side effects detector** - `0842718` (feat)
2. **Task 2: Build classifier and relationships** - `a5cb50f` (feat)
3. **Task 3: Build confidence calculator** - `9b42819` (feat)

## Files Created/Modified

**Created:**
- `bin/lib/analysis/side-effects.js` - Detects I/O operations via AST traversal (file system, console, process I/O, network imports)
- `bin/lib/analysis/classifier.js` - 3-heuristic helper function detection (scope + naming + usage) and complexity classification
- `bin/lib/analysis/relationships.js` - Direct call tracking with reverse dependency mapping
- `bin/lib/analysis/confidence.js` - Deduction-based confidence scoring with 5 penalty rules

## Decisions Made

**Resolved Research Question 2 - Helper Detection:**
- Implemented ALL THREE heuristics: scope (not exported), naming (helper patterns), usage (single caller)
- Decision rule: If 2+ heuristics match → classify as helper
- Naming patterns: starts with `_`, `internal`, `private`, `anonymous`, `arrow_`, ends with `helper`, `util`

**Resolved Research Question 3 - Confidence Calculation:**
- Start at 100% confidence, apply deductions for uncertainty indicators
- Dynamic requires/imports: -20% (hardest to analyze statically)
- Unclear/generic naming: -10% (temp, handle, process, etc.)
- No JSDoc comments: -5% (missing documentation)
- Complex control flow without docs: -15% (cyclomatic >= 10 undocumented)
- External dependencies without clear purpose: -10% (many deps, no purpose field)
- Minimum confidence: 30% (never go below this floor)

**Resolved Research Question 4 - Call Site Analysis:**
- Stage 1: Direct calls only (one level deep)
- Record function names called directly via CallExpression nodes
- Build reverse dependency map (called_by) for helper detection
- Transitive call analysis deferred to Stage 2

**Side Effects Scope:**
- I/O operations ONLY per CONTEXT.md
- Tracked: file system (fs/fse/fsExtra), console, process I/O (stdout/stderr), network modules (http/https/net/axios/etc.)
- NOT tracked: state mutations, global variables (explicitly out of scope)

## Deviations from Plan

None - plan executed exactly as written. All utilities implemented according to resolved research questions.

## Issues Encountered

**Note on complexity.js:**
During verification, discovered that `complexity.js` was supposed to be created in Plan 01a but wasn't initially present. However, by the time final verification ran, the file existed and all tests passed. This appears to have been resolved by Plan 01a execution completing after this plan started.

All 6 analysis utilities now present and working:
- ast-parser.js (from Plan 01a)
- complexity.js (from Plan 01a)
- side-effects.js (Plan 01b)
- classifier.js (Plan 01b)
- confidence.js (Plan 01b)
- relationships.js (Plan 01b)

## Next Phase Readiness

**Analysis infrastructure complete** - All foundation and advanced utilities ready:
- ✅ AST parsing with dual-parser fallback (@babel/parser + acorn)
- ✅ Complexity calculation with hardcoded thresholds (Simple < 5, Moderate 5-9, Complex >= 10)
- ✅ I/O side effects detection
- ✅ Helper function classification
- ✅ Confidence scoring
- ✅ Direct call relationship tracking

**Ready for Plan 02:** Can now analyze all functions in `bin/**` and generate function-level documentation using these utilities.

**No blockers** - Full analysis pipeline ready for production use.

---
*Phase: 05.2-function-level-inventory-bin*
*Completed: 2026-01-25*
