---
phase: 01-core-installer
plan: 03
type: execute
wave: 3
depends_on: ["01-01", "01-02"]
files_modified: []
autonomous: false
must_haves:
  observables:
    - "Installation completes successfully in /tmp test directory"
    - "Template variables replaced correctly in installed files"
    - "Manifest written with correct version and metadata"
    - "Installation completes in <30 seconds"
    - "Help and version flags display correctly"
  artifacts:
    - None (testing plan)
  wiring:
    - Complete installation flow works end-to-end
    - All modules integrate correctly
  key_links:
    - User can run npx get-shit-done-multi --claude and get working installation
---

# Plan 03: Integration Testing & Verification

**Objective:** Test complete installation flow in isolated /tmp environment and verify all success criteria

## Context

This plan tests the complete installer built in Plans 01-02:
- Integration test in /tmp (per testing constraints)
- Verify template rendering works
- Verify file operations create correct structure
- Human verification checkpoint for final approval

**CRITICAL:** All testing MUST happen in /tmp directory, never in source directory.

Per TEST-01 and TEST-02 requirements:
- Execute under /tmp with unique folder
- Never modify source files
- Clean up after successful tests

## Tasks

<task name="integration-test" type="auto">
  <files>None (testing only)</files>
  <action>
Run integration test in isolated /tmp environment:

**1. Create test environment**
```bash
# Create unique test directory in /tmp
TEST_DIR="/tmp/gsd-test-$(date +%s)"
mkdir -p "$TEST_DIR"
cd "$TEST_DIR"

echo "Test directory: $TEST_DIR"
```

**2. Install locally from source**
```bash
# Copy source to test location (simulate npx behavior)
SOURCE_DIR="$(pwd)"  # Original source location
cp -r "$SOURCE_DIR" "$TEST_DIR/package"
cd "$TEST_DIR/package"

# Install dependencies
npm install

echo "✓ Dependencies installed in test environment"
```

**3. Run installation with --claude flag**
```bash
# Create mock Claude directory in test environment (not real home)
MOCK_HOME="$TEST_DIR/mock-home"
mkdir -p "$MOCK_HOME"

# Override HOME for test (safe because we're in /tmp)
HOME="$MOCK_HOME" node bin/install.js --claude

echo "✓ Installation completed"
```

**4. Verify directory structure**
```bash
# Check skills directory created
test -d "$MOCK_HOME/.claude/skills/gsd" && echo "✓ Skills directory exists"

# Check shared directory created
test -d "$MOCK_HOME/.claude/get-shit-done" && echo "✓ Shared directory exists"

# List created files
echo "Installed files:"
find "$MOCK_HOME/.claude" -type f
```

**5. Verify template rendering**
```bash
# Check variables were replaced (no {{VARIABLES}} should remain)
if grep -r '{{[A-Z_]*}}' "$MOCK_HOME/.claude" 2>/dev/null; then
  echo "✗ ERROR: Unreplaced variables found"
  exit 1
else
  echo "✓ All template variables replaced"
fi

# Check specific variable replacements
grep "Version: 2.0.0" "$MOCK_HOME/.claude/skills/gsd/gsd-new-project.md" && echo "✓ VERSION replaced"
grep "Platform: claude" "$MOCK_HOME/.claude/skills/gsd/gsd-new-project.md" && echo "✓ PLATFORM_NAME replaced"
```

**6. Verify manifest**
```bash
# Check manifest exists and is valid JSON
MANIFEST="$MOCK_HOME/.claude/get-shit-done/.gsd-install-manifest.json"
test -f "$MANIFEST" && echo "✓ Manifest exists"

# Validate JSON syntax
node -e "JSON.parse(require('fs').readFileSync('$MANIFEST', 'utf-8'))" && echo "✓ Manifest is valid JSON"

# Check manifest content
node -e "
const m = JSON.parse(require('fs').readFileSync('$MANIFEST', 'utf-8'));
console.log('Manifest version:', m.version);
console.log('Manifest platform:', m.platform);
console.log('Manifest installedBy:', m.installedBy);
"
```

**7. Time the installation**
```bash
# Test installation speed
time HOME="$MOCK_HOME" node bin/install.js --claude

# Should complete in <30 seconds per success criteria
```

**8. Test CLI flags**
```bash
# Test help flag
node bin/install.js --help

# Test version flag
node bin/install.js --version

# Test invalid flag (should suggest correction)
node bin/install.js --clude || echo "Expected error for invalid flag"

# Test no-color flag
node bin/install.js --help --no-color | grep -q "get-shit-done-multi" && echo "✓ --no-color works"
```

**9. Clean up successful test**
```bash
# If all tests passed, clean up
cd /
rm -rf "$TEST_DIR"
echo "✓ Test cleanup complete"
```

**Note:** If test fails, leave $TEST_DIR for debugging inspection.
  </action>
  <verify>
    ```bash
    # Final verification commands (run after test completes)
    
    # Check no source files were modified
    git status --porcelain | grep -v "\.planning/" && echo "✗ Source files modified!" || echo "✓ Source files untouched"
    
    # Verify all required exports exist
    node -e "
    Promise.all([
      import('./bin/lib/paths/path-resolver.js'),
      import('./bin/lib/io/file-operations.js'),
      import('./bin/lib/rendering/template-renderer.js'),
      import('./bin/lib/installer.js')
    ]).then(() => console.log('✓ All modules importable'))
    "
    ```
  </verify>
  <done>
    - Integration test passes in /tmp
    - Template variables all replaced
    - Manifest created with correct metadata
    - Installation completes in <30 seconds
    - CLI flags work correctly
    - Source files unmodified
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 1 installer with:
- NPX entry point (bin/install.js)
- Core modules (paths, file-operations, template-renderer)
- Installation orchestrator
- Template system with variable replacement
- CLI flags (--claude, --help, --version, --no-color)
  </what-built>
  <how-to-verify>
**Test the actual installation flow:**

1. **Run the installer** (from source directory):
   ```bash
   # In your actual Claude Code environment
   npx . --claude
   ```

2. **Check installation worked:**
   ```bash
   # Verify skills installed
   ls ~/.claude/skills/gsd/
   
   # Should see: gsd-new-project.md, gsd-planner.md (or similar templates)
   ```

3. **Check shared resources:**
   ```bash
   ls ~/.claude/get-shit-done/
   
   # Should see: .gsd-install-manifest.json and other resources
   ```

4. **Verify template rendering:**
   ```bash
   cat ~/.claude/skills/gsd/gsd-new-project.md
   
   # Should see:
   # - Version: 2.0.0 (not {{VERSION}})
   # - Platform: claude (not {{PLATFORM_NAME}})
   # - Your username (not {{USER}})
   ```

5. **Check manifest:**
   ```bash
   cat ~/.claude/get-shit-done/.gsd-install-manifest.json
   
   # Should be valid JSON with:
   # - version: "2.0.0"
   # - platform: "claude"
   # - installedAt: ISO timestamp
   # - installedBy: your username
   ```

6. **Test help/version:**
   ```bash
   npx . --help
   npx . --version
   ```

7. **Test error handling:**
   ```bash
   # Should show error for missing platform flag
   npx .
   
   # Should suggest correction for typo
   npx . --clude
   ```

**Success indicators:**
- ✓ Installation completes without errors
- ✓ All template variables replaced (no {{...}} in output)
- ✓ Skills appear in ~/.claude/skills/gsd/
- ✓ Shared resources in ~/.claude/get-shit-done/
- ✓ Manifest is valid JSON with correct metadata
- ✓ Help and version flags work
- ✓ Colored output appears (unless --no-color)

**If issues found:**
- Describe what went wrong
- Include error messages
- Note which step failed
  </how-to-verify>
  <resume-signal>
Type "approved" if installation works correctly, or describe issues found.
  </resume-signal>
</task>

## Verification

**Pre-flight checks:**
```bash
# All modules exist
ls bin/lib/paths/path-resolver.js
ls bin/lib/io/file-operations.js
ls bin/lib/rendering/template-renderer.js
ls bin/lib/installer.js
ls bin/install.js

# Entry point is executable
test -x bin/install.js && echo "✓ Executable"

# Templates exist
ls templates/skills/gsd-new-project.md
ls templates/agents/gsd-planner.md

# Dependencies installed
npm list fs-extra chalk commander --depth=0
```

**Success Criteria Checklist:**

From ROADMAP.md Phase 1 success criteria:
- [ ] User runs `npx get-shit-done-multi --claude` → installs to `~/.claude/skills/gsd/`
- [ ] Shared directory copies to `.claude/get-shit-done/` with manifest template
- [ ] Template variables replaced correctly in output files
- [ ] Installation completes in <30 seconds
- [ ] `--help` and `--version` show correct information
- [ ] Version displays as 2.0.0

From CONTEXT.md additional criteria:
- [ ] Progress shows moderate detail (step-based with checkmarks)
- [ ] Success message includes next steps
- [ ] Errors include actionable fix suggestions
- [ ] Colors auto-detect with `--no-color` override
- [ ] Missing directories created automatically
- [ ] Existing files overwritten silently
- [ ] Symlinks generate warning but continue
- [ ] Permission errors fail with clear message
- [ ] Invalid flags suggest closest match
- [ ] Template validation happens before file writes

From TEST requirements:
- [ ] ALL tests execute in /tmp directory (not source)
- [ ] Each test has unique isolated folder
- [ ] Source files never modified during testing

## Success Criteria

- [ ] Integration test passes in /tmp environment
- [ ] Template variables all replaced (no {{...}} in output)
- [ ] Manifest created with correct version, platform, user
- [ ] Installation completes in <30 seconds
- [ ] --help shows usage information
- [ ] --version shows 2.0.0
- [ ] Progress messages show with colored checkmarks
- [ ] Success message includes next steps
- [ ] Human verification checkpoint passed
- [ ] Source files remain unmodified after testing

## Output

**Validated:**
- Complete installation flow works end-to-end
- Template system renders variables correctly
- CLI flags behave as specified
- Testing constraints honored (only /tmp used)

**Ready for:** Phase 2 (Multi-Platform Support)
