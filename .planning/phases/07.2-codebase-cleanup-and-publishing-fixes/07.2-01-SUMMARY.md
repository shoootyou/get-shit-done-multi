---
phase: 07.2-codebase-cleanup-and-publishing-fixes
plan: 01
subsystem: publishing
tags: [npm, package.json, node, publishing]

# Dependency graph
requires:
  - phase: 07.1-pre-flight-validation-refactor
    provides: Centralized validation system
provides:
  - Fixed npm publishing configuration (files array, prepublishOnly script, Node version)
  - templates/ directory now included in published package
  - Node 20 requirement enforced
affects: [npm-publish, deployment, package-distribution]

# Tech tracking
tech-stack:
  added: []
  patterns: []

key-files:
  created: []
  modified:
    - package.json
    - README.md

key-decisions:
  - "Use npm default behavior - only specify non-standard directories (templates/, bin/)"
  - "Update to Node 20 (current LTS until October 2026)"

patterns-established: []

# Metrics
duration: 2min
completed: 2026-01-29
---

# Phase 7.2 Plan 01: Critical Publishing Fixes Summary

**Fixed three critical npm publishing bugs: added missing templates/ to files array, removed broken prepublishOnly script, and updated Node requirement to 20**

## Performance

- **Duration:** 2 min
- **Started:** 2026-01-29T18:04:44Z
- **Completed:** 2026-01-29T18:06:57Z
- **Tasks:** 4
- **Files modified:** 2

## Accomplishments
- **CRITICAL:** Added templates/ to files array (was missing - published package would be non-functional)
- Removed broken prepublishOnly script that would cause npm publish to fail
- Updated Node.js requirement from EOL version 16 to LTS version 20
- Cleaned up README with clear Node 20 requirements

## Task Commits

Each task was committed atomically:

1. **Task 1: Fix package.json files array** - `96f85a3` (fix)
   - Added templates/ to files array (CRITICAL - was missing)
   - Removed 7 wrong entries (commands, get-shit-done, agents, hooks, lib-ghcc, docs, github)
   
2. **Task 2: Remove prepublishOnly script** - `a6f46e5` (fix)
   - Removed script referencing non-existent scripts/build-templates.js
   - Orphaned from Phase 1 planning
   
3. **Task 3: Update Node version requirement** - `cab8404` (fix)
   - Updated engines.node from >=16.7.0 to >=20.0.0
   - Node 16 EOL, Node 20 current LTS
   
4. **Task 4: Update README Node version** - `3b0dc5a` (docs)
   - Added Requirements section with Node.js 20+ requirement
   - Explained Node 16 EOL and Node 20 LTS status

## Files Created/Modified
- `package.json` - Fixed files array (added templates/, removed wrong entries), removed prepublishOnly script, updated engines.node to >=20.0.0
- `README.md` - Added Requirements section with Node.js 20+ requirement

## Decisions Made

1. **Use npm default behavior for common files**
   - Only specify non-standard directories (bin/, templates/) in files array
   - npm auto-includes: package.json, README, LICENSE, CHANGELOG
   - Rationale: Simpler maintenance, follows npm conventions
   
2. **Update to Node 20 (current LTS)**
   - Node 16 is EOL (no security updates since September 2023)
   - Node 20 is Active LTS until October 2026
   - All project APIs stable in both versions (no code changes needed)
   - Rationale: Security updates, better long-term support

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None - all changes were straightforward configuration fixes.

## User Setup Required

None - no external service configuration required.

## Verification

All verification checks passed:
- ✅ package.json files array contains exactly ["bin", "templates"]
- ✅ templates/ included in files array (was missing - CRITICAL fix)
- ✅ prepublishOnly script removed
- ✅ engines field requires Node >=20.0.0
- ✅ README references Node 20+ requirement
- ✅ npm pack --dry-run succeeds without errors
- ✅ templates/ directory appears in npm pack output (127+ template files)
- ✅ npm install --dry-run validates package.json syntax

## Next Phase Readiness

- Package.json is now correctly configured for npm publishing
- Critical bug fixed: templates/ will now be included in published package
- Ready for subsequent codebase cleanup and error handling improvements
- No blockers for continuing Phase 7.2 plans

## Impact

**CRITICAL:** Without the templates/ fix, any published package would be completely non-functional. Users would run `npx get-shit-done-multi` and get nothing - no skills, no agents, no functionality. This was the highest priority fix.

The prepublishOnly fix prevents npm publish from failing immediately with "Cannot find module".

The Node 20 update ensures users run on a supported, secure runtime.

---
*Phase: 07.2-codebase-cleanup-and-publishing-fixes*
*Completed: 2026-01-29*
