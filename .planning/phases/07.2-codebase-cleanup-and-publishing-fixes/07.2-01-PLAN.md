---
phase: 07.2-codebase-cleanup-and-publishing-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - README.md
autonomous: true
must_haves:
  - npm publish succeeds without script errors
  - Published package includes templates/ and bin/ directories  
  - Package requires Node >=20.0.0 in engines field
  - package.json files array contains only bin and templates
  - prepublishOnly script removed or commented out
---

# Phase 7.2 Plan 01: Critical Publishing Fixes

## Objective

Fix critical npm publishing configuration bugs in package.json that prevent successful publishing: add missing templates/ directory to files array, remove broken prepublishOnly script, and update Node.js version requirement to 20.

## Context

**Current state:** package.json has 3 critical bugs identified in research:
1. **prepublishOnly script (line 37)** references non-existent scripts/build-templates.js
2. **files array (lines 46-54)** is MISSING templates/ (critical - templates won't be published) and has 7 wrong entries (commands/, get-shit-done/, agents/, hooks/, lib-ghcc/, docs/, github/)
3. **Node version (line 57)** is still at >=16.7.0 (EOL since 2023)

**Why wave 1:** These fixes must happen first - package.json is referenced in all subsequent work. Without these fixes, npm publish will fail.

**From research (RESEARCH.md):**
- templates/ missing is CRITICAL BUG - published package would be non-functional
- prepublishOnly references orphaned Phase 1 script that was never created
- Node 16 is EOL (no security updates), Node 20 is current LTS until October 2026
- All fixes are one-line changes but HIGH IMPACT

**From decisions (CONTEXT.md):**
- Use npm default behavior - only specify non-standard directories (templates/, bin/)
- npm auto-includes: package.json, README, LICENSE, CHANGELOG
- Node 20: no breaking changes for this codebase, just update engines field

## Tasks

<task name="fix-package-json-files-array" type="auto">
  <files>package.json</files>
  <action>
Replace the entire "files" array (lines 46-54) with correct entries:

**Remove these wrong entries:**
- "commands" (doesn't exist)
- "get-shit-done" (dev tooling, not for publishing)
- "agents" (doesn't exist)  
- "hooks" (git hooks, dev tooling)
- "lib-ghcc" (doesn't exist)
- "docs" (doesn't exist)
- "github" (doesn't exist)

**Keep only:**
- "bin" (executable entry point - already present)
- "templates" (core functionality - ADD THIS, currently missing)

New files array:
```json
"files": [
  "bin",
  "templates"
],
```

**Why only these two:**
- bin/ = executable entry point (install.js with shebang)
- templates/ = the actual skills/agents to install (core functionality)
- npm auto-includes: package.json, README, LICENSE, CHANGELOG (no need to list)
- Everything else is development tooling or doesn't exist

**Critical:** templates/ is currently MISSING - without it, published package cannot copy files to user platforms (completely non-functional).
  </action>
  <verify>
```bash
# Verify files array contains only bin and templates
grep -A 3 '"files"' package.json

# Expected output:
# "files": [
#   "bin",
#   "templates"
# ],
```
  </verify>
  <done>package.json files array contains only ["bin", "templates"]</done>
</task>

<task name="remove-prepublishonly-script" type="auto">
  <files>package.json</files>
  <action>
Remove the prepublishOnly script from package.json (line ~37):

**Current:**
```json
"prepublishOnly": "node scripts/build-templates.js",
```

**Problem:** scripts/build-templates.js never existed (orphaned from Phase 1 planning). Git history confirms file was never created. npm publish will fail with "Cannot find module".

**Resolution:** DELETE the entire line.

**Why remove entirely:**
- templates/ already exists in final form (no build step needed)
- Migration from .github/ to /templates/ was done in Phase 1
- This script reference is orphaned - was planned but never implemented
- No build step is required for this package

**After removal:** npm publish will proceed without trying to run non-existent script.
  </action>
  <verify>
```bash
# Verify prepublishOnly line is removed
grep "prepublishOnly" package.json

# Expected: no output (line removed)
echo $?  # Should be 1 (grep found nothing)
```
  </verify>
  <done>prepublishOnly line removed from package.json scripts section</done>
</task>

<task name="update-node-version-requirement" type="auto">
  <files>package.json</files>
  <action>
Update Node.js version requirement in engines field (line ~57):

**Current:**
```json
"engines": {
  "node": ">=16.7.0"
}
```

**Problem:** Node 16 is EOL (end-of-life September 2023, LTS ended April 2024)
- No security updates
- Current LTS is Node 20 (Active until October 2026)

**Resolution:** Update to Node 20:
```json
"engines": {
  "node": ">=20.0.0"
}
```

**Why Node 20:**
- Active LTS until October 2026
- All project APIs are stable in both Node 18 and 20
- No breaking changes for this codebase (verified in research)
- No code changes needed (APIs already compatible)

**Confidence:** HIGH - Research confirms no deprecated APIs used, all fs/promises, path, os APIs stable since Node 16.
  </action>
  <verify>
```bash
# Verify engines field updated to Node 20
grep -A 1 '"engines"' package.json | grep "node"

# Expected output:
#   "node": ">=20.0.0"
```
  </verify>
  <done>package.json engines field requires Node >=20.0.0</done>
</task>

<task name="update-readme-node-version" type="auto">
  <files>README.md</files>
  <action>
Update any Node.js version references in README.md from "Node 16" or "Node.js 16+" to "Node.js 20+".

Search for patterns:
- "Node 16"
- "Node.js 16"
- ">=16"
- "Node 16.7"
- "Node.js 16.7"

Replace with:
- "Node 20" or "Node.js 20+"
- ">=20"
- "Node 20.0"

If README has installation instructions or requirements section, update there.

**If no version references found in README:** Add a requirements section mentioning Node 20 requirement.
  </action>
  <verify>
```bash
# Verify no references to Node 16 remain
grep -i "node.*16" README.md

# Expected: no output (or exit code 1)

# Verify Node 20 mentioned
grep -i "node.*20" README.md

# Expected: at least one match showing requirement
```
  </verify>
  <done>README.md updated to reference Node 20 requirement</done>
</task>

## Success Criteria

- [ ] package.json files array contains exactly ["bin", "templates"]
- [ ] templates/ directory is included in files array (CRITICAL - was missing)
- [ ] No wrong entries in files array (commands, get-shit-done, agents, hooks, lib-ghcc, docs, github removed)
- [ ] prepublishOnly script line removed from package.json
- [ ] package.json engines field requires "node": ">=20.0.0"
- [ ] README.md references Node 20+ (no Node 16 mentions)
- [ ] All changes committed with descriptive message
- [ ] npm pack --dry-run succeeds without errors

## Verification Commands

```bash
# Verify package.json changes
grep -A 3 '"files"' package.json
grep '"prepublishOnly"' package.json  # Should return nothing
grep -A 1 '"engines"' package.json

# Verify npm pack would succeed
npm pack --dry-run

# Verify no obvious syntax errors
node -c package.json  # Actually, JSON files don't need this
npm install --dry-run  # This will validate package.json syntax
```

## Output

**Files modified:**
- package.json (files array fixed, prepublishOnly removed, engines updated)
- README.md (Node version references updated)

**Git commit message:**
```
fix(publishing): fix critical package.json bugs for npm publish

- Add templates/ to files array (was missing - CRITICAL)
- Remove wrong files array entries (commands, get-shit-done, agents, hooks, lib-ghcc, docs, github)
- Remove broken prepublishOnly script (scripts/build-templates.js doesn't exist)
- Update Node requirement to >=20.0.0 (Node 16 is EOL)
- Update README to reference Node 20

Fixes 3 critical bugs identified in Phase 7.2 research:
1. templates/ missing from published package (non-functional)
2. prepublishOnly fails on npm publish (script doesn't exist)
3. Node 16 EOL (no security updates)

Addresses success criteria: SC1, SC2, SC10
Phase: 07.2-codebase-cleanup-and-publishing-fixes
```

---

**Next:** Plan 02 (Wave 2) - Code Cleanup and Error Handling
