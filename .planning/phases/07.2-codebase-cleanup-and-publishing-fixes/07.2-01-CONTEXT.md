# Phase 7.2: Codebase Cleanup and Publishing Fixes - Context

**Gathered:** 2026-01-29
**Status:** Ready for planning

<domain>
## Phase Boundary

Fix npm publishing configuration to ensure templates/ and bin/ are correctly included. Remove obsolete code from early phases (template renderer, audit-functions.*). Update tests to match current implementation. Clean up TODO comments in version detection. Update project to Node 20 minimum. Audit and clean environment variable usage. Ensure bin/install.js works with minimal dependencies post-publish.

</domain>

<decisions>
## Implementation Decisions

### Publishing Package Scope
- .github/ NOT included in npm package (it's the OUTPUT when users install, not an input)
- Use npm default "files" field behavior (empty) - npm auto-includes package.json, README, LICENSE, CHANGELOG
- Explicitly specify only non-standard directories needed: templates/ and bin/
- Validate with npm pack → extract to /tmp → test bin/install.js execution
- Test both interactive and non-interactive install modes post-pack
- Simulate full npx execution flow (not just local test)

### Development Tooling Cleanup
- DELETE unused dev tooling from repo: hooks/, scripts/, docker files, coverage/ (can recover from git history)
- KEEP tests/ directory - actively used for validation and CI/CD
- Analyze each root folder before deletion:
  - hooks/ → delete if unused
  - scripts/ → delete if not referenced in package.json
  - coverage/ → delete (generated artifacts)
  - docker-compose.yml, Dockerfile → delete if unused

### Obsolete Code Removal Strategy
- Delete immediately - git history preserves everything
- Separate commits per concern: renderer, audit-functions, TODOs, tests
- Atomic deletions: code + its tests in same commit
- Concerns to remove:
  1. Broken template renderer (early phase artifact)
  2. audit-functions.* files from root (json, md, all variants)
  3. Scripts and tests related to audit-functions
  4. Obsolete test cases no longer relevant

### TODO Comments Resolution
- UPDATE comments to explain current implementation (don't delete)
- For version detection TODOs: replace with explanation of what was decided
- Format: "// Previously TODO: X. Current implementation: Y because Z"
- Preserve context for future maintainers

### Error Handling Philosophy
- Fail fast - let errors bubble up with context
- Add specific error code checks for file system errors only: ENOENT, EACCES, EEXIST
- Empty catch blocks → add specific error handling with clear messages
- Format: `ENOENT → 'File not found: {path}'`, `EACCES → 'Permission denied: {path}'`
- Throw immediately with formatted message (no error collection)
- Other error types (network, unexpected) remain generic "something went wrong"

### Environment Variable Hygiene
- Remove ALLOW_SYMLINKS entirely - no production use case
- Policy: No env vars - all behavior via CLI flags or config
- Exception: Standard Node.js vars (NODE_ENV, DEBUG) are acceptable
- Audit ALL process.env usage in codebase
- Case-by-case review for each env var found:
  - ALLOW_SYMLINKS → delete
  - NODE_ENV → keep (standard)
  - DEBUG → keep (standard)
  - Others → evaluate individually
- No migration path needed - no public API contract

### Node.js Version
- Update package.json engines field to Node 20 minimum
- Update any documentation referencing Node version requirements
- No code changes needed - already compatible

### Claude's Discretion
- Exact order of deletion commits (as long as logically grouped)
- Specific error message wording (as long as clear and actionable)
- Decision on which scripts/ files to keep vs delete (analyze usage)
- npm pack test script location (can be in tests/ or standalone)

</decisions>

<specifics>
## Specific Ideas

- "The goal is have only templates/ and bin/ and maybe other node files from root"
- ".github will be the output of this project, if exists in this project it's because we're using the project to improve the project"
- "Could we test in a isolated folder under /tmp copying only the necessary files and confirm with that?"
- "Aparece un TODO pero ya estamos en la fase posterior" (TODO exists but we're already past that phase)
- Test strategy: npm pack → extract → run install.js → verify it works

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope. All identified concerns are in scope for Phase 7.2.

</deferred>

---

*Phase: 07.2-codebase-cleanup-and-publishing-fixes*
*Context gathered: 2026-01-29*
