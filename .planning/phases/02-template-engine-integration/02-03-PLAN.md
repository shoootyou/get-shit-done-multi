---
phase: 02-template-engine-integration
plan: 03
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - bin/install.js
autonomous: true
must_haves:
  goal: "Wire skill generation into all 3 platform installers"
  truths:
    - installClaude() calls generateSkillsFromSpecs() after agent generation
    - installCopilot() calls generateSkillsFromSpecs() for local installation
    - installCodex() calls generateSkillsFromSpecs() for global and local modes
    - Generated skills write to platform-specific directories (dirs.skills)
    - Installation reports skill generation results (generated/failed counts)
  artifacts:
    - bin/install.js with integrated skill generation in all 3 platforms
  wiring:
    - installClaude() → generateSkillsFromSpecs(specs/skills, dirs.skills, 'claude')
    - installCopilot() → generateSkillsFromSpecs(specs/skills, dirs.skills, 'copilot')
    - installCodex() → generateSkillsFromSpecs(specs/skills, dirs.skills, 'codex')
  key_links:
    - All installers call generateSkillsFromSpecs() from Plan 02-01
---

# Phase 2 Plan 03: Platform Integration

**Objective:** Integrate generateSkillsFromSpecs() into installClaude(), installCopilot(), and installCodex() functions

## Context

Plan 02-01 created generateSkillsFromSpecs() function. Now we wire it into all 3 platform installers, mirroring how generateAgentsFromSpecs() is currently integrated. Each platform installer needs to:

1. Call generateSkillsFromSpecs() after agent generation
2. Use correct paths (specs/skills → dirs.skills)
3. Report generation results

**From codebase analysis:**
- installClaude(): Line ~560 calls generateAgentsFromSpecs()
- installCopilot(): Line ~440 calls generateAgentsFromSpecs()
- installCodex(): Multiple locations (local and global modes)

## Tasks

<task name="integrate-claude-skill-generation" type="auto">
  <files>bin/install.js</files>
  <action>
Add skill generation to installClaude() function (around line 560).

**Pattern to follow:**
```javascript
// Existing agent generation (keep this):
const genResult = generateAgentsFromSpecs(specsDir, dirs.agents, 'claude');

if (genResult.failed > 0) {
  console.log(`  ${yellow}⚠${reset} Agents: ${genResult.generated} generated, ${genResult.failed} failed`);
} else {
  console.log(`  ${green}✓${reset} Agents: ${genResult.generated} generated`);
}

// ADD AFTER agent generation:
// Generate skills from specs
const skillSpecsDir = path.join(__dirname, '../specs/skills');
const skillGenResult = generateSkillsFromSpecs(skillSpecsDir, dirs.skills, 'claude');

if (skillGenResult.failed > 0) {
  console.log(`  ${yellow}⚠${reset} Skills: ${skillGenResult.generated} generated, ${skillGenResult.failed} failed`);
  // Log specific errors if any
  if (skillGenResult.errors.length > 0) {
    skillGenResult.errors.forEach(err => {
      console.log(`    ${yellow}✗${reset} ${err.file || 'Unknown'}: ${err.error}`);
    });
  }
} else {
  console.log(`  ${green}✓${reset} Skills: ${skillGenResult.generated} generated`);
}
```

**Key points:**
- Place after agent generation (skills use same pipeline)
- Use skillSpecsDir = `path.join(__dirname, '../specs/skills')`
- Write to dirs.skills (not dirs.agents)
- Platform is 'claude'
- Match error reporting pattern from agents
  </action>
  <verify>
```bash
# Verify Claude installer calls skill generation
grep -A 10 "generateSkillsFromSpecs.*claude" bin/install.js | head -15

# Check it uses correct paths
grep "specs/skills" bin/install.js | grep -v "^//"
```
  </verify>
  <done>
- installClaude() calls generateSkillsFromSpecs() for Claude platform
- Uses specs/skills directory as source
- Writes to dirs.skills output directory
- Reports generation results with error details
  </done>
</task>

<task name="integrate-copilot-skill-generation" type="auto">
  <files>bin/install.js</files>
  <action>
Add skill generation to installCopilot() function (around line 440).

**Pattern:**
```javascript
// After existing agent generation:
const genResult = generateAgentsFromSpecs(specsDir, destDir, 'copilot');

// ADD skill generation:
const skillSpecsDir = path.join(__dirname, '../specs/skills');
const skillDestDir = path.join(dotGithubDir, 'copilot', 'skills');
fs.mkdirSync(skillDestDir, { recursive: true });

const skillGenResult = generateSkillsFromSpecs(skillSpecsDir, skillDestDir, 'copilot');

if (skillGenResult.failed > 0) {
  console.log(`  ${yellow}⚠${reset} Skills: ${skillGenResult.generated} generated, ${skillGenResult.failed} failed`);
} else {
  console.log(`  ${green}✓${reset} Skills: ${skillGenResult.generated} generated`);
}
```

**Copilot-specific notes:**
- Skills go to `.github/copilot/skills/` (not .github/copilot/agents/)
- Ensure directory created before generation
- Platform is 'copilot'
  </action>
  <verify>
```bash
# Verify Copilot installer calls skill generation
grep -A 10 "generateSkillsFromSpecs.*copilot" bin/install.js | head -15

# Check Copilot skills directory
grep "copilot/skills" bin/install.js
```
  </verify>
  <done>
- installCopilot() calls generateSkillsFromSpecs() for Copilot platform
- Creates .github/copilot/skills/ directory
- Writes generated skills to correct location
- Reports generation results
  </done>
</task>

<task name="integrate-codex-skill-generation" type="auto">
  <files>bin/install.js</files>
  <action>
Add skill generation to installCodex() and installCodexGlobal() functions.

**For installCodex() (local mode, around line 680):**
```javascript
// After agent generation:
const genResult = generateAgentsFromSpecs(specsDir, destDir, 'codex');

// ADD skill generation:
const skillSpecsDir = path.join(__dirname, '../specs/skills');
const skillDestDir = path.join(dotCodexDir, 'skills');
fs.mkdirSync(skillDestDir, { recursive: true });

const skillGenResult = generateSkillsFromSpecs(skillSpecsDir, skillDestDir, 'codex');

if (skillGenResult.failed > 0) {
  console.log(`  ${yellow}⚠${reset} Skills: ${skillGenResult.generated} generated, ${skillGenResult.failed} failed`);
} else {
  console.log(`  ${green}✓${reset} Skills: ${skillGenResult.generated} generated`);
}
```

**For installCodexGlobal() (global mode, around line 780):**
```javascript
// After agent generation:
const genResult = generateAgentsFromSpecs(specsDir, destDir, 'codex');

// ADD skill generation:
const skillSpecsDir = path.join(__dirname, '../specs/skills');
const skillDestDir = path.join(homeCodexDir, 'skills');
fs.mkdirSync(skillDestDir, { recursive: true });

const skillGenResult = generateSkillsFromSpecs(skillSpecsDir, skillDestDir, 'codex');

if (skillGenResult.failed > 0) {
  console.log(`  ${yellow}⚠${reset} Skills: ${skillGenResult.generated} generated, ${skillGenResult.failed} failed`);
} else {
  console.log(`  ${green}✓${reset} Skills: ${skillGenResult.generated} generated`);
}
```

**Codex-specific notes:**
- Local mode: `.codex/skills/`
- Global mode: `~/.codex/skills/`
- Both use platform 'codex'
  </action>
  <verify>
```bash
# Verify both Codex installers call skill generation
grep -A 5 "generateSkillsFromSpecs.*codex" bin/install.js

# Check Codex skills directories
grep "\.codex/skills" bin/install.js
```
  </verify>
  <done>
- installCodex() calls generateSkillsFromSpecs() for local installation
- installCodexGlobal() calls generateSkillsFromSpecs() for global installation
- Both write to correct platform-specific directories
- Both report generation results
  </done>
</task>

## Verification

```bash
# Verify all 3 platforms integrated
node -e "
  const fs = require('fs');
  const content = fs.readFileSync('bin/install.js', 'utf8');
  
  const claudeIntegrated = content.includes(\"generateSkillsFromSpecs(skillSpecsDir, dirs.skills, 'claude')\");
  const copilotIntegrated = content.includes(\"generateSkillsFromSpecs(skillSpecsDir, skillDestDir, 'copilot')\");
  const codexIntegrated = content.includes(\"generateSkillsFromSpecs(skillSpecsDir, skillDestDir, 'codex')\");
  
  console.log('Claude integrated:', claudeIntegrated);
  console.log('Copilot integrated:', copilotIntegrated);
  console.log('Codex integrated:', codexIntegrated);
  
  const allIntegrated = claudeIntegrated && copilotIntegrated && codexIntegrated;
  console.log('All platforms integrated:', allIntegrated);
  
  process.exit(allIntegrated ? 0 : 1);
"

# Count skill generation calls (should be 4: Claude + Copilot + Codex local + Codex global)
grep -c "generateSkillsFromSpecs" bin/install.js
```

## Success Criteria

- [x] installClaude() generates skills to Claude config directory
- [x] installCopilot() generates skills to .github/copilot/skills/
- [x] installCodex() generates skills to .codex/skills/ (local mode)
- [x] installCodexGlobal() generates skills to ~/.codex/skills/ (global mode)
- [x] All platforms report generation results (generated/failed counts)
- [x] Error handling consistent across all platforms
- [x] Requirements PLAT-01, PLAT-02, PLAT-03, PLAT-04 satisfied

## Output

**Modified:**
- `bin/install.js`: Added skill generation calls to 4 installer functions (~80 lines added total)

**Technical notes:**
- Each platform writes to platform-specific directory structure
- Skills directory created if missing (recursive: true)
- Error reporting matches agent generation pattern
- Integration mirrors existing agent generation (proven pattern)
