---
phase: 02-template-engine-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bin/install.js
  - bin/lib/template-system/generator.js (if needed)
autonomous: true
must_haves:
  goal: "Extend install.js with skill generation pipeline that reuses proven template system"
  truths:
    - Function generateSkillsFromSpecs() exists in bin/install.js
    - Function scans specs/skills/ directories for gsd-*/SKILL.md pattern
    - Generated skills write to platform-specific output directory
    - Conditional syntax ({{#isClaude}}, {{#isCopilot}}, {{#isCodex}}) renders correctly
    - Platform-specific tool names map correctly (Read → file_read for Copilot)
    - Metadata fields auto-generate with timestamps and versions
  artifacts:
    - bin/install.js contains generateSkillsFromSpecs() function
    - Function handles folder-per-skill structure (not flat files)
  wiring:
    - generateSkillsFromSpecs() calls generateAgent() from template-system/generator.js
    - Function returns {generated, failed, errors} matching agent generation pattern
  key_links:
    - bin/install.js::generateSkillsFromSpecs → bin/lib/template-system/generator.js::generateAgent
---

# Phase 2 Plan 01: Skill Generation Pipeline

**Objective:** Create generateSkillsFromSpecs() function in install.js that adapts existing template system for folder-per-skill structure

## Context

Phase 1 created `/specs/skills/gsd-help/SKILL.md` following canonical schema with platform conditionals. The template system (gray-matter + js-yaml + Mustache) already handles agents successfully with 208 passing tests. This plan adapts the proven `generateAgentsFromSpecs()` pattern for skills' folder structure.

**Key difference:** Agents use flat structure (`specs/agents/*.md`), skills use folder structure (`specs/skills/gsd-*/SKILL.md`). The generation pipeline is identical, only directory scanning changes.

**From Research (02-RESEARCH.md):**
- Template system ready: gray-matter 4.0.3 + js-yaml 4.1.1 proven
- generateAgent() handles all transformations (parse → context → render → map tools → metadata)
- Prototype exists: scripts/generate-skill-outputs.js validates approach

## Tasks

<task name="create-skill-generation-function" type="auto">
  <files>bin/install.js</files>
  <action>
Create generateSkillsFromSpecs() function in bin/install.js following the proven pattern from generateAgentsFromSpecs() (lines 242-295).

**Key adaptations for folder-per-skill structure:**

```javascript
function generateSkillsFromSpecs(specsDir, outputDir, platform) {
  const errors = [];
  let generated = 0;
  let failed = 0;

  try {
    // Ensure output directory exists
    fs.mkdirSync(outputDir, { recursive: true });

    // Read all skill directories (folder-per-skill pattern)
    const skillDirs = fs.readdirSync(specsDir)
      .filter(name => {
        const fullPath = path.join(specsDir, name);
        return fs.statSync(fullPath).isDirectory() && name.startsWith('gsd-');
      });

    for (const skillDir of skillDirs) {
      const specPath = path.join(specsDir, skillDir, 'SKILL.md');
      
      if (!fs.existsSync(specPath)) {
        console.log(`  ${yellow}⚠${reset} Skipping ${skillDir}: no SKILL.md found`);
        continue;
      }
      
      try {
        // Generate skill using template system (reuses existing generateAgent)
        const result = generateAgent(specPath, platform);
        
        if (result.success) {
          // Output name: gsd-help.md (folder name + .md)
          const outputName = `${skillDir}.md`;
          const outputPath = path.join(outputDir, outputName);
          fs.writeFileSync(outputPath, result.output, 'utf8');
          generated++;
          
          // Log warnings if any
          if (result.warnings && result.warnings.length > 0) {
            result.warnings.forEach(warning => {
              console.log(`  ${yellow}⚠${reset} ${skillDir}: ${warning.message || warning}`);
            });
          }
        } else {
          failed++;
          const errorMsg = result.errors && result.errors.length > 0
            ? result.errors.map(e => e.message).join(', ')
            : 'Unknown error';
          errors.push({ file: skillDir, error: errorMsg });
          console.error(`  ${yellow}✗${reset} Failed to generate ${skillDir}: ${errorMsg}`);
        }
      } catch (err) {
        failed++;
        errors.push({ file: skillDir, error: err.message });
        console.error(`  ${yellow}✗${reset} Error generating ${skillDir}: ${err.message}`);
      }
    }
  } catch (err) {
    errors.push({ error: `Failed to read specs directory: ${err.message}` });
    console.error(`  ${yellow}✗${reset} Failed to read specs directory: ${err.message}`);
  }

  return { generated, failed, errors };
}
```

**Critical differences from generateAgentsFromSpecs:**
1. Scan directories with `fs.statSync().isDirectory()` instead of files
2. Filter by `name.startsWith('gsd-')` instead of `file.endsWith('.md')`
3. Build specPath as `path.join(specsDir, skillDir, 'SKILL.md')` (not direct file)
4. Output name from folder name: `${skillDir}.md` (not specFile)
5. Skip missing SKILL.md with warning (not error)

Place function after generateAgentsFromSpecs() (around line 296+).
  </action>
  <verify>
```bash
# Verify function exists and structure is correct
grep -A 5 "function generateSkillsFromSpecs" bin/install.js

# Check it filters directories starting with gsd-
grep "startsWith('gsd-')" bin/install.js

# Verify it looks for SKILL.md inside directories
grep "SKILL.md" bin/install.js
```
  </verify>
  <done>
- Function generateSkillsFromSpecs() exists in bin/install.js
- Function scans directories (not files) with gsd-* prefix
- Function reads specs/skills/gsd-*/SKILL.md pattern
- Function returns {generated, failed, errors} structure
- Error handling matches generateAgentsFromSpecs pattern
  </done>
</task>

## Verification

```bash
# Verify function signature and structure
node -e "
  const install = require('./bin/install.js');
  const fs = require('fs');
  const content = fs.readFileSync('./bin/install.js', 'utf8');
  const hasFunction = content.includes('function generateSkillsFromSpecs');
  const hasDirectoryScan = content.includes('isDirectory()');
  const hasGsdFilter = content.includes(\"startsWith('gsd-')\");
  console.log('Function exists:', hasFunction);
  console.log('Scans directories:', hasDirectoryScan);
  console.log('Filters gsd-*:', hasGsdFilter);
  process.exit(hasFunction && hasDirectoryScan && hasGsdFilter ? 0 : 1);
"
```

## Success Criteria

- [x] generateSkillsFromSpecs() function exists in bin/install.js
- [x] Function handles folder-per-skill structure (gsd-*/SKILL.md)
- [x] Function reuses generateAgent() from template system
- [x] Error handling matches proven agent generation pattern
- [x] Returns {generated, failed, errors} for consistent reporting

## Output

**Created:**
- `bin/install.js`: generateSkillsFromSpecs() function (~70 lines)

**Technical notes:**
- Reuses existing generateAgent() - no changes to template system needed
- Folder scanning adds ~10 lines vs flat file scanning
- Compatible with existing error reporting infrastructure
