---
phase: 01-template-migration
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - scripts/migrate-to-templates.js
  - scripts/lib/skill-migrator.js
  - templates/skills/**/SKILL.md
  - templates/skills/**/version.json
autonomous: true
must_haves:
  - all 29 skills migrated from .github/skills/ to templates/skills/
  - frontmatter corrections applied per TEMPLATE-01C spec
  - tools field converted from array to comma-separated string allowed-tools
  - tool names normalized (read‚ÜíRead, execute‚ÜíBash, etc.)
  - arguments array converted to argument-hint string
  - unsupported fields removed and stored in version.json per skill
  - template variables injected ({{PLATFORM_ROOT}}, {{COMMAND_PREFIX}})
  - directory structure preserved (gsd-*/SKILL.md)
---

# Plan 01-02: Skills Migration & Correction

## Objective

Migrate all 29 skills from `.github/skills/` to `/templates/skills/` with frontmatter corrections, tool name normalization, argument-hint conversion, and template variable injection.

## Context

This is Wave 2 of Phase 1. Foundation (Plan 01) is complete with frontmatter parser and validator ready. Now we process all 29 skills, applying TEMPLATE-01C corrections.

From REQUIREMENTS.md TEMPLATE-01C:
- Remove unsupported fields: `skill_version`, `requires_version`, `platforms`, `metadata`, `arguments`, `tools`
- Rename field: `tools` ‚Üí `allowed-tools`
- Convert tools format: From array `[read, edit]` to string `"Read, Edit, Bash"`
- Normalize tool names: Apply proper capitalization
- Convert `arguments` array to `argument-hint` string
- Create version.json per skill with removed metadata

From TEMPLATE-02B tool reference table:
- Official Claude tool names: Read, Write, Edit, Bash, Grep, Glob, Task, etc.
- Copilot aliases: execute‚ÜíBash, search‚ÜíGrep, agent‚ÜíTask

Skills structure:
- Source: `.github/skills/gsd-*/SKILL.md`
- Target: `templates/skills/gsd-*/SKILL.md`
- Metadata: `templates/skills/gsd-*/version.json`

## Tasks

<task name="create-skill-migrator" type="auto">
  <files>scripts/lib/skill-migrator.js</files>
  <action>
    Create skill migration logic with frontmatter corrections:
    
    **scripts/lib/skill-migrator.js**:
    ```javascript
    import path from 'node:path';
    import fs from 'fs-extra';
    import matter from 'gray-matter';
    import { parseFrontmatter, validateFrontmatter } from './frontmatter-parser.js';
    import { injectTemplateVariables } from './template-injector.js';
    
    /**
     * Tool name mappings (Copilot aliases ‚Üí Claude official names)
     * From TEMPLATE-02B specification
     */
    const TOOL_NAME_MAP = {
      'read': 'Read',
      'write': 'Write',
      'edit': 'Edit',
      'bash': 'Bash',
      'execute': 'Bash',        // Copilot alias
      'grep': 'Grep',
      'glob': 'Glob',
      'search': 'Grep',         // Copilot alias
      'task': 'Task',
      'agent': 'Task',          // Copilot alias
      'skill': 'Skill',
      'askuserquestion': 'AskUserQuestion',
      'webfetch': 'WebFetch',
      'websearch': 'WebSearch',
      'lsp': 'LSP',
      'mcpsearch': 'MCPSearch',
      'taskoutput': 'TaskOutput',
      'killshell': 'KillShell',
      'notebookedit': 'NotebookEdit',
      'exitplanmode': 'ExitPlanMode',
      'taskcreate': 'TaskCreate',
      'taskget': 'TaskGet',
      'tasklist': 'TaskList',
      'taskupdate': 'TaskUpdate'
    };
    
    /**
     * Normalize tool name to official Claude format
     */
    function normalizeToolName(toolName) {
      const lower = toolName.toLowerCase().trim();
      return TOOL_NAME_MAP[lower] || toolName;
    }
    
    /**
     * Convert tools array to comma-separated string with proper capitalization
     */
    function convertToolsToString(toolsArray) {
      if (!Array.isArray(toolsArray)) {
        return typeof toolsArray === 'string' ? toolsArray : '';
      }
      
      return toolsArray
        .map(tool => normalizeToolName(tool))
        .join(', ');
    }
    
    /**
     * Convert arguments array to argument-hint string
     * Examples:
     *   ['domain'] ‚Üí '[domain]'
     *   ['filename', 'format'] ‚Üí '[filename] [format]'
     */
    function convertArgumentsToHint(argsArray) {
      if (!Array.isArray(argsArray)) {
        return argsArray || '';
      }
      
      return argsArray.map(arg => `[${arg}]`).join(' ');
    }
    
    /**
     * Apply frontmatter corrections to skill data
     * Implements TEMPLATE-01C specification
     */
    export function correctSkillFrontmatter(data) {
      const corrected = { ...data };
      const metadata = {};
      
      // Store unsupported fields in metadata object
      const fieldsToRemove = ['skill_version', 'requires_version', 'platforms', 'metadata'];
      fieldsToRemove.forEach(field => {
        if (corrected[field] !== undefined) {
          metadata[field] = corrected[field];
          delete corrected[field];
        }
      });
      
      // Convert tools array ‚Üí allowed-tools string
      if (corrected.tools !== undefined) {
        corrected['allowed-tools'] = convertToolsToString(corrected.tools);
        // Store original in metadata for reference (don't put in version.json)
        delete corrected.tools;
      }
      
      // Convert allowed-tools if it exists and is an array
      if (corrected['allowed-tools'] && Array.isArray(corrected['allowed-tools'])) {
        corrected['allowed-tools'] = convertToolsToString(corrected['allowed-tools']);
      }
      
      // Convert arguments ‚Üí argument-hint
      if (corrected.arguments !== undefined) {
        corrected['argument-hint'] = convertArgumentsToHint(corrected.arguments);
        // Don't store arguments in metadata - used only as reference during conversion
        delete corrected.arguments;
      }
      
      return { corrected, metadata };
    }
    
    /**
     * Migrate a single skill
     * @param {string} sourcePath - Path to source skill file (.github/skills/gsd-*/SKILL.md)
     * @param {string} targetDir - Target directory (templates/skills/)
     * @param {object} validator - Validator instance for error collection
     * @returns {object} - Migration result {success, file, errors}
     */
    export async function migrateSkill(sourcePath, targetDir, validator) {
      const skillName = path.basename(path.dirname(sourcePath));
      const targetSkillDir = path.join(targetDir, skillName);
      const targetPath = path.join(targetSkillDir, 'SKILL.md');
      const versionPath = path.join(targetSkillDir, 'version.json');
      
      try {
        // Read source file
        const content = await fs.readFile(sourcePath, 'utf-8');
        
        // Parse frontmatter
        const { data, content: body } = parseFrontmatter(sourcePath, content);
        
        // Apply corrections
        const { corrected, metadata } = correctSkillFrontmatter(data);
        
        // Inject template variables into body
        const injectedBody = injectTemplateVariables(body);
        
        // Validate corrected frontmatter
        const validationErrors = validateFrontmatter(targetPath, corrected, 'skill');
        if (validationErrors.length > 0) {
          validator.addIssues(targetPath, validationErrors);
        }
        
        // Create target directory
        await fs.ensureDir(targetSkillDir);
        
        // Write corrected skill file
        const newContent = matter.stringify(injectedBody, corrected);
        await fs.writeFile(targetPath, newContent, 'utf-8');
        
        // Write version.json (metadata only - no arguments field)
        await fs.writeJson(versionPath, metadata, { spaces: 2 });
        
        return {
          success: true,
          file: targetPath,
          skillName,
          metadata
        };
        
      } catch (err) {
        validator.addError(sourcePath, 'migration', err.message);
        return {
          success: false,
          file: sourcePath,
          error: err.message
        };
      }
    }
    
    /**
     * Migrate all skills from source to target directory
     */
    export async function migrateAllSkills(sourceDir, targetDir, validator) {
      // Find all skill directories
      const skillDirs = await fs.readdir(sourceDir);
      const skillPaths = [];
      
      for (const dir of skillDirs) {
        if (!dir.startsWith('gsd-')) continue;
        
        const skillPath = path.join(sourceDir, dir, 'SKILL.md');
        if (await fs.pathExists(skillPath)) {
          skillPaths.push(skillPath);
        }
      }
      
      console.log(`Found ${skillPaths.length} skills to migrate`);
      
      // Migrate each skill
      const results = [];
      for (const skillPath of skillPaths) {
        const result = await migrateSkill(skillPath, targetDir, validator);
        results.push(result);
      }
      
      const successful = results.filter(r => r.success).length;
      const failed = results.filter(r => !r.success).length;
      
      return {
        total: results.length,
        successful,
        failed,
        results
      };
    }
    ```
  </action>
  <verify>
    ```bash
    test -f scripts/lib/skill-migrator.js && \
    echo "‚úì Skill migrator module created"
    ```
  </verify>
  <done>Skill migrator module exists with frontmatter correction logic</done>
</task>

<task name="integrate-skills-migration" type="auto">
  <files>scripts/migrate-to-templates.js</files>
  <action>
    Update main migration script to execute skills migration:
    
    Replace the `// TODO: Skills migration (Plan 02)` section with:
    
    ```javascript
    import { migrateAllSkills } from './lib/skill-migrator.js';
    import { Validator } from './lib/validator.js';
    
    async function main() {
      console.log(chalk.blue.bold('üîÑ Phase 1: ONE-TIME Template Migration\n'));
      
      const validator = new Validator();
      
      // Prepare directories
      const sourceSkillsDir = path.join(process.cwd(), '.github/skills');
      const targetSkillsDir = path.join(process.cwd(), 'templates/skills');
      
      // Clean templates/skills if exists (start fresh)
      if (await fs.pathExists(targetSkillsDir)) {
        console.log(chalk.yellow('‚ö† Removing existing templates/skills directory'));
        await fs.remove(targetSkillsDir);
      }
      await fs.ensureDir(targetSkillsDir);
      
      // Migrate skills
      console.log(chalk.cyan('\nüìù Migrating skills...'));
      const skillsResult = await migrateAllSkills(sourceSkillsDir, targetSkillsDir, validator);
      
      console.log(chalk.green(`‚úì Skills migrated: ${skillsResult.successful}/${skillsResult.total}`));
      if (skillsResult.failed > 0) {
        console.log(chalk.red(`‚úó Skills failed: ${skillsResult.failed}`));
      }
      
      // TODO: Agents migration (Plan 03)
      // TODO: Validation and manual review (Plan 04)
      
      // Show validation report
      console.log('\n' + validator.generateReport());
      
      if (validator.hasErrors()) {
        console.log(chalk.red('\n‚ùå Migration blocked - fix errors and retry'));
        process.exit(1);
      }
      
      console.log(chalk.green('\n‚úì Migration foundation ready'));
    }
    ```
  </action>
  <verify>
    ```bash
    # Run migration to verify skills are migrated
    node scripts/migrate-to-templates.js
    
    # Check that templates/skills directory was created
    test -d templates/skills && echo "‚úì templates/skills created"
    
    # Count migrated skills
    ls -1 templates/skills/ | grep "^gsd-" | wc -l
    
    # Verify version.json files exist
    find templates/skills -name "version.json" | wc -l
    ```
  </verify>
  <done>Skills migration integrated into main script and all 29 skills migrated successfully</done>
</task>

## Verification

After completing this plan:

1. **Skill migrator created:** scripts/lib/skill-migrator.js with correction logic
2. **All skills migrated:** 29 skills in templates/skills/gsd-*/SKILL.md
3. **Frontmatter corrected:** 
   - `tools` ‚Üí `allowed-tools` (comma-separated string)
   - Tool names normalized (Read, Write, Bash, etc.)
   - `arguments` ‚Üí `argument-hint`
   - Unsupported fields removed
4. **Metadata preserved:** version.json per skill with skill_version, requires_version, platforms, metadata
5. **Template variables injected:** {{PLATFORM_ROOT}}, {{COMMAND_PREFIX}} in content
6. **Validation clean:** No errors blocking migration

## Success Criteria

- [ ] scripts/lib/skill-migrator.js exists with correction logic
- [ ] templates/skills/ directory contains 29 gsd-* subdirectories
- [ ] Each skill directory has SKILL.md and version.json
- [ ] Frontmatter uses `allowed-tools` (not `tools`), comma-separated string format
- [ ] Tool names are capitalized correctly (Read, Write, Bash, not lowercase)
- [ ] `argument-hint` field exists (converted from `arguments` array)
- [ ] No unsupported fields in frontmatter (moved to version.json)
- [ ] Template variables present in content ({{PLATFORM_ROOT}}, {{COMMAND_PREFIX}})
- [ ] Running migration script shows skills migrated successfully
- [ ] No validation errors blocking migration

## Output

29 skills migrated to templates/skills/ with corrected frontmatter, ready for agent migration in Plan 03.
