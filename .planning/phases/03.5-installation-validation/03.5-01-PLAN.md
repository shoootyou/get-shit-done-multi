---
phase: 3.5
plan: "03.5-01"
title: "Enhanced Installation Logging & Validation"
type: implementation
autonomous: true
priority: CRITICAL
estimated_duration: 30 min
parent_phase: 3
wave: 1
---

# Plan 03.5-01: Enhanced Installation Logging & Validation

## Objective

Add detailed logging and post-install validation to install.js so users can:
1. See exactly WHERE skills were installed (absolute paths)
2. Verify installation succeeded automatically  
3. Know what to check if something seems wrong

## Context

User reports not seeing skills after `--copilot` install. Investigation shows skills ARE created but:
- No feedback on where they are
- No list of what was created
- No validation that structure is correct
- User must manually navigate and check

## Requirements

### Must Have
- Log absolute path where skills were generated
- List each skill name that was created
- Validate skills exist after generation
- Show verification commands to user
- All without breaking existing functionality

### Should Have
- File size for each skill
- Checkmarks for successful validation
- Color-coded output (green=success, yellow=warning)

### Nice to Have
- Folder tree visualization
- Link to documentation

## Tasks

### Task 1: Add Detailed Path Logging
**File:** `bin/install.js`  
**Location:** After line 908 (generateSkillsFromSpecs call)

**Current code:**
```javascript
if (skillGenResult.generated > 0) {
  console.log(`  ${green}✓${reset} Skills: ${skillGenResult.generated} generated`);
}
```

**New code:**
```javascript
if (skillGenResult.generated > 0) {
  console.log(`  ${green}✓${reset} Skills: ${skillGenResult.generated} generated at ${cyan}${skillDestDir}${reset}`);
  
  // List each skill created
  const skillDirs = fs.readdirSync(skillDestDir)
    .filter(name => name.startsWith('gsd-') && fs.statSync(path.join(skillDestDir, name)).isDirectory());
  
  skillDirs.forEach(skillName => {
    const skillPath = path.join(skillDestDir, skillName, 'SKILL.md');
    if (fs.existsSync(skillPath)) {
      const stats = fs.statSync(skillPath);
      const sizeKB = (stats.size / 1024).toFixed(1);
      console.log(`    ${green}✓${reset} ${skillName}/ (${sizeKB} KB)`);
    }
  });
  
  console.log(`  ${dim}Verify: ls ${skillDestDir}${reset}`);
}
```

**Acceptance:**
- Absolute path shown after "generated"
- Each skill listed with checkmark
- File size shown for each
- Verification command provided

### Task 2: Add Post-Install Validation Function
**File:** `bin/install.js`  
**Location:** Before generateSkillsFromSpecs() call (around line 308)

**Add new function:**
```javascript
/**
 * Validate that skills were installed correctly
 * @param {string} skillDestDir - Directory where skills should be
 * @param {string[]} expectedSkills - Array of expected skill names
 * @returns {{success: boolean, found: string[], missing: string[]}}
 */
function validateSkillInstallation(skillDestDir, expectedSkills) {
  const found = [];
  const missing = [];
  
  if (!fs.existsSync(skillDestDir)) {
    return { success: false, found: [], missing: expectedSkills, error: 'Skills directory not found' };
  }
  
  for (const skillName of expectedSkills) {
    const skillPath = path.join(skillDestDir, skillName, 'SKILL.md');
    if (fs.existsSync(skillPath)) {
      const stats = fs.statSync(skillPath);
      if (stats.size > 0) {
        found.push(skillName);
      } else {
        missing.push(`${skillName} (empty file)`);
      }
    } else {
      missing.push(skillName);
    }
  }
  
  return {
    success: missing.length === 0,
    found,
    missing
  };
}
```

**Acceptance:**
- Function checks each expected skill
- Returns list of found and missing
- Detects empty files as failures
- Returns success boolean

### Task 3: Use Validation After Generation
**File:** `bin/install.js`  
**Location:** After generateSkillsFromSpecs() call (around line 910)

**Add validation:**
```javascript
const skillGenResult = generateSkillsFromSpecs(skillSpecsDir, skillDestDir, 'copilot');

if (skillGenResult.generated > 0) {
  // Enhanced logging from Task 1
  console.log(`  ${green}✓${reset} Skills: ${skillGenResult.generated} generated at ${cyan}${skillDestDir}${reset}`);
  
  // List skills
  const skillDirs = fs.readdirSync(skillDestDir)
    .filter(name => name.startsWith('gsd-') && fs.statSync(path.join(skillDestDir, name)).isDirectory());
  
  skillDirs.forEach(skillName => {
    const skillPath = path.join(skillDestDir, name, 'SKILL.md');
    if (fs.existsSync(skillPath)) {
      const stats = fs.statSync(skillPath);
      const sizeKB = (stats.size / 1024).toFixed(1);
      console.log(`    ${green}✓${reset} ${skillName}/ (${sizeKB} KB)`);
    }
  });
  
  // NEW: Validate installation
  const expectedSkills = ['gsd-help', 'gsd-execute-phase', 'gsd-new-project', 'gsd-new-milestone'];
  const validation = validateSkillInstallation(skillDestDir, expectedSkills);
  
  if (!validation.success) {
    console.log(`  ${yellow}⚠${reset} Validation warnings:`);
    validation.missing.forEach(skill => {
      console.log(`    ${yellow}⚠${reset} Missing: ${skill}`);
    });
  }
  
  console.log(`  ${dim}Verify: ls ${skillDestDir}${reset}`);
}
```

**Acceptance:**
- Validation runs automatically after generation
- Missing skills trigger warnings
- User sees what's missing
- Doesn't fail install (warnings only)

### Task 4: Update Test Output
**File:** `scripts/generate-skill-outputs.js`  
**Location:** End of main execution (around line 200)

**Add validation output:**
```javascript
// At end of script
console.log(`\n${green}✓${reset} Test outputs generated`);
console.log(`  Claude:  test-output/claude/skills/`);
console.log(`  Copilot: test-output/copilot/skills/`);
console.log(`  Codex:   test-output/codex/skills/`);
console.log(`\nVerify structure:`);
console.log(`  $ ls test-output/*/skills/*/SKILL.md`);
console.log(`  $ scripts/validate-installation.js test-output/copilot`);
```

**Acceptance:**
- Clear summary of what was generated
- Paths shown for each platform
- Verification commands provided

## Success Criteria

1. ✅ Absolute paths shown in install output
2. ✅ Each generated skill listed individually
3. ✅ File sizes displayed for verification
4. ✅ Validation runs automatically
5. ✅ Missing skills trigger warnings (not errors)
6. ✅ User given clear verification commands
7. ✅ No breaking changes to existing functionality

## Test Plan

**Test 1: Install to /tmp with logging**
```bash
node bin/install.js --copilot --project-dir /tmp/test-logging
# Expected: See absolute path, list of skills, sizes
```

**Test 2: Validate finds all skills**
```bash
# After successful install
# Expected: No warnings, all 4 skills validated
```

**Test 3: Validate detects missing skill**
```bash
# Delete one skill: rm -rf /tmp/test-logging/.github/skills/gsd-help
node bin/install.js --copilot --project-dir /tmp/test-logging
# Expected: Warning about missing gsd-help
```

**Test 4: Verify workspace install**
```bash
cd /workspace
node bin/install.js --copilot
# Expected: Shows /workspace/.github/skills/ path
```

## Risks

**Low Risk:**
- Only adding logging, not changing generation logic
- Validation is read-only
- Warnings don't fail install

**Mitigations:**
- Test in /tmp first
- Validation doesn't modify files
- Clear separation of concerns

## Dependencies

**Requires:**
- Existing generateSkillsFromSpecs() function
- fs and path modules (already imported)

**Blocks:**
- None (can proceed in parallel with other plans)

## Notes

- This addresses user's "I don't see the skills" concern
- Provides transparency into what install actually does
- Gives user tools to verify themselves
- Non-invasive changes (logging only)
