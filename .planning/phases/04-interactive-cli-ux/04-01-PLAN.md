---
phase: 04-interactive-cli-ux
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - bin/lib/cli/interactive.js
  - bin/lib/cli/installation-core.js
  - bin/lib/cli/next-steps.js
  - bin/lib/cli/README.md
  - bin/install.js
autonomous: true
must_haves:
  truths:
    - User runs `npx get-shit-done-multi` with NO flags → interactive prompts appear
    - Interactive mode shows warning + confirmation when ZERO platform CLIs detected
    - Platform selection menu shows all three platforms with detection status
    - User can select multiple platforms (Claude + Copilot + Codex)
    - User selects scope (global or local) per installation
    - Installation proceeds without skill selection or confirmation prompts
    - Progress bars display exactly as CLI mode (multi-bar per platform)
    - Success message displays with next steps after completion
    - CTRL+C cancellation exits gracefully with exit code 0
    - Non-TTY with no flags shows error with usage instructions
    - CLI mode and Interactive mode share same installation core
    - Command prefix (/gsd- vs $gsd-) handled correctly based on platform
  artifacts:
    - package.json has @clack/prompts@^0.11.0 dependency
    - bin/lib/cli/interactive.js exports runInteractive() function
    - bin/lib/cli/installation-core.js exports installPlatforms() shared function
    - bin/lib/cli/next-steps.js exports showNextSteps() for command prefix handling
    - bin/lib/cli/README.md documents adapter pattern architecture
    - bin/install.js routes to interactive mode when no flags + TTY detected
  wiring:
    - bin/install.js imports runInteractive from interactive.js
    - bin/install.js imports installPlatforms from installation-core.js
    - interactive.js imports installPlatforms from installation-core.js
    - interactive.js imports detectBinaries from binary-detector.js
    - installation-core.js imports install from orchestrator.js
    - installation-core.js imports showNextSteps from next-steps.js
    - next-steps.js imports logger from logger.js
  key_links:
    - bin/install.js TTY check determines interactive vs CLI mode
    - Both modes call installPlatforms() with platforms and scope
    - installPlatforms() loops through platforms calling orchestrator
    - showNextSteps() handles command prefix based on platform combination
    - Architecture follows Adapter → Core pattern (documented in README.md)
---

# Phase 4 Plan 1: Interactive CLI with Beautiful UX

**Objective:** Add interactive mode with @clack/prompts for beautiful UX when no CLI flags provided

## Context

Phase 3 complete: Multi-platform installer working with --claude, --copilot, --codex flags. Now adding interactive mode as default when no flags specified.

**From CONTEXT.md:**
- Install ALL skills/agents by default (no selection prompts)
- No confirmation prompt before installation
- Reuse existing progress bars and error handling
- Allow multi-platform selection like CLI flags
- Global detection check BEFORE platform selection if zero CLIs detected

**From RESEARCH.md:**
- @clack/prompts (v0.11.0) for interactive prompts
- cli-progress already in use (reuse createMultiBar)
- chalk already in use (reuse logger)
- TTY detection via process.stdin.isTTY
- Exit code 0 for cancellation/decline (user choice, not error)

**Existing architecture:**
- bin/install.js: Entry point with commander flags
- bin/lib/platforms/binary-detector.js: CLI detection (copilot, claude, codex)
- bin/lib/platforms/detector.js: GSD version detection
- bin/lib/installer/orchestrator.js: install() function (reuse)
- bin/lib/cli/progress.js: createMultiBar() factory (reuse)
- bin/lib/cli/logger.js: Colored output (reuse)

## Tasks

<task name="create-interactive-orchestrator" type="auto">
  <files>
    bin/lib/cli/interactive.js
    package.json
  </files>
  <action>
1. **Install @clack/prompts dependency:**
   ```bash
   npm install @clack/prompts@^0.11.0
   ```

2. **Create bin/lib/cli/interactive.js:**
   
   Import required modules:
   ```javascript
   import * as p from '@clack/prompts';
   import { detectBinaries } from '../platforms/binary-detector.js';
   import { getInstalledVersion } from '../platforms/detector.js';
   import { adapterRegistry } from '../platforms/registry.js';
   import { install } from '../installer/orchestrator.js';
   import { createMultiBar } from './progress.js';
   import * as logger from './logger.js';
   import path from 'path';
   import { fileURLToPath } from 'url';
   import { dirname } from 'path';
   ```

3. **Implement runInteractive() function:**

   Entry point:
   ```javascript
   export async function runInteractive(options = {}) {
     // Show intro
     p.intro('Get Shit Done - Multi-Platform Installer');
     
     // Detect platforms
     const detected = await detectBinaries();
     
     // Global detection check (Pattern 4 from research)
     const hasAnyPlatform = Object.values(detected).some(x => x);
     if (!hasAnyPlatform) {
       await showGlobalDetectionWarning();
     }
     
     // Prompt for selections (Pattern 5 from research)
     const { platforms, scope } = await promptSelections(detected);
     
     // Run installation (Pattern 3 from research)
     await runInstallation(platforms, scope);
     
     // Show completion
     p.outro('Installation complete! Run /gsd-help to get started.');
   }
   ```

4. **Implement showGlobalDetectionWarning():**
   ```javascript
   async function showGlobalDetectionWarning() {
     p.log.warn('No platform CLIs detected on your system.');
     p.log.info('You can still proceed, but installation may fail without CLI binaries.');
     p.log.info('Install Claude Code, GitHub Copilot CLI, or Codex CLI first for best results.');
     
     const shouldContinue = await p.confirm({
       message: 'Continue anyway?',
       initialValue: false
     });
     
     if (p.isCancel(shouldContinue)) {
       p.cancel('Installation cancelled.');
       process.exit(0);
     }
     
     if (!shouldContinue) {
       p.outro('Install a platform CLI first, then run this installer again.');
       process.exit(0);
     }
   }
   ```

5. **Implement promptSelections():**
   ```javascript
   async function promptSelections(detected) {
     // Get installed versions
     const versions = {};
     for (const platform of ['claude', 'copilot', 'codex']) {
       versions[platform] = await getInstalledVersion(platform);
     }
     
     return await p.group(
       {
         platforms: () => p.multiselect({
           message: 'Select platforms to install GSD:',
           options: [
             {
               value: 'claude',
               label: 'Claude Code',
               hint: versions.claude ? `v${versions.claude}` : (detected.claude ? 'detected' : 'Install CLI first')
             },
             {
               value: 'copilot',
               label: 'GitHub Copilot CLI',
               hint: versions.copilot ? `v${versions.copilot}` : (detected.copilot ? 'detected' : 'Install CLI first')
             },
             {
               value: 'codex',
               label: 'Codex CLI',
               hint: versions.codex ? `v${versions.codex}` : (detected.codex ? 'detected' : 'Install CLI first')
             }
           ],
           required: true
         }),
         scope: () => p.select({
           message: 'Installation scope:',
           options: [
             { value: 'local', label: 'Local (.claude/, .github/, .codex/)', hint: 'recommended' },
             { value: 'global', label: 'Global (~/.claude/, ~/.copilot/, ~/.codex/)' }
           ],
           initialValue: 'local'
         })
       },
       {
         onCancel: () => {
           p.cancel('Installation cancelled.');
           process.exit(0);
         }
       }
     );
   }
   ```

6. **Implement runInstallation():**
   ```javascript
   async function runInstallation(platforms, scope) {
     const __filename = fileURLToPath(import.meta.url);
     const __dirname = dirname(__filename);
     const scriptDir = path.resolve(__dirname, '../..');
     
     const isGlobal = scope === 'global';
     const multiBar = createMultiBar();
     
     // Track failures for partial success handling
     const failures = [];
     
     for (const platform of platforms) {
       try {
         logger.info(`Installing GSD for ${platform}...`);
         
         const adapter = adapterRegistry.get(platform);
         await install({
           platform,
           adapter,
           isGlobal,
           scriptDir,
           multiBar
         });
         
         logger.success(`${platform} installation complete`);
       } catch (error) {
         failures.push({ platform, error });
         logger.error(`${platform} installation failed: ${error.message}`);
       }
     }
     
     multiBar.stop();
     
     // Show summary
     if (failures.length > 0) {
       p.log.warn(`${failures.length} platform(s) failed to install:`);
       failures.forEach(f => p.log.error(`  - ${f.platform}: ${f.error.message}`));
       
       if (failures.length === platforms.length) {
         // All failed - error exit
         process.exit(1);
       }
       // Partial success - continue to outro
     }
   }
   ```

7. **Export function:**
   ```javascript
   export { runInteractive };
   ```
  </action>
  <verify>
```bash
# Check dependency installed
grep "@clack/prompts" package.json

# Check file exists and exports runInteractive
node -e "import('./bin/lib/cli/interactive.js').then(m => console.log(typeof m.runInteractive))"
```
  </verify>
  <done>
- @clack/prompts@^0.11.0 added to package.json
- bin/lib/cli/interactive.js created with runInteractive() export
- Global detection check implemented with warning + confirmation
- Platform selection with multi-select and disabled options
- Scope selection with local as default
- Installation reuses orchestrator + progress bars
- Cancellation handling returns exit code 0
  </done>
</task>

<task name="integrate-interactive-mode-routing" type="auto">
  <files>
    bin/install.js
  </files>
  <action>
Update bin/install.js to detect TTY and route to interactive mode:

1. **Add import at top:**
   ```javascript
   import { runInteractive } from './lib/cli/interactive.js';
   ```

2. **After commander parsing, add mode detection logic:**
   
   Find where options are parsed (after `program.parse(process.argv)`), add:
   
   ```javascript
   const options = program.opts();
   
   // Determine if any platform flags present
   const platformFlags = ['claude', 'copilot', 'codex'];
   const hasFlags = platformFlags.some(flag => options[flag]);
   
   // Check for interactive mode eligibility
   const isInteractive = !hasFlags && process.stdin.isTTY;
   
   if (isInteractive) {
     // Phase 4: Interactive mode
     await runInteractive(options);
     process.exit(0);
   } else if (!hasFlags && !process.stdin.isTTY) {
     // No flags and no TTY - show usage
     logger.error('No platform specified and not running in interactive mode.');
     logger.info('Usage: npx get-shit-done-multi --claude --global');
     logger.info('   or: npx get-shit-done-multi (interactive mode in terminal)');
     process.exit(2); // Exit code 2 = misuse
   }
   
   // Continue with existing CLI mode for flags
   ```

3. **Preserve existing CLI logic:**
   Keep all existing multi-platform installation code that handles --claude, --copilot, --codex flags. This stays unchanged.

4. **Update help text:**
   In commander option definitions, update .description() to mention interactive mode:
   ```javascript
   program
     .name('get-shit-done-multi')
     .description('Install get-shit-done skills to Claude Code, GitHub Copilot CLI, or Codex CLI')
     .version(packageJson.version)
     .addHelpText('after', '\nRun without flags for interactive mode with beautiful prompts.');
   ```
  </action>
  <verify>
```bash
# Test TTY detection routing
echo "console.log(process.stdin.isTTY)" | node

# Test interactive mode (should show prompts)
# Manual test: node bin/install.js
# Should see @clack/prompts intro

# Test non-TTY mode (should show error)
echo "" | node bin/install.js 2>&1 | grep "not running in interactive mode"

# Test CLI flags still work (should bypass interactive)
node bin/install.js --help | grep "interactive mode"
```
  </verify>
  <done>
- bin/install.js imports runInteractive
- TTY detection added (process.stdin.isTTY)
- Routes to interactive mode when no flags + TTY
- Shows error when no flags + no TTY
- Existing CLI flag mode preserved unchanged
- Help text mentions interactive mode
  </done>
</task>

<task name="test-interactive-flow-end-to-end" type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete interactive mode: TTY detection, @clack/prompts integration, platform selection, scope selection, progress display, completion messages
  </what-built>
  <how-to-verify>
**Test 1: Interactive mode with detected platforms**
```bash
# Run in terminal (TTY mode, no flags)
node bin/install.js

# Verify prompts:
# 1. Intro message appears
# 2. If CLIs detected, skip warning (go straight to platform selection)
# 3. If NO CLIs detected, show warning + confirmation prompt
# 4. Platform selection shows all three platforms
# 5. Detected platforms show "detected" hint
# 6. Undetected platforms show "Install CLI first" hint
# 7. Can select multiple platforms (space to toggle, enter to confirm)
# 8. Scope selection shows Local (recommended) and Global
# 9. Installation proceeds with progress bars (same as CLI mode)
# 10. Success message shows with next steps
```

**Test 2: Interactive mode cancellation**
```bash
# Run and press CTRL+C during prompts
node bin/install.js
# Press CTRL+C
# Verify: Shows "Installation cancelled", exits with code 0
echo $?  # Should be 0
```

**Test 3: Non-TTY mode without flags**
```bash
# Simulate non-TTY (pipe input)
echo "" | node bin/install.js 2>&1
# Verify: Shows error "not running in interactive mode", shows usage
# Exit code should be 2
```

**Test 4: CLI flags bypass interactive mode**
```bash
# Run with flags (should use CLI mode, not interactive)
node bin/install.js --claude --local
# Verify: NO prompts appear, goes straight to installation
```

**Test 5: Multi-platform selection**
```bash
# Run interactive mode, select 2+ platforms
node bin/install.js
# Select both Claude and Codex
# Verify: Installs to both platforms, shows progress for each
```

**Test 6: Global detection warning**
```bash
# If possible, test with zero CLIs detected
# (may need to temporarily rename/hide binaries)
node bin/install.js
# Verify: Warning appears, confirmation prompt, can decline gracefully
```

**Expected behavior:**
- Interactive prompts are beautiful and clear
- Platform detection works correctly
- Multi-platform selection functions
- Progress bars display properly
- Success/error messages match CLI mode
- Cancellation is graceful (exit 0)
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass, or describe issues found for fixes
  </resume-signal>
</task>

## Verification Criteria

Interactive mode complete when:
- [ ] User runs `npx get-shit-done-multi` with no flags → prompts appear
- [ ] Global detection check shows warning if zero CLIs detected
- [ ] Platform selection shows all three platforms with hints
- [ ] Multi-platform selection works (select multiple platforms)
- [ ] Scope selection works (global/local)
- [ ] Installation proceeds without additional prompts
- [ ] Progress bars display correctly (reuses CLI mode)
- [ ] Success message shows with next steps
- [ ] CTRL+C cancellation exits gracefully (exit 0)
- [ ] Non-TTY without flags shows error and usage

Architectural refactoring complete when:
- [ ] No duplicate code between install.js and interactive.js
- [ ] Both modes call same installPlatforms() function
- [ ] Command prefix (/gsd- vs $gsd-) centralized in next-steps.js
- [ ] Interactive mode hands off to shared core after prompts
- [ ] CLI mode hands off to shared core after flag parsing
- [ ] bin/lib/cli/README.md documents adapter pattern
- [ ] Both modes tested and produce identical results

## Success Criteria

Phase 4 delivers:
1. **Interactive mode** triggered when no CLI flags present + TTY detected
2. **@clack/prompts** integration with beautiful UX
3. **Global detection check** prevents deadlock when zero CLIs detected
4. **Platform selection** with multi-select, detection status, version display
5. **Scope selection** with local as recommended default
6. **Streamlined flow** - no skill selection, no confirmation (per CONTEXT.md)
7. **Shared progress** - reuses existing cli-progress MultiBar
8. **Consistent errors** - reuses existing logger error formatting
9. **Graceful cancellation** - CTRL+C exits with code 0
10. **CLI mode preserved** - flags still work, bypass interactive prompts
11. **Adapter pattern** - both modes use shared installation core
12. **Command prefix handling** - centralized in next-steps.js
13. **Architecture documentation** - README.md in bin/lib/cli/

## Output

After Plan 04-01:
- ✅ @clack/prompts@^0.11.0 installed
- ✅ bin/lib/cli/interactive.js with runInteractive() function
- ✅ bin/lib/cli/installation-core.js with installPlatforms() shared function
- ✅ bin/lib/cli/next-steps.js with showNextSteps() for command prefix handling
- ✅ bin/lib/cli/README.md documenting adapter pattern architecture
- ✅ bin/install.js routes to interactive mode when appropriate
- ✅ bin/install.js uses shared installation core (no duplication)
- ✅ Interactive flow: intro → warning (if needed) → platform selection → scope selection → installation → outro
- ✅ TTY detection prevents prompts in non-interactive environments
- ✅ Multi-platform selection supported in interactive mode
- ✅ Progress bars and error handling reused from CLI mode
- ✅ User can install to any platform combination via beautiful prompts
- ✅ Architecture follows Adapter → Core pattern (CLI and Interactive are adapters)
- ✅ Command prefix rules centralized (Codex solo = $gsd-, others = /gsd-)
- ✅ Both modes produce identical output for same parameters
