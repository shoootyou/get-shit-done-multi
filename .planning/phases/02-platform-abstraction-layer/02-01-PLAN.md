---
phase: 02-platform-abstraction-layer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bin/lib/template-system/tool-mapper.js
  - bin/lib/template-system/tool-mapper.test.js
autonomous: true

must_haves:
  truths:
    - "Canonical tool names map correctly to Claude format"
    - "Canonical tool names map correctly to Copilot format"
    - "Case-sensitive tool names preserved for Claude"
    - "Tool compatibility matrix identifies safe cross-platform tools"
  artifacts:
    - path: "bin/lib/template-system/tool-mapper.js"
      provides: "Tool name mapping and compatibility checks"
      exports: ["mapTools", "getToolCompatibility", "CANONICAL_TOOLS"]
      min_lines: 80
  key_links:
    - from: "tool-mapper.js"
      to: "PITFALLS.md tool matrix"
      via: "canonical names implementation"
      pattern: "Bash.*Read.*Edit.*Grep"
---

<objective>
Create tool compatibility layer that maps canonical tool names to platform-specific formats, handling case sensitivity and aliasing differences.

Purpose: Isolate tool name differences so specs can use canonical names that work on both Claude and Copilot.
Output: Tool mapper module with compatibility matrix and safe tool identification.
</objective>

<execution_context>
@.github/skills/get-shit-done/get-shit-done/workflows/execute-plan.md
@.github/skills/get-shit-done/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/PITFALLS.md
@.planning/phases/01-template-engine-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tool-mapper module with canonical name definitions</name>
  <files>bin/lib/template-system/tool-mapper.js</files>
  <action>
    Create tool-mapper.js with:
    
    1. CANONICAL_TOOLS constant defining safe cross-platform tools:
       - Bash (execute capability)
       - Read (file read capability)
       - Edit (file write capability)
       - Grep (code search capability)
       - Glob (file pattern matching)
       - Task (sub-agent invocation)
    
    2. TOOL_COMPATIBILITY_MATRIX from PITFALLS.md research:
       - For each canonical name: { claude: 'Name', copilot: 'name', safe: true/false }
       - Include aliases: { copilot: ['primary', 'alias1', 'alias2'] }
       - Mark platform-specific tools (WebFetch, WebSearch)
    
    3. mapTools(toolArray, platform) function:
       - Input: ['Bash', 'Read', 'Edit'], 'claude' or 'copilot'
       - Output: Correctly cased tool names for target platform
       - Preserve exact case for Claude (case-sensitive)
       - Convert to lowercase/aliases for Copilot if needed
    
    4. getToolCompatibility(toolName) function:
       - Returns: { isCanonical, claudeName, copilotName, safe, aliases, warnings }
       - Identify platform-specific tools with warning messages
       - Flag tools that exist but behave differently
    
    5. validateToolList(tools, platform) function:
       - Check all tools are valid for platform
       - Return warnings for platform-specific tools
       - Error on completely unsupported tools
    
    Implementation notes:
    - Use exact case from PITFALLS.md tool matrix (Bash not bash)
    - Always quote tool names in YAML arrays to prevent parsing ambiguities
    - Include JSDoc comments explaining canonical name rationale
    - Export constants, functions as CommonJS module
  </action>
  <verify>
    node -e "const tm = require('./bin/lib/template-system/tool-mapper'); console.log(tm.mapTools(['Bash', 'Read'], 'claude')); console.log(tm.CANONICAL_TOOLS.length);"
    
    Should output:
    - Claude tools with exact case
    - At least 6 canonical tools defined
  </verify>
  <done>
    - CANONICAL_TOOLS constant contains at least 6 safe cross-platform tools
    - mapTools() correctly maps tools for 'claude' and 'copilot' platforms
    - getToolCompatibility() returns detailed compatibility info
    - validateToolList() catches unsupported tools
    - All functions handle edge cases (empty arrays, unknown tools, invalid platforms)
  </done>
</task>

<task type="auto">
  <name>Task 2: Add comprehensive unit tests for tool mapper</name>
  <files>bin/lib/template-system/tool-mapper.test.js</files>
  <action>
    Create tool-mapper.test.js with test coverage for:
    
    1. Canonical tool mapping:
       - mapTools(['Bash', 'Read', 'Edit'], 'claude') returns correct case
       - mapTools(['Bash', 'Read', 'Edit'], 'copilot') returns correct format
       - Case preservation for Claude (Bash stays Bash)
       - Handling of tool aliases on Copilot
    
    2. Compatibility checking:
       - getToolCompatibility('Bash') identifies as canonical and safe
       - getToolCompatibility('WebFetch') identifies as Claude-only with warning
       - getToolCompatibility('unknown-tool') returns appropriate error info
    
    3. Validation:
       - validateToolList(['Bash', 'Read'], 'claude') passes with no warnings
       - validateToolList(['WebFetch'], 'copilot') returns warning about Claude-only tool
       - validateToolList(['invalid-tool'], 'claude') returns error
    
    4. Edge cases:
       - Empty tool arrays
       - Duplicate tools
       - Mixed case tool names
       - Unknown platform names
    
    5. Integration with PITFALLS.md:
       - Verify all tools from PITFALLS.md tool matrix are covered
       - Test case sensitivity scenarios from Pitfall 1
       - Test aliasing scenarios from Pitfall 2
    
    Use Node.js assert module (consistent with Phase 1 tests).
    Target: 12-15 test cases covering all functions and edge cases.
  </action>
  <verify>
    node bin/lib/template-system/tool-mapper.test.js
    
    All tests should pass with output showing:
    - Canonical tool mapping ✓
    - Compatibility checks ✓
    - Validation scenarios ✓
    - Edge cases handled ✓
  </verify>
  <done>
    - 12+ unit tests passing
    - All exported functions covered
    - Edge cases tested (empty arrays, unknown tools, invalid platforms)
    - PITFALLS.md scenarios verified (case sensitivity, aliasing)
    - Test output shows all checks passing
  </done>
</task>

</tasks>

<verification>
Run all tests to ensure tool mapper works correctly:

```bash
# Unit tests
node bin/lib/template-system/tool-mapper.test.js

# Quick integration check
node -e "
const tm = require('./bin/lib/template-system/tool-mapper');
console.log('Claude tools:', tm.mapTools(['Bash', 'Read', 'Edit'], 'claude'));
console.log('Copilot tools:', tm.mapTools(['Bash', 'Read', 'Edit'], 'copilot'));
console.log('Compatibility:', tm.getToolCompatibility('Bash'));
"
```

All outputs should show correct mapping and no errors.
</verification>

<success_criteria>
1. Tool mapper correctly maps canonical names to platform-specific formats
2. Case sensitivity preserved for Claude (critical from Pitfall 1)
3. Tool compatibility matrix identifies safe vs platform-specific tools
4. Validation catches unsupported tools before generation
5. All unit tests passing (12+ tests)
6. Module ready for integration into generator pipeline
</success_criteria>

<output>
After completion, create `.planning/phases/02-platform-abstraction-layer/02-01-SUMMARY.md` documenting:
- Tool compatibility matrix implementation
- Canonical tool names established
- Platform-specific tool warnings
- Integration notes for generator module
</output>
