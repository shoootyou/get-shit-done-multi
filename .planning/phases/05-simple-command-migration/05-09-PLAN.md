---
phase: 05-simple-command-migration
plan: 09
type: checkpoint:human-verify
wave: 5
depends_on: [05-08]
files_modified: []
autonomous: false
must_haves:
  goal: "Verify all 21 Phase 5 commands work correctly through sampling strategy"
  truths:
    - All 21 command specs exist in specs/skills/
    - All 21 commands generate successfully
    - Routing commands work (progress routes correctly)
    - Spawning commands work (verify-work, audit-milestone spawn correctly)
    - Lifecycle commands work (milestone complete → audit → gaps flow)
    - File manipulation commands work (todos, phase management)
    - Reference commands display correctly (help, verify-installation)
    - No regression in Phase 3-4 commands
  artifacts:
    - All 21 Phase 5 command specs
    - All 21 generated .claude/skills/ files
  wiring:
    - progress routes to all expected commands
    - verify-work spawns debugger/planner
    - audit-milestone spawns integration-checker
    - Command discovery works on platform
  key_links:
    - specs/skills/ → install.js → .claude/skills/ → platform discovery
---

# Phase 5 Plan 09: E2E Verification Checkpoint

**Objective:** Verify all 21 Phase 5 commands work correctly through comprehensive sampling strategy

## Context

Phase 5 migrated 21 commands in 8 batches across 3 waves. This checkpoint verifies:
1. All commands exist and generate correctly
2. High-complexity commands work (routing, spawning, lifecycle)
3. No regressions in Phase 3-4 commands
4. Platform discovery and installation work

**Commands migrated in Phase 5:**

**Wave 1 (Plans 01-02):**
- gsd-help, gsd-verify-installation, gsd-list-milestones, gsd-whats-new (Plan 01)
- gsd-pause-work, gsd-resume-work, gsd-list-phase-assumptions (Plan 02)

**Wave 2 (Plans 03-04):**
- gsd-add-phase, gsd-insert-phase, gsd-remove-phase (Plan 03)
- gsd-add-todo, gsd-check-todos (Plan 04)

**Wave 3 (Plans 05-07):**
- gsd-verify-work, gsd-discuss-phase (Plan 05)
- gsd-complete-milestone, gsd-audit-milestone, gsd-plan-milestone-gaps, gsd-archive-milestone, gsd-restore-milestone (Plan 06)
- gsd-update (Plan 07)

**Wave 4 (Plan 08):**
- gsd-progress (Plan 08 - routing hub)

**Total: 21 commands**

**Testing strategy:** Sample high-risk commands (routing, spawning, lifecycle) + spot-check low-risk (reference, utility)

## What Was Built

**Batch 1-2 (Reference + Utility):**
- 7 commands: help, verify-installation, list-milestones, whats-new, pause-work, resume-work, list-phase-assumptions
- Pattern: Display info or workflow delegation, minimal side effects
- Risk: LOW (simple operations)

**Batch 3-4 (Phase + Todo Management):**
- 5 commands: add-phase, insert-phase, remove-phase, add-todo, check-todos
- Pattern: Manipulate ROADMAP.md, create todo files
- Risk: MEDIUM (file writes, parsing logic)

**Batch 5 (Verification Suite):**
- 2 commands: verify-work, discuss-phase
- Pattern: Spawn subagents, workflow delegation
- Risk: HIGH (spawning must work correctly)

**Batch 6 (Milestone Lifecycle):**
- 5 commands: complete-milestone, audit-milestone, plan-milestone-gaps, archive-milestone, restore-milestone
- Pattern: Complex dependency chain, spawning
- Risk: HIGH (lifecycle flow must be intact)

**Batch 7 (Update):**
- 1 command: update
- Pattern: Git operations, npm install
- Risk: MEDIUM (bash-heavy)

**Batch 8 (Progress Hub):**
- 1 command: progress
- Pattern: Routes to 11 commands
- Risk: VERY HIGH (all routes must work)

## Verification Steps

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
All 21 Phase 5 commands migrated to specs/skills/ and generated to .claude/skills/

Commands span 6 categories:
1. Reference commands (4) - display info
2. Utility commands (3) - workflow delegation
3. Phase management (3) - manipulate roadmap
4. Todo management (2) - create/check todos
5. Verification suite (2) - UAT testing, discussion
6. Milestone lifecycle (5) - complete/audit/archive flow
7. Progress hub (1) - route to 11 commands
8. Update (1) - update GSD installation
  </what-built>
  
  <how-to-verify>

### Step 1: Verify All Commands Generated (2 minutes)

Check all 21 commands exist:

```bash
cd .planning/phases/05-simple-command-migration

# List all Phase 5 commands that should exist
PHASE_5_COMMANDS=(
  "gsd-help"
  "gsd-verify-installation"
  "gsd-list-milestones"
  "gsd-whats-new"
  "gsd-pause-work"
  "gsd-list-phase-assumptions"
  "gsd-resume-work"
  "gsd-add-phase"
  "gsd-insert-phase"
  "gsd-remove-phase"
  "gsd-add-todo"
  "gsd-check-todos"
  "gsd-verify-work"
  "gsd-discuss-phase"
  "gsd-complete-milestone"
  "gsd-audit-milestone"
  "gsd-plan-milestone-gaps"
  "gsd-archive-milestone"
  "gsd-restore-milestone"
  "gsd-update"
  "gsd-progress"
)

echo "=== Phase 5 Command Check ==="
MISSING=0
for cmd in "${PHASE_5_COMMANDS[@]}"; do
  if [ -f "../../specs/skills/${cmd}/SKILL.md" ] && [ -f "../../.claude/skills/${cmd}.md" ]; then
    echo "✓ ${cmd}"
  else
    echo "✗ ${cmd} (MISSING)"
    MISSING=$((MISSING + 1))
  fi
done

echo ""
if [ $MISSING -eq 0 ]; then
  echo "✓ All 21 Phase 5 commands exist"
else
  echo "✗ ${MISSING} commands missing - STOP"
fi
```

**Expected:** All 21 commands show ✓

---

### Step 2: Test Progress Routing (5 minutes) - CRITICAL

Progress is the highest-risk command. Test routing logic:

```bash
# Test 1: No .planning/ directory (should route to new-project)
cd /tmp
mkdir test-progress-1
cd test-progress-1

# Run progress - should detect no .planning/ and recommend new-project
/gsd:progress

# Expected output: "Start new project: /gsd:new-project"
```

**Expected:** Progress detects missing .planning/ and recommends new-project

```bash
# Test 2: With .planning/ but needs planning (should route to discuss or plan)
cd /workspace
/gsd:progress

# Expected: Routes to appropriate command based on project state
# - If phase needs planning: routes to discuss-phase or plan-phase
# - If plans exist: routes to execute-phase
# - If phase complete: routes to next phase or complete-milestone
```

**Expected:** Progress analyzes state and routes to logical next action

```bash
# Test 3: Verify routing targets exist
# Progress references 11 commands - check they all exist

PROGRESS_ROUTES=(
  "gsd-new-project"
  "gsd-execute-phase"
  "gsd-plan-phase"
  "gsd-research-phase"
  "gsd-discuss-phase"
  "gsd-list-phase-assumptions"
  "gsd-verify-work"
  "gsd-complete-milestone"
  "gsd-new-milestone"
  "gsd-check-todos"
  "gsd-debug"
)

echo "=== Progress Routing Targets ==="
for cmd in "${PROGRESS_ROUTES[@]}"; do
  if [ -f ".claude/skills/${cmd}.md" ]; then
    echo "✓ ${cmd} (route target exists)"
  else
    echo "✗ ${cmd} (MISSING - routing will fail)"
  fi
done
```

**Expected:** All 11 routing targets exist

---

### Step 3: Test Spawning Commands (3 minutes) - HIGH PRIORITY

Test commands that spawn subagents:

**Test verify-work spawning:**
```bash
# Check verify-work has spawning logic
grep -A 10 "agent_type.*gsd-debugger" .claude/skills/gsd-verify-work.md
grep -A 10 "agent_type.*gsd-planner" .claude/skills/gsd-verify-work.md

# Expected: Both spawn patterns exist (debugger for bugs, planner for gaps)
```

**Test audit-milestone spawning:**
```bash
# Check audit-milestone spawns integration-checker
grep -A 10 "agent_type.*gsd-integration-checker" .claude/skills/gsd-audit-milestone.md

# Expected: Spawn pattern exists with full context
```

**Test plan-milestone-gaps spawning:**
```bash
# Check plan-milestone-gaps spawns planner
grep -A 10 "agent_type.*gsd-planner" .claude/skills/gsd-plan-milestone-gaps.md

# Expected: Spawn pattern exists for gap closure
```

**Expected:** All spawning logic preserved in generated skills

---

### Step 4: Test Milestone Lifecycle Flow (4 minutes)

Verify milestone lifecycle dependency chain is intact:

```bash
# Check complete-milestone references audit
grep "audit-milestone" .claude/skills/gsd-complete-milestone.md

# Expected: complete-milestone checks for audit before proceeding

# Check audit status affects routing
grep "status: passed\|status: gaps_found" .claude/skills/gsd-complete-milestone.md

# Expected: Different actions based on audit status

# Check archive/restore are inverse operations
diff <(grep "mv.*milestones.*history" .claude/skills/gsd-archive-milestone.md) \
     <(grep "mv.*history.*milestones" .claude/skills/gsd-restore-milestone.md)

# Expected: Archive moves milestones→history, restore moves history→milestones
```

**Expected:** Dependency chain preserved, audit gates completion

---

### Step 5: Spot-Check Reference Commands (2 minutes)

Quick checks on low-risk commands:

```bash
# Test help command
/gsd:help

# Expected: Displays command reference (no errors)

# Test verify-installation
/gsd:verify-installation

# Expected: Runs diagnostics, reports status

# Test list-milestones (if milestones exist)
/gsd:list-milestones 2>/dev/null || echo "(No milestones - expected for fresh install)"

# Expected: Lists milestones or reports none exist
```

**Expected:** Reference commands display info without errors

---

### Step 6: Phase 3-4 Regression Check (2 minutes)

Verify Phase 3-4 commands still work after Phase 5 changes:

```bash
# Check Phase 3 orchestrators still exist
ls .claude/skills/gsd-new-project.md
ls .claude/skills/gsd-execute-phase.md
ls .claude/skills/gsd-new-milestone.md

# Check Phase 4 commands still exist
ls .claude/skills/gsd-plan-phase.md
ls .claude/skills/gsd-research-phase.md
ls .claude/skills/gsd-debug.md
ls .claude/skills/gsd-map-codebase.md

# Expected: All Phase 3-4 commands still present
```

**Expected:** No regressions - Phase 3-4 commands still exist

---

### Step 7: Generation Test (2 minutes)

Verify generation works from scratch:

```bash
# Clean generated skills
rm -rf .claude/skills/gsd-*.md

# Regenerate
npm run install:local

# Count generated Phase 5 skills
ls .claude/skills/gsd-*.md | wc -l

# Expected: At least 21 Phase 5 commands generated (plus Phase 3-4)
```

**Expected:** Clean generation produces all skills

---

### Total verification time: ~20 minutes

  </how-to-verify>
  
  <resume-signal>
**After testing, report results:**

If all checks passed:
```
approved - all 21 commands work correctly
```

If issues found:
```
issues: [describe what failed and which commands]
```

Examples:
- "issues: progress routing fails - gsd-discuss-phase not found"
- "issues: audit-milestone spawning broken - no agent_type in generated file"
- "issues: archive-milestone file moves fail - incorrect paths"

**Next steps after approval:**
- Commit all Phase 5 specs and plans
- Update ROADMAP.md with completion status
- Update STATE.md to Phase 6
- Proceed to Phase 6 (Orchestration Validation)
  </resume-signal>
</task>

## Success Criteria

Verification passes when:
- [ ] All 21 Phase 5 commands exist (specs + generated)
- [ ] Progress routing works and targets all 11 commands
- [ ] Spawning commands preserve agent invocation logic
- [ ] Milestone lifecycle dependency chain intact
- [ ] Reference commands display info without errors
- [ ] No regressions in Phase 3-4 commands
- [ ] Clean generation from scratch works

## Critical Tests

**Must pass:**
1. **Progress routing** - Highest risk, routes to 11 commands
2. **Spawning preservation** - verify-work, audit-milestone, plan-milestone-gaps
3. **Lifecycle flow** - complete checks audit, audit spawns checker

**Should pass:**
4. Reference commands display correctly
5. Phase 3-4 commands still work
6. Clean generation produces all skills

## If Verification Fails

**Common issues and fixes:**

| Issue | Likely Cause | Fix |
|-------|--------------|-----|
| Progress routing fails | Command not generated | Check specs/skills/, regenerate |
| Spawning broken | Task tool syntax error | Review PLAN.md task structure |
| Lifecycle flow broken | Dependency checks missing | Review complete-milestone logic |
| Generation fails | Template syntax error | Check install.js logs |
| Discovery fails | Platform adapter issue | Check claudeAdapter.getTargetDirs() |

## Output

After approval:
- Phase 5 complete (21 commands migrated)
- Ready for Phase 6 (Orchestration Validation)
- All Phase 3-5 commands available (29 total)

After issues:
- Create gap closure plans for failed commands
- Fix and re-verify before proceeding
