---
phase: 01-dependency-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
autonomous: true
must_haves:
  - commander_importable: "Commander.js v14+ is importable via require('commander') in install.js context"
  - prompts_importable: "Prompts v2.4+ is importable via require('prompts') in install.js context"
  - no_conflicts: "npm install completes without dependency conflicts or version warnings"
  - version_locked: "Commander.js locked to exact 14.0.2 in package.json dependencies section"
  - verified_functional: "Basic instantiation test passes for both libraries (new Command(), prompts())"
---

# Phase 01, Plan 01: Install and Verify CLI Libraries

## Objective

Add Commander.js as a direct dependency and verify both Commander.js and Prompts libraries are correctly installed and functional for subsequent phases.

## Context

**Current state:**
- Prompts v2.4.2 is already installed as direct dependency (package.json line 77)
- Commander.js v14.0.2 exists as transitive dependency via markdown-link-check
- Commander.js is importable but NOT in package.json dependencies (unstable - could break if markdown-link-check is removed)

**Why this matters:**
- Phase 2 (Flag System) requires Commander.js for argument parsing
- Phase 3 (Interactive Menu) requires Prompts for multi-select UI
- Direct dependency ensures stability and explicit version control

**Research findings:**
- Commander.js v14.0.2 is latest v14 stable (zero dependencies)
- Prompts v2.4.2 is current stable (2 dependencies: kleur, sisteransi)
- No dependency conflicts detected
- Both use CommonJS (matches project's "type": "commonjs")
- Import pattern verified: `const { Command } = require('commander')`, `const prompts = require('prompts')`

**Validation results:**
- âœ… Commander.js v14 multi-flag parsing tested successfully
- âœ… Prompts TTY detection and multiselect verified
- âœ… No integration issues found

## Tasks

<task name="add-commander-dependency" type="auto">
  <files>package.json, package-lock.json</files>
  <action>
    Add Commander.js as direct dependency to make it explicit and stable.

    1. Install Commander.js with exact version:
       ```bash
       npm install --save-exact commander@14.0.2
       ```

    2. Verify installation:
       ```bash
       npm list commander
       ```
       Expected: Shows commander@14.0.2 as direct dependency (not nested/deduped)

    3. Check for conflicts:
       ```bash
       npm ls | grep -i conflict || echo "No conflicts"
       ```

    **Why exact 14.0.2:**
    - User preference for strictest version control
    - Prevents ANY unexpected updates (no patch or minor bumps)
    - Ensures reproducible builds across environments
    - Validation confirmed 14.0.2 works perfectly

    **Expected changes:**
    - package.json: New entry under dependencies: `"commander": "14.0.2"` (exact version, no caret)
    - package-lock.json: Updated with commander details (may deduplicate with existing transitive)
  </action>
  <verify>
    ```bash
    # Verify Commander.js is in dependencies with exact version (no caret)
    grep -A 5 '"dependencies"' package.json | grep commander

    # Verify exact version 14.0.2 (not a range)
    grep '"commander": "14.0.2"' package.json

    # Verify installation successful
    npm list commander --depth=0
    ```

    **Success criteria:**
    - package.json contains `"commander": "14.0.2"` (exact, no ^ or ~)
    - `npm list commander --depth=0` shows no warnings
    - Exit code 0 from npm install
  </verify>
  <done>
    Commander.js 14.0.2 is installed as direct dependency with exact version in package.json
  </done>
</task>

<task name="verify-library-imports" type="auto">
  <files>None (validation only)</files>
  <action>
    Create temporary verification script to confirm both libraries load and instantiate correctly.

    1. Create test script:
       ```bash
       cat > /tmp/verify-cli-deps.js << 'EOF'
       #!/usr/bin/env node
       const path = require('path');
       
       // Change to workspace to use installed dependencies
       process.chdir('/workspace');
       
       console.log('Verifying CLI library installation...\n');
       
       // Test 1: Import Commander.js
       try {
         const { Command } = require('commander');
         console.log('âœ“ Commander.js imported successfully');
         
         // Test instantiation
         const program = new Command();
         program
           .name('test')
           .version('1.0.0')
           .option('--test', 'test flag');
         program.parse(['node', 'test', '--test']);
         const opts = program.opts();
         
         if (opts.test === true) {
           console.log('âœ“ Commander.js instantiation and parsing works');
         } else {
           throw new Error('Flag parsing failed');
         }
       } catch (err) {
         console.error('âœ— Commander.js failed:', err.message);
         process.exit(1);
       }
       
       // Test 2: Import Prompts
       try {
         const prompts = require('prompts');
         console.log('âœ“ Prompts imported successfully');
         
         // Test configuration (don't execute, just validate structure)
         const testConfig = {
           type: 'select',
           name: 'test',
           message: 'Test',
           choices: [{ title: 'Option', value: 'opt' }]
         };
         
         if (typeof prompts === 'function') {
           console.log('âœ“ Prompts is callable function');
         } else {
           throw new Error('Prompts is not a function');
         }
       } catch (err) {
         console.error('âœ— Prompts failed:', err.message);
         process.exit(1);
       }
       
       console.log('\nâœ… All dependency verifications passed');
       console.log('   Commander.js: Ready for Phase 2 (Flag System)');
       console.log('   Prompts: Ready for Phase 3 (Interactive Menu)');
       EOF
       
       chmod +x /tmp/verify-cli-deps.js
       ```

    2. Run verification:
       ```bash
       node /tmp/verify-cli-deps.js
       ```

    3. Clean up:
       ```bash
       rm /tmp/verify-cli-deps.js
       ```

    **What this verifies:**
    - Both libraries load via require() without errors
    - Commander.js Command class instantiates correctly
    - Commander.js option parsing works with test flag
    - Prompts function is callable
    - No runtime errors or missing dependencies

    **Why not a permanent test:**
    - This is a one-time installation verification
    - Unit tests for actual usage will be added in Phase 7 (Testing & QA)
    - Temporary script keeps codebase clean
  </action>
  <verify>
    ```bash
    # Run verification script (if still exists, for verification step)
    if [ -f /tmp/verify-cli-deps.js ]; then
      node /tmp/verify-cli-deps.js
    else
      # Manual verification
      node -e "
        const { Command } = require('commander');
        const prompts = require('prompts');
        console.log('âœ“ Both libraries importable');
      "
    fi
    ```

    **Success criteria:**
    - Script outputs "âœ… All dependency verifications passed"
    - No import errors or exceptions thrown
    - Both Commander.js and Prompts load successfully
  </verify>
  <done>
    Import verification confirms Commander.js v14+ and Prompts v2.4+ are functional and ready for Phase 2 and Phase 3
  </done>
</task>

<task name="verify-version-requirements" type="auto">
  <files>None (verification only)</files>
  <action>
    Confirm final installed versions match requirements.

    1. Check installed versions:
       ```bash
       npm list commander prompts --depth=0
       ```

    2. Verify version requirements:
       ```bash
       cat << EOF
       
       ðŸ“¦ Dependency Setup Complete
       
       Installed versions:
       - Commander.js: $(node -e "console.log(require('commander/package.json').version)")
       - Prompts: $(node -e "console.log(require('prompts/package.json').version)")
       
       Requirements satisfied:
       âœ“ DEPS-01: Commander.js v14+ installed (requirement: v14+, actual: $(node -e "console.log(require('commander/package.json').version)"))
       âœ“ DEPS-02: Prompts v2.4+ verified (requirement: v2.4+, actual: $(node -e "console.log(require('prompts/package.json').version)"))
       
       Ready for Phase 2: Flag System Redesign
       EOF
       ```

    **This task:**
    - Confirms versions meet Phase 1 success criteria
    - Provides clear completion signal
    - No code changes (verification only)
    - No documentation files created (package.json is sufficient)
  </action>
  <verify>
    ```bash
    # Verify Commander.js >= 14.0.0
    COMMANDER_VERSION=$(node -e "console.log(require('commander/package.json').version)")
    COMMANDER_MAJOR=$(echo $COMMANDER_VERSION | cut -d. -f1)
    [ "$COMMANDER_MAJOR" -ge 14 ] && echo "âœ“ Commander.js v$COMMANDER_VERSION >= v14" || exit 1

    # Verify Prompts >= 2.4.0
    PROMPTS_VERSION=$(node -e "console.log(require('prompts/package.json').version)")
    PROMPTS_MAJOR=$(echo $PROMPTS_VERSION | cut -d. -f1)
    PROMPTS_MINOR=$(echo $PROMPTS_VERSION | cut -d. -f2)
    [ "$PROMPTS_MAJOR" -ge 2 ] && [ "$PROMPTS_MINOR" -ge 4 ] && echo "âœ“ Prompts v$PROMPTS_VERSION >= v2.4" || exit 1
    ```

    **Success criteria:**
    - Commander.js version is 14.x.x or higher
    - Prompts version is 2.4.x or higher
    - Both version checks pass
  </verify>
  <done>
    Version verification confirms Phase 1 success criteria met: Commander.js v14+ and Prompts v2.4+ are installed and functional
  </done>
</task>

## Verification

**Phase 1 complete when:**

1. **Commander.js installed:**
   - Listed in package.json dependencies with exact `14.0.2` (no caret)
   - `npm list commander --depth=0` shows no warnings
   - Importable via `require('commander')` in project context

2. **Prompts verified:**
   - Already in package.json dependencies (no change needed)
   - `npm list prompts --depth=0` shows no warnings
   - Importable via `require('prompts')` in project context

3. **No conflicts:**
   - `npm install` completes without errors
   - No dependency version conflicts in output
   - package-lock.json updated without issues

4. **Functional verification:**
   - Verification script passes all checks
   - Commander.js Command instantiates and parses flags
   - Prompts function is callable
   - Both libraries match version requirements (v14+, v2.4+)

**Verification commands:**
```bash
# Check installations
npm list commander prompts --depth=0

# Quick import test
node -e "const {Command} = require('commander'); const p = require('prompts'); console.log('OK')"

# Version check
echo "Commander: $(node -e "console.log(require('commander/package.json').version)")"
echo "Prompts: $(node -e "console.log(require('prompts/package.json').version)")"
```

## Success Criteria

**Observable outcomes:**

1. **User can install flags in Phase 2:**
   - Commander.js available for `require('commander')` in install.js
   - No import errors when adding flag parsing code
   - Version is stable and won't break if markdown-link-check updates

2. **User can implement menu in Phase 3:**
   - Prompts available for `require('prompts')` in install.js
   - No import errors when adding interactive menu code
   - Multi-select and TTY detection features available

3. **Installation is stable:**
   - Dependencies won't disappear if transitive deps change
   - Version ranges allow security patches but prevent breaking changes
   - Future `npm install` commands reproduce same environment

**Phase goal achieved:**
âœ… Development environment has modern CLI libraries installed and verified compatible

## Output

**Files modified:**
- `package.json` â€” Commander.js added to dependencies
- `package-lock.json` â€” Lockfile updated with Commander.js details

**Verification artifacts:**
- Console output confirming versions
- No errors from npm install
- Import test passes

**Ready for next phase:**
Phase 2 (Flag System Redesign) can begin immediately - all required dependencies are in place.
