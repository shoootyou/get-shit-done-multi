---
phase: 03-high-complexity-orchestrators
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - specs/skills/gsd-execute-phase/SKILL.md
  - specs/skills/gsd-execute-phase/_examples/ (optional)
autonomous: true
must_haves:
  goal: "Migrate execute-phase orchestrator preserving wave-based parallelization and checkpoint protocol"
  truths:
    - File specs/skills/gsd-execute-phase/SKILL.md exists with complete spec
    - Multi-section XML structure preserved (<objective>, <execution_context>, <process>, <output>)
    - All @-references preserved exactly (templates, references, planning artifacts)
    - Wave-based execution logic intact (group by wave, spawn parallel, wait, next wave)
    - Checkpoint protocol documented (<resume_protocol>, blocking gates)
    - Task tool declared in frontmatter (parallel executor spawning)
    - Generated command installs to .claude/ successfully
  artifacts:
    - specs/skills/gsd-execute-phase/SKILL.md
    - .claude/gsd-execute-phase.md (generated output)
  wiring:
    - Frontmatter includes Task, Read, Write, Bash tools
    - Body contains unmodified orchestration logic from legacy
    - Metadata auto-generates via template system
  key_links:
    - SKILL.md → install.js::generateSkillsFromSpecs → .claude/gsd-execute-phase.md
---

# Phase 3 Plan 02: Migrate execute-phase Orchestrator

**Objective:** Migrate gsd-execute-phase to spec format, preserving wave-based parallelization, checkpoint protocol, and @-reference structure

## Context

The execute-phase orchestrator (305 lines, 2 @-references, dynamic subagent spawns) is the simplest of the three Phase 3 orchestrators, making it ideal for Wave 1. It reads plans from phase directories, groups by wave number, spawns gsd-executor agents in parallel for each wave, and handles checkpoints.

**From Research (03-RESEARCH.md):**
- Pattern: Wave-based execution with parallel spawning per wave
- Critical: Preserve checkpoint protocol (blocking gates, resume signals)
- Structure: Multi-section XML (`<process>` with nested `<step>`, `<phase>`)
- @-references: 2 total (STATE.md, plan files via @-reference variables)

**From Dependency Audit (03-01):**
- Risk: MEDIUM (wave logic, checkpoint handling)
- Dependencies: None on other Phase 3 commands
- Spawns: gsd-executor (dynamic count based on plans in wave)
- Safe for Wave 1: No creation dependencies, orchestrator-only

## Tasks

<task name="create-execute-phase-spec-structure" type="auto">
  <files>specs/skills/gsd-execute-phase/SKILL.md</files>
  <action>
Create folder-per-skill structure and initial SKILL.md file for gsd-execute-phase.

```bash
# Create folder
mkdir -p specs/skills/gsd-execute-phase

# Create SKILL.md with frontmatter
cat > specs/skills/gsd-execute-phase/SKILL.md << 'EOF'
---
name: gsd-execute-phase
description: Execute phase plans with wave-based parallelization and checkpoint handling
skill_version: 1.9.1
requires_version: 1.9.0+
platforms:
  - claude
  - copilot
  - codex
tools:
  - name: task
    required: true
    reason: Spawn gsd-executor agents in parallel per wave
  - name: read
    required: true
    reason: Load plan files and phase metadata
  - name: write
    required: false
    reason: Update STATE.md progress tracking
  - name: bash
    required: true
    reason: Git operations, file discovery, validation
arguments:
  - name: phase
    type: string
    required: true
    description: Phase number or name to execute
  - name: --gaps-only
    type: flag
    required: false
    description: Execute only gap closure plans
metadata:
  generated: {{generated}}
  platform: {{platform}}
  version: {{version}}
---

[Body content will be migrated in next task]
EOF
```

**Verify folder structure matches convention:**
```bash
ls -la specs/skills/gsd-execute-phase/
# Should show: SKILL.md
```
  </action>
  <verify>
```bash
# Verify folder and file exist
test -d specs/skills/gsd-execute-phase
test -f specs/skills/gsd-execute-phase/SKILL.md

# Verify frontmatter has required fields
grep -q "name: gsd-execute-phase" specs/skills/gsd-execute-phase/SKILL.md
grep -q "tools:" specs/skills/gsd-execute-phase/SKILL.md
grep -q "task" specs/skills/gsd-execute-phase/SKILL.md
```
  </verify>
  <done>
- Folder specs/skills/gsd-execute-phase/ exists
- SKILL.md file created with complete frontmatter
- Tool declarations include Task (for spawning)
- Arguments section documents phase and --gaps-only flag
  </done>
</task>

<task name="migrate-execute-phase-body" type="auto">
  <files>specs/skills/gsd-execute-phase/SKILL.md</files>
  <action>
Migrate the body content from legacy commands/gsd/execute-phase.md to SKILL.md, preserving exact structure.

**1. Read legacy command:**
```bash
cat commands/gsd/execute-phase.md
```

**2. Extract body sections to preserve:**
- `<role>` section (orchestrator identity)
- `<objective>` section (what this command does)
- `<execution_context>` section (with @-references)
- `<process>` section (step-by-step execution flow)
- `<wave_execution>` section (parallel spawning pattern)
- `<checkpoint_protocol>` section (blocking gates, resume signals)
- `<output>` section (STATE.md updates, structured returns)
- `<success_criteria>` section (what must be true when complete)

**3. Preserve @-references EXACTLY:**

From legacy execute-phase.md:
```xml
<execution_context>
@.planning/STATE.md
</execution_context>
```

And within process steps (variable @-references):
```xml
<step name="execute_wave">
For each plan in wave:
  Spawn: Task(prompt="Execute plan at {plan_path}\n\nPlan: @{plan_path}", ...)
</step>
```

**Critical:** Don't resolve or inline @-references. They're runtime context injection points.

**4. Preserve XML structure:**

Keep multi-section nesting intact:
```xml
<process>
  <step name="discover_phase">
    [content]
  </step>
  <step name="load_plans">
    [content]
  </step>
  <step name="group_by_wave">
    [content]
  </step>
  <step name="execute_waves">
    For each wave in order:
    [parallel spawn pattern]
  </step>
  <step name="handle_checkpoint">
    [checkpoint protocol]
  </step>
</process>
```

**5. Append body to SKILL.md after frontmatter:**
```bash
# Append body content after the closing --- of frontmatter
# Use cat or editor to add complete body
```

**From Research pitfall warnings:**
- ❌ Don't convert XML to Markdown headers
- ❌ Don't inline @-references
- ❌ Don't change parallel spawn to sequential
- ✅ Preserve exact structure, just change filename
  </action>
  <verify>
```bash
# Verify body sections exist
grep -q "<objective>" specs/skills/gsd-execute-phase/SKILL.md
grep -q "<execution_context>" specs/skills/gsd-execute-phase/SKILL.md
grep -q "<process>" specs/skills/gsd-execute-phase/SKILL.md
grep -q "<wave_execution>" specs/skills/gsd-execute-phase/SKILL.md
grep -q "<checkpoint_protocol>" specs/skills/gsd-execute-phase/SKILL.md

# Verify @-references preserved
grep -q "@.planning/STATE.md" specs/skills/gsd-execute-phase/SKILL.md

# Verify Task tool spawning pattern preserved
grep -q "Task(prompt=" specs/skills/gsd-execute-phase/SKILL.md
grep -q "gsd-executor" specs/skills/gsd-execute-phase/SKILL.md

# Count lines to verify complete migration (should be ~300+ lines)
wc -l specs/skills/gsd-execute-phase/SKILL.md
```
  </verify>
  <done>
- Body content migrated from legacy command
- All XML sections preserved exactly
- @-references intact (STATE.md, plan files)
- Wave-based spawning pattern preserved
- Checkpoint protocol documented
- File is ~350+ lines (frontmatter + body)
  </done>
</task>

<task name="test-execute-phase-generation" type="auto">
  <files>.claude/gsd-execute-phase.md</files>
  <action>
Generate and validate the execute-phase skill output using template system.

**1. Generate skill:**
```bash
# Use install.js to generate from spec
node bin/install.js --platform claude --install skills

# Or test generation directly
node -e "
const { generateSkillsFromSpecs } = require('./bin/install.js');
const result = generateSkillsFromSpecs(
  './specs/skills',
  './.claude',
  'claude'
);
console.log('Generated:', result.generated);
console.log('Failed:', result.failed);
if (result.errors.length > 0) {
  console.error('Errors:', result.errors);
  process.exit(1);
}
"
```

**2. Verify generated output:**
```bash
# Check file exists
test -f .claude/gsd-execute-phase.md

# Verify metadata auto-generated
grep -q "generated:" .claude/gsd-execute-phase.md
grep -q "platform: claude" .claude/gsd-execute-phase.md

# Verify body content preserved
grep -q "<wave_execution>" .claude/gsd-execute-phase.md
grep -q "@.planning/STATE.md" .claude/gsd-execute-phase.md

# Line count should match spec (within 10 lines for metadata)
wc -l specs/skills/gsd-execute-phase/SKILL.md .claude/gsd-execute-phase.md
```

**3. Compare to legacy (sanity check):**
```bash
# Should have similar structure
diff -u commands/gsd/execute-phase.md .claude/gsd-execute-phase.md | head -50
# Expect differences: frontmatter format, metadata fields
# Should match: body content, @-references, XML structure
```
  </action>
  <verify>
```bash
# Verify successful generation
test -f .claude/gsd-execute-phase.md

# Verify key elements present
grep -q "gsd-execute-phase" .claude/gsd-execute-phase.md
grep -q "wave" .claude/gsd-execute-phase.md
grep -q "Task(prompt=" .claude/gsd-execute-phase.md
grep -q "gsd-executor" .claude/gsd-execute-phase.md

echo "✅ Execute-phase generated successfully"
```
  </verify>
  <done>
- Generated file exists in .claude/
- Metadata fields auto-generated correctly
- Body content preserved from spec
- @-references intact in output
- Wave-based spawning pattern present
- Ready for E2E testing in 03-04
  </done>
</task>

## Verification

```bash
# Complete migration validation
test -f specs/skills/gsd-execute-phase/SKILL.md
test -f .claude/gsd-execute-phase.md

# Structural validation
grep -c "<.*>" specs/skills/gsd-execute-phase/SKILL.md
# Should be 10+ (XML sections)

grep -c "@" specs/skills/gsd-execute-phase/SKILL.md
# Should match legacy count (2-3)

# Generation validation
node bin/install.js --platform claude --install skills | grep "gsd-execute-phase"
# Should show successful generation
```

## Success Criteria

- [x] specs/skills/gsd-execute-phase/SKILL.md exists with complete spec
- [x] Frontmatter declares Task, Read, Write, Bash tools
- [x] Body preserves multi-section XML structure
- [x] All @-references preserved exactly
- [x] Wave-based execution logic intact
- [x] Checkpoint protocol documented
- [x] Generated output in .claude/ matches spec
- [x] Template system generates without errors

## Output

**Created:**
- `specs/skills/gsd-execute-phase/SKILL.md` - Complete orchestrator spec (~350 lines)
- `.claude/gsd-execute-phase.md` - Generated command (auto from spec)

**Technical notes:**
- Simplest orchestrator, proves migration pattern for 03-03
- Wave logic preserved exactly (critical for parallelization)
- Checkpoint protocol maintained (blocking gates)
- No changes to template system needed (proven pattern works)
