---
phase: 06-documentation-verification
plan: 06
type: execute
wave: 3
depends_on: [06-01, 06-04, 06-05]
files_modified:
  - hooks/pre-commit-docs
  - bin/validate-docs.js
  - bin/doc-generator/add-version-stamps.js
  - package.json
autonomous: true

must_haves:
  truths:
    - "Documentation automatically regenerates when code changes"
    - "Generated docs include version stamps showing generation date"
    - "Doc validation catches broken links and stale content"
    - "pre-commit hook prevents committing outdated docs"
  artifacts:
    - path: "hooks/pre-commit-docs"
      provides: "Git pre-commit hook for doc regeneration"
      min_lines: 40
      contains: "#!/bin/bash"
    - path: "bin/validate-docs.js"
      provides: "Documentation validation script"
      min_lines: 100
      exports: ["validateDocs", "checkLinks", "checkFreshness"]
    - path: "bin/doc-generator/add-version-stamps.js"
      provides: "Add version and timestamp to generated docs"
      min_lines: 50
      exports: ["addVersionStamp"]
  key_links:
    - from: "hooks/pre-commit-docs"
      to: "bin/doc-generator/*.js"
      via: "node command execution"
      pattern: "node bin/doc-generator"
    - from: "hooks/pre-commit-docs"
      to: "bin/validate-docs.js"
      via: "node command execution"
      pattern: "node bin/validate-docs"
    - from: "bin/validate-docs.js"
      to: "docs/*.md"
      via: "fs.readFile and link checking"
      pattern: "readFile.*docs/"
---

<objective>
Create documentation automation tooling including pre-commit hook, version stamping, and validation to ensure docs stay accurate and in sync with code.

Purpose: Prevent stale documentation and broken links. Automate doc generation so developers never manually update docs. Satisfies DOCS-08, DOCS-09, DOCS-10 requirements.
Output: Automated documentation pipeline with validation and version tracking.
</objective>

<execution_context>
@.github/skills/get-shit-done/get-shit-done/workflows/execute-plan.md
@.github/skills/get-shit-done/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-documentation-verification/06-RESEARCH.md

# Doc generators to integrate
@bin/doc-generator/generate-comparison.js
@bin/doc-generator/generate-matrix.js
@bin/doc-generator/extract-capabilities.js

# Generated docs to validate
@docs/cli-comparison.md
@docs/capability-matrix.html
</context>

<tasks>

<task type="auto">
  <name>Create documentation version stamping</name>
  <files>bin/doc-generator/add-version-stamps.js</files>
  <action>
Create utility to add version stamps and "Added in vX.Y" badges to generated documentation.

**Functions:**

addVersionStamp(filePath, options):
- Read generated Markdown file
- Add header with metadata:
  ```markdown
  ---
  generated: true
  timestamp: 2026-01-20T00:00:00Z
  generator: generate-comparison.js
  gsd-version: 2.0.0
  ---
  
  > **Note:** This file is auto-generated. Do not edit manually.
  > Last generated: January 20, 2026
  ```
- Add version badges for new features: `Added in v2.0.0`
- Use package.json version for gsd-version
- Return updated content

addFeatureBadge(text, version):
- Parse text for feature descriptions
- Add inline badges: "Feature X `Added in v2.0.0`"
- Use simple regex matching

stampAllDocs(docsDir):
- Iterate through docs/
- Stamp all generated files (cli-comparison.md, capability-matrix.html)
- Skip manually written docs (setup guides, troubleshooting)

Use fs.promises, package.json for version, zero npm dependencies.
Follow research: Documentation versioning best practices.
  </action>
  <verify>
```bash
node bin/doc-generator/add-version-stamps.js docs/cli-comparison.md && \
grep -q "generated: true" docs/cli-comparison.md && \
grep -q "Last generated:" docs/cli-comparison.md && \
echo "PASS" || echo "FAIL"
```
  </verify>
  <done>add-version-stamps.js adds metadata header, timestamp, and version to generated docs, preventing manual edits and showing freshness</done>
</task>

<task type="auto">
  <name>Create documentation validation script</name>
  <files>bin/validate-docs.js</files>
  <action>
Create comprehensive documentation validator checking links, freshness, and structure.

**Validation checks:**

1. **checkBrokenLinks(docsDir):**
   - Parse all .md files for links: `[text](path.md)`
   - Check if target files exist
   - Warn about external links (can't verify)
   - Return: { valid: boolean, brokenLinks: [] }

2. **checkFreshness(docsDir):**
   - Check generated docs have version stamps
   - Warn if timestamp > 7 days old
   - Check if capability-data.json matches capability-matrix.js
   - Return: { fresh: boolean, staleFiles: [] }

3. **checkStructure(docsDir):**
   - Verify required files exist:
     - cli-comparison.md
     - setup-*.md (3 files)
     - troubleshooting.md
     - migration-guide.md
     - capability-matrix.html
   - Check each file has required sections (## headers)
   - Return: { valid: boolean, missing: [], incomplete: [] }

4. **validateDocs(docsDir):**
   - Run all checks
   - Format results with ✓/✗ indicators
   - Exit with code 1 if any check fails
   - Return: { success: boolean, results: {} }

**CLI interface:**
```bash
node bin/validate-docs.js
# Outputs:
# ✓ Link validation passed
# ✗ Freshness check failed: cli-comparison.md is 10 days old
# ✓ Structure validation passed
```

Use fs.promises, path, zero npm dependencies.
Follow research: Documentation validation pattern.
  </action>
  <verify>
```bash
node bin/validate-docs.js && echo "PASS" || echo "FAIL (expected if docs actually have issues)"
```
  </verify>
  <done>validate-docs.js checks for broken links, stale content, and missing structure with clear pass/fail output and exit codes</done>
</task>

<task type="auto">
  <name>Create pre-commit hook and wire automation</name>
  <files>hooks/pre-commit-docs, package.json</files>
  <action>
Create git pre-commit hook that regenerates docs when code changes.

**hooks/pre-commit-docs:**
```bash
#!/bin/bash
# Pre-commit hook: Regenerate documentation if code changes

# Check if doc generators or source files changed
CHANGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)

# Trigger regeneration if:
# - capability-matrix.js changed (affects comparison and matrix)
# - command files changed (affects command docs)
# - state files changed (affects state feature docs)

SHOULD_REGEN=false

if echo "$CHANGED_FILES" | grep -q "bin/lib/orchestration/capability-matrix.js"; then
  echo "Capability matrix changed - regenerating docs..."
  SHOULD_REGEN=true
fi

if echo "$CHANGED_FILES" | grep -q "commands/gsd/"; then
  echo "Command files changed - regenerating docs..."
  SHOULD_REGEN=true
fi

if [ "$SHOULD_REGEN" = true ]; then
  # Regenerate comparison table
  node bin/doc-generator/generate-comparison.js
  
  # Regenerate capability data
  node bin/doc-generator/generate-matrix.js
  node bin/doc-generator/extract-capabilities.js
  
  # Add version stamps
  node bin/doc-generator/add-version-stamps.js docs/cli-comparison.md
  
  # Validate generated docs
  node bin/validate-docs.js
  
  if [ $? -ne 0 ]; then
    echo "❌ Documentation validation failed"
    echo "Fix errors before committing"
    exit 1
  fi
  
  # Stage regenerated docs
  git add docs/cli-comparison.md
  git add docs/capability-data.json
  
  echo "✓ Documentation regenerated and staged"
fi

exit 0
```

**Install hook in package.json:**
Add scripts:
```json
{
  "scripts": {
    "docs:generate": "node bin/doc-generator/generate-comparison.js && node bin/doc-generator/generate-matrix.js && node bin/doc-generator/extract-capabilities.js",
    "docs:validate": "node bin/validate-docs.js",
    "docs:stamp": "node bin/doc-generator/add-version-stamps.js docs/cli-comparison.md",
    "install-hooks": "cp hooks/pre-commit-docs .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit"
  }
}
```

Make hook executable: `chmod +x hooks/pre-commit-docs`

Follow research: pre-commit hook for doc generation pattern.
Document hook installation in README or setup guides.
  </action>
  <verify>
```bash
# Verify hook exists and is executable
test -x hooks/pre-commit-docs && echo "PASS" || echo "FAIL"

# Verify package.json has scripts
grep -q "docs:generate" package.json && echo "PASS" || echo "FAIL"
```
  </verify>
  <done>pre-commit hook regenerates docs when code changes, validates output, stages changes, exits with error if validation fails, DOCS-09 and DOCS-10 requirements satisfied</done>
</task>

</tasks>

<verification>
Test documentation automation end-to-end:
```bash
# Run doc generation pipeline
npm run docs:generate
npm run docs:stamp
npm run docs:validate

# Verify all generated docs have stamps
grep -l "generated: true" docs/*.md

# Test hook (simulate commit)
bash hooks/pre-commit-docs
```

Check that all Phase 6 requirements are satisfied:
```bash
# INSTALL-09: CLI recommendations
node -e "const { getRecommendations } = require('./lib-ghcc/cli-recommender'); console.log(getRecommendations({ currentCLIs: [], platform: 'darwin' }))"

# DOCS-01: CLI comparison table
test -f docs/cli-comparison.md

# DOCS-02: Implementation differences
test -f docs/implementation-differences.md

# DOCS-03: Setup guides
test -f docs/setup-claude-code.md && test -f docs/setup-copilot-cli.md && test -f docs/setup-codex-cli.md

# DOCS-04: Troubleshooting
test -f docs/troubleshooting.md

# DOCS-05: Migration guide
test -f docs/migration-guide.md

# DOCS-06: Auto-generation
test -x bin/doc-generator/generate-comparison.js

# DOCS-07: Interactive matrix
test -f docs/capability-matrix.html

# DOCS-08: Code examples (in setup guides)
grep -q "```bash" docs/setup-claude-code.md

# DOCS-09: Release notes (via version stamps)
grep -q "gsd-version" docs/cli-comparison.md

# DOCS-10: Documentation versioned (via git + stamps)
git log --oneline docs/ | head -5
```
</verification>

<success_criteria>
- [ ] add-version-stamps.js adds metadata header with timestamp and version
- [ ] Generated docs marked as "auto-generated, do not edit manually"
- [ ] validate-docs.js checks for broken links in documentation
- [ ] validate-docs.js checks for stale generated docs (>7 days old warning)
- [ ] validate-docs.js verifies all required doc files exist
- [ ] pre-commit hook regenerates docs when code changes
- [ ] pre-commit hook validates docs before allowing commit
- [ ] pre-commit hook stages regenerated docs automatically
- [ ] package.json scripts enable manual doc generation/validation
- [ ] Hook installation documented for developers
- [ ] All 11 Phase 6 requirements satisfied (INSTALL-09, DOCS-01 through DOCS-10)
- [ ] DOCS-08 satisfied: Code examples throughout setup guides
- [ ] DOCS-09 satisfied: Version stamps indicate when features added
- [ ] DOCS-10 satisfied: Docs versioned in git with generation tracking
</success_criteria>

<output>
After completion, create `.planning/phases/06-documentation-verification/06-06-SUMMARY.md`
</output>
