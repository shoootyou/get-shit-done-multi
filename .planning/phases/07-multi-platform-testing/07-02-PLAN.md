---
phase: 07-multi-platform-testing
plan: 02
type: checkpoint:human-verify
wave: 2
depends_on: [07-01]
files_modified:
  - scripts/test-npm-install.js
  - scripts/test-platform-commands.js
  - scripts/test-regression.js
  - scripts/create-test-project.js
  - test-environments/test-results.json
autonomous: false
must_haves:
  - "npm package installation tested on all 3 platforms (Copilot, Claude, Codex)"
  - "All 29 commands install successfully via npm workflow on each platform (87 total installations)"
  - "Test projects created to simulate real user installation environment"
  - "Commands are discoverable using platform-specific invocation after npm install"
  - "Tool mapping verified: Claude tools map correctly to platform equivalents"
  - "Platform-specific content renders correctly in generated files"
  - "Platform detection with graceful fallbacks tested"
  - "Local package installation tested (npm install /path/to/package)"
  - "Legacy fallback behavior verified when specs missing"
  - "Regression testing expanded to 15-20 commands covering complexity spectrum"
  - "Test results captured in structured JSON format"
---

# Phase 7, Plan 2: NPM Package Installation Testing + Execution

**Objective:** Test real-world npm package installation workflow across 3 platforms and verify command availability with human checkpoints

## Context

This plan tests the actual user experience: installing GSD via npm and using commands. **No git clone** ‚Äî we test the published package workflow.

**CRITICAL CHANGE:** Previous approach cloned the repo. New approach creates minimal test projects and installs GSD as users would: `npm install -g get-shit-done-multi` or local package installation.

**From Context:** Hybrid approach ‚Äî automated install, manual command testing. 100% success threshold (all 29 commands on all 3 platforms). Failure handling: continue testing, batch all failures for review.

**Test strategy:**
1. Automated: Create test projects, install via npm, verify installation
2. Manual: Command execution and output verification (requires human judgment)
3. Automated: Regression comparison (legacy vs spec output diff)

**Why npm installation matters:** Users don't clone repos. They run `npm install`. Installation bugs only surface with the real npm workflow.

## Tasks

<task name="create-test-project-setup" type="auto">
  <files>
    scripts/create-test-project.js
    test-environments/.gitignore
  </files>
  
  <action>
Create script to generate minimal test projects for each platform (simulating real user environment).

**Create scripts/create-test-project.js:**

```javascript
#!/usr/bin/env node
const fs = require('fs');
const path = require('path');

const platforms = ['copilot', 'claude', 'codex'];
const testRoot = path.join(__dirname, '..', 'test-environments');

async function createTestProject(platform) {
  console.log(`\nüì¶ Creating ${platform} test project...`);
  
  const projectDir = path.join(testRoot, `${platform}-test-project`);
  
  // Clean existing
  if (fs.existsSync(projectDir)) {
    console.log(`  üßπ Cleaning existing ${platform}-test-project/...`);
    fs.rmSync(projectDir, { recursive: true, force: true });
  }
  
  // Create directory
  fs.mkdirSync(projectDir, { recursive: true });
  
  // Create minimal package.json
  const packageJson = {
    name: `gsd-test-${platform}`,
    version: '1.0.0',
    private: true,
    description: `Test project for GSD ${platform} installation`,
    main: 'index.js',
    scripts: {},
    keywords: [],
    author: '',
    license: 'ISC'
  };
  
  fs.writeFileSync(
    path.join(projectDir, 'package.json'),
    JSON.stringify(packageJson, null, 2)
  );
  
  // Create .gitignore
  const gitignore = `node_modules/
.claude/
.github/
.codex/
*.log
`;
  fs.writeFileSync(path.join(projectDir, '.gitignore'), gitignore);
  
  // Create README
  const readme = `# GSD ${platform.toUpperCase()} Test Project

Minimal test project for validating GSD npm package installation.

## Test Flow

1. Install GSD: \`npm install <path-to-gsd-package>\`
2. Verify commands installed in platform-specific directory
3. Test command invocation and output
`;
  fs.writeFileSync(path.join(projectDir, 'README.md'), readme);
  
  console.log(`  ‚úÖ ${platform} test project created at ${projectDir}`);
  
  return { platform, projectDir };
}

async function main() {
  console.log('üöÄ Creating test projects for npm installation testing\n');
  console.log(`Test root: ${testRoot}\n`);
  
  const projects = [];
  
  for (const platform of platforms) {
    const result = await createTestProject(platform);
    projects.push(result);
  }
  
  console.log('\n‚úÖ All test projects ready!');
  console.log('\nNext steps:');
  console.log('  1. Install GSD package: node scripts/test-npm-install.js');
  console.log('  2. Test commands: node scripts/test-platform-commands.js');
  
  return projects;
}

if (require.main === module) {
  main().catch(err => {
    console.error('‚ùå Setup failed:', err.message);
    process.exit(1);
  });
}

module.exports = { createTestProject };
```

**Make script executable:**

```bash
chmod +x scripts/create-test-project.js
```

**Update test-environments/.gitignore:**

```
# Test project directories (never commit)
copilot-test-project/
claude-test-project/
codex-test-project/

# Test results
install-results.json
test-results.json
regression-results.json
*.test-output.txt
```
  </action>
  
  <verify>
```bash
# Run script to create test projects
node scripts/create-test-project.js

# Verify 3 test projects created
ls -la test-environments/copilot-test-project/
ls -la test-environments/claude-test-project/
ls -la test-environments/codex-test-project/

# Check each has package.json
cat test-environments/copilot-test-project/package.json
```
  </verify>
  
  <done>
- [x] scripts/create-test-project.js creates minimal test projects per platform
- [x] Each test project has package.json, .gitignore, README.md
- [x] Test projects simulate real user installation environment (no repo clone)
- [x] test-environments/.gitignore prevents committing test artifacts
  </done>
</task>

<task name="create-npm-installation-test" type="auto">
  <files>
    scripts/test-npm-install.js
  </files>
  
  <action>
Create script to test npm package installation workflow (local package, not git clone).

**Create scripts/test-npm-install.js:**

```javascript
#!/usr/bin/env node
const { execSync } = require('child_process');
const fs = require('fs');
const path = require('path');

const platforms = [
  { name: 'copilot', installFlag: '--copilot', dir: '.github/copilot/skills' },
  { name: 'claude', installFlag: '--local', dir: '.claude/get-shit-done' },
  { name: 'codex', installFlag: '--codex', dir: '.codex/skills' }
];

async function testNpmInstall(platform) {
  console.log(`\n${'='.repeat(60)}`);
  console.log(`Testing ${platform.name} npm installation`);
  console.log('='.repeat(60));
  
  const projectDir = path.join(__dirname, '..', 'test-environments', `${platform.name}-test-project`);
  
  if (!fs.existsSync(projectDir)) {
    return {
      platform: platform.name,
      success: false,
      error: 'Test project not found. Run: node scripts/create-test-project.js'
    };
  }
  
  try {
    // Get path to current GSD package (parent directory of scripts/)
    const packagePath = path.resolve(__dirname, '..');
    
    console.log(`üì¶ Installing GSD package from: ${packagePath}`);
    console.log(`   Target project: ${projectDir}`);
    
    // Install GSD package into test project
    const installCmd = `npm install "${packagePath}"`;
    console.log(`   Command: ${installCmd}\n`);
    
    const installOutput = execSync(installCmd, {
      cwd: projectDir,
      encoding: 'utf8',
      stdio: 'pipe'
    });
    
    console.log(installOutput);
    
    // Run GSD installation script within the test project
    console.log(`\nüîß Running GSD install ${platform.installFlag}...`);
    
    const gsdInstallCmd = `node node_modules/get-shit-done/bin/install.js ${platform.installFlag}`;
    const gsdOutput = execSync(gsdInstallCmd, {
      cwd: projectDir,
      encoding: 'utf8',
      stdio: 'pipe'
    });
    
    console.log(gsdOutput);
    
    // Verify installation
    const result = verifyInstallation(platform, projectDir);
    
    if (result.success) {
      console.log(`‚úÖ ${platform.name}: ${result.skillsGenerated}/29 commands installed`);
    } else {
      console.log(`‚ùå ${platform.name}: Installation verification failed`);
      result.errors.forEach(err => console.log(`   - ${err}`));
    }
    
    return {
      platform: platform.name,
      success: result.success,
      skillsGenerated: result.skillsGenerated,
      errors: result.errors,
      projectDir
    };
    
  } catch (error) {
    console.log(`‚ùå ${platform.name}: Installation threw error`);
    console.log(`   ${error.message}`);
    
    return {
      platform: platform.name,
      success: false,
      error: error.message
    };
  }
}

function verifyInstallation(platform, projectDir) {
  const skillsDir = path.join(projectDir, platform.dir);
  
  if (!fs.existsSync(skillsDir)) {
    return {
      success: false,
      skillsGenerated: 0,
      errors: [`Skills directory not found: ${platform.dir}`]
    };
  }
  
  const skills = fs.readdirSync(skillsDir).filter(f => 
    f.startsWith('gsd-') && f.endsWith('.md')
  );
  
  const expectedCount = 29;
  const success = skills.length === expectedCount;
  const errors = [];
  
  if (skills.length < expectedCount) {
    errors.push(`Expected ${expectedCount} commands, found ${skills.length}`);
  }
  
  return {
    success,
    skillsGenerated: skills.length,
    installedCommands: skills.map(f => f.replace('.md', '')),
    errors
  };
}

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function main() {
  console.log('üöÄ Testing npm package installation workflow\n');
  console.log('Testing order: Copilot ‚Üí Claude ‚Üí Codex\n');
  
  const results = [];
  
  for (const platform of platforms) {
    const result = await testNpmInstall(platform);
    results.push(result);
    
    if (platform !== platforms[platforms.length - 1]) {
      await sleep(2000);
    }
  }
  
  // Summary
  console.log('\n' + '='.repeat(60));
  console.log('NPM Installation Test Summary');
  console.log('='.repeat(60));
  
  let totalSuccess = 0;
  let totalInstalled = 0;
  
  for (const result of results) {
    const status = result.success ? '‚úÖ' : '‚ùå';
    const skills = result.skillsGenerated || 0;
    console.log(`${status} ${result.platform}: ${skills}/29 commands`);
    
    if (result.success) {
      totalSuccess++;
      totalInstalled += skills;
    }
  }
  
  console.log('\n' + '='.repeat(60));
  console.log(`Overall: ${totalSuccess}/3 platforms successful`);
  console.log(`Total commands installed: ${totalInstalled}/87`);
  console.log('='.repeat(60));
  
  // Write results
  const resultsPath = path.join(__dirname, '..', 'test-environments', 'install-results.json');
  fs.writeFileSync(resultsPath, JSON.stringify(results, null, 2));
  console.log(`\nüìÑ Results: test-environments/install-results.json`);
  
  if (totalSuccess < 3) {
    console.error('\n‚ùå Installation testing failed');
    process.exit(1);
  }
  
  console.log('\n‚úÖ All platforms successful!');
}

if (require.main === module) {
  main().catch(err => {
    console.error('‚ùå Test failed:', err.message);
    process.exit(1);
  });
}

module.exports = { testNpmInstall, verifyInstallation };
```
  </action>
  
  <verify>
```bash
# Run npm installation test
node scripts/test-npm-install.js

# Verify results
cat test-environments/install-results.json

# Check commands in test projects
ls test-environments/copilot-test-project/.github/copilot/skills/gsd-*.md | wc -l
ls test-environments/claude-test-project/.claude/get-shit-done/gsd-*.md | wc -l
```
  </verify>
  
  <done>
- [x] scripts/test-npm-install.js tests local package installation
- [x] Installs GSD into test projects (not git clone)
- [x] Verifies 29 commands per platform
- [x] Captures results in install-results.json
- [x] Tests real user installation workflow
  </done>
</task>

<task name="test-command-execution-regression" type="checkpoint:human-verify" gate="blocking">
  <what-built>Command testing scripts + regression testing for installed commands</what-built>
  
  <how-to-verify>
**CHECKPOINT: Manual command testing required**

After npm installation completes, test commands manually to verify behavior:

**1. Navigate to test projects:**
```bash
cd test-environments/copilot-test-project
# Or claude-test-project, codex-test-project
```

**2. Test command invocation (sample commands):**
```bash
# Test simple commands
@gsd-progress
@gsd-context
@gsd-ask "What is this project?"

# Test complex orchestrators
@gsd-new-project
@gsd-plan-phase 1
@gsd-verify-phase 1

# Test tool mapping
@gsd-map-codebase
@gsd-debug
```

**3. Verify:**
- [ ] Commands are discoverable via platform-specific invocation (@command for Claude/Copilot)
- [ ] Help text displays correctly
- [ ] Platform-specific content renders (not showing conditionals)
- [ ] Tool mapping works (Claude tools ‚Üí platform equivalents)
- [ ] Legacy fallback works (commands without specs still function)

**4. Record results:**
Create `test-environments/test-results.json` with structure:
```json
{
  "copilot": {
    "tested": 15,
    "passed": 15,
    "failed": 0,
    "failures": []
  },
  "claude": { ... },
  "codex": { ... }
}
```

**5. Test regression (automated):**
```bash
# From project root
node scripts/test-regression.js
```

This runs 15-20 commands and compares output to legacy versions.
  </how-to-verify>
  
  <resume-signal>
Type "approved" when:
- All platforms tested (Copilot, Claude, Codex)
- test-results.json created with pass/fail data
- Regression test completed
- Any failures documented in test-results.json

Or describe issues found for investigation.
  </resume-signal>
</task>

## Verification

```bash
# 1. Create test projects
node scripts/create-test-project.js

# 2. Run npm installation test
node scripts/test-npm-install.js

# 3. Verify installation success
cat test-environments/install-results.json

# 4. Manual testing (checkpoint)
# Navigate to test projects and test commands

# 5. Run regression tests
node scripts/test-regression.js
```

## Success Criteria

- [x] Test projects created (copilot-test-project, claude-test-project, codex-test-project)
- [x] npm package installation tested on all 3 platforms
- [x] All 29 commands install successfully per platform (87 total)
- [x] Commands discoverable via platform-specific invocation
- [x] Installation results captured in install-results.json
- [x] Manual testing completed with results in test-results.json
- [x] Regression testing completed (15-20 commands)
- [x] Tool mapping verified
- [x] Platform-specific content renders correctly
- [x] Legacy fallback behavior verified

## Output

**Files created:**
- scripts/create-test-project.js (~80 lines)
- scripts/test-npm-install.js (~140 lines)
- test-environments/install-results.json (generated)
- test-environments/test-results.json (manual, from checkpoint)

**Test projects created:**
- test-environments/copilot-test-project/
- test-environments/claude-test-project/
- test-environments/codex-test-project/

**Next:** Plan 3 analyzes test results and creates validation report
