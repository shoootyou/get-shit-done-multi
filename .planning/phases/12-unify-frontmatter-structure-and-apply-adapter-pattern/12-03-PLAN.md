---
phase: 12-unify-frontmatter-structure-and-apply-adapter-pattern
plan: 03
type: execute
wave: 3
depends_on: [12-02]
files_modified:
  - docs/adding-platforms.md
  - tests/unit/frontmatter-serializer.test.js
  - tests/unit/claude-serializer.test.js
  - tests/unit/copilot-serializer.test.js
  - tests/unit/codex-serializer.test.js
autonomous: true

must_haves:
  truths:
    - "Contributors know exactly what files to create for a new platform"
    - "All tests pass after migration (no regressions)"
    - "Test files reference platform-specific serializers (not shared ones)"
    - "Documentation reflects final architecture"
  artifacts:
    - path: "docs/adding-platforms.md"
      provides: "Step-by-step platform addition guide"
      contains: "checklist"
      min_lines: 100
    - path: "tests/unit/claude-serializer.test.js"
      provides: "Claude serializer test suite"
      min_lines: 50
    - path: "tests/unit/copilot-serializer.test.js"
      provides: "Copilot serializer test suite"
      min_lines: 50
    - path: "tests/unit/codex-serializer.test.js"
      provides: "Codex serializer test suite"
      min_lines: 50
  key_links:
    - from: "docs/adding-platforms.md"
      to: "bin/lib/platforms/"
      via: "adapter creation instructions"
      pattern: "claude-adapter.js.*copilot-adapter.js.*codex-adapter.js"
    - from: "docs/adding-platforms.md"
      to: "bin/lib/frontmatter/"
      via: "validator creation instructions"
      pattern: "claude-validator.js.*base-validator.js"
    - from: "docs/adding-platforms.md"
      to: "bin/lib/serialization/"
      via: "serializer/cleaner creation instructions"
      pattern: "claude-serializer.js.*claude-cleaner.js"
---

<objective>
Create contributor documentation for adding new platforms and verify migration with full test suite

**Purpose:** Enable future platform additions (e.g., Cursor, Windsurf) and ensure migration quality

**Output:** Complete adding-platforms.md guide, updated test files, all tests passing
</objective>

<execution_context>
@.github/get-shit-done/workflows/execute-plan.md
@.github/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-unify-frontmatter-structure-and-apply-adapter-pattern/12-01-CONTEXT.md
@.planning/phases/12-unify-frontmatter-structure-and-apply-adapter-pattern/12-RESEARCH.md

# Final architecture after Wave 1-3
@bin/lib/platforms/
@bin/lib/frontmatter/
@bin/lib/serialization/
@bin/lib/templates/

# Existing docs for reference
@docs/architecture.md
@docs/platform-differences.md
</context>

<tasks>

<task type="auto">
  <name>Task 5: Create docs/adding-platforms.md with complete checklist</name>
  <files>
    docs/adding-platforms.md
  </files>
  <action>
Create comprehensive contributor guide at docs/adding-platforms.md with these sections:

**1. Overview**
- What this guide is for (adding support for new AI CLI platforms)
- Prerequisites (understanding of adapter pattern, Node.js ESM)
- Time estimate (~4-6 hours for a new platform)

**2. Architecture Context**
- Per-platform pattern philosophy (isolation over DRY)
- Module organization:
  - `bin/lib/platforms/` - Platform adapters
  - `bin/lib/frontmatter/` - Validators (per-platform)
  - `bin/lib/serialization/` - Serializers and cleaners (per-platform)
  - `bin/lib/templates/` - General template rendering
- Why code duplication is acceptable and preferred

**3. Step-by-Step Checklist**

Create a comprehensive checklist covering:

□ **Step 1: Research platform specifications**
  - Document tool names and mappings
  - Document frontmatter format (YAML style, required fields)
  - Document file extensions (.md, .agent.md)
  - Document directory structure
  - Document command prefix (/, $, etc.)

□ **Step 2: Create platform adapter**
  - File: `bin/lib/platforms/{platform}-adapter.js`
  - Extend BaseAdapter class
  - Implement: transformFrontmatter(), transformTools(), transformPath(), getFileExtension(), getTargetDir()
  - Import platform-specific validator, serializer, cleaner
  - Add to platforms/index.js exports

□ **Step 3: Create frontmatter validator**
  - File: `bin/lib/frontmatter/{platform}-validator.js`
  - Extend BaseValidator class
  - Implement: validateOptionalFields(), validateUnknownFields()
  - Use field-validators.js for common validations
  - Full independence (no imports from other platform validators)

□ **Step 4: Create frontmatter serializer**
  - File: `bin/lib/serialization/{platform}-serializer.js`
  - Export: serializeFrontmatter(data)
  - Implement full YAML serialization logic
  - Platform-specific array formatting (block vs flow style)
  - Platform-specific quoting rules
  - Full independence (duplicate code from other serializers)

□ **Step 5: Create frontmatter cleaner**
  - File: `bin/lib/serialization/{platform}-cleaner.js`
  - Import: serializeFrontmatter from ./{platform}-serializer.js
  - Export: cleanFrontmatter(content)
  - Parse, clean, rebuild frontmatter using platform serializer
  - Full independence (no shared cleaning logic)

□ **Step 6: Add platform detection**
  - Update `bin/lib/platforms/detect-platforms.js`
  - Add binary detection (e.g., check for `cursor` command)
  - Add installation path detection (.cursor/get-shit-done/)

□ **Step 7: Update CLI prompts**
  - Add platform to `bin/lib/cli/prompts.js` platform selection
  - Add help text and descriptions

□ **Step 8: Write tests**
  - Unit tests: {platform}-validator.test.js
  - Unit tests: {platform}-serializer.test.js
  - Unit tests: {platform}-cleaner.test.js
  - Integration tests: Add platform to install-platform.test.js
  - Test coverage: 80%+ for all new files

□ **Step 9: Update documentation**
  - Add platform to docs/platform-differences.md
  - Update README.md with new platform support
  - Update REQUIREMENTS.md with platform requirements

□ **Step 10: Manual testing**
  - Run installer with `--{platform}` flag
  - Verify skills install correctly
  - Verify agents install correctly
  - Test with actual platform CLI
  - Verify frontmatter validation works

**4. Code Examples**

Provide annotated examples:
- Complete adapter implementation (reference claude-adapter.js)
- Complete validator implementation (reference claude-validator.js)
- Complete serializer implementation (reference claude-serializer.js)
- Complete cleaner implementation (reference claude-cleaner.js)

**5. Testing Strategy**

Explain testing approach:
- Unit tests for each component
- Integration tests for end-to-end flow
- Manual testing checklist
- How to run test suite: `npm test`

**6. Common Pitfalls**

Document common mistakes:
- ❌ Sharing code between platform validators/serializers (breaks isolation)
- ❌ Using conditional logic instead of separate files
- ❌ Forgetting to update CLI prompts
- ❌ Missing tests for platform-specific logic
- ✅ Duplicate code is acceptable (isolation matters more)
- ✅ Each platform is fully independent
- ✅ Update all three components: adapter + validator + serializer/cleaner

**7. References**

Link to:
- Phase 11 summary (validator pattern established)
- Phase 12 summary (serializer pattern established)
- Architecture docs
- Platform difference docs
- Official platform documentation sites

**Style:** Use existing project documentation style from docs/architecture.md and docs/platform-differences.md as reference. Practical, checklist-driven, code-first approach.
  </action>
  <verify>
```bash
# 1. File exists
ls docs/adding-platforms.md

# 2. Has all major sections
grep -q "Step-by-Step Checklist" docs/adding-platforms.md
grep -q "Code Examples" docs/adding-platforms.md
grep -q "Testing Strategy" docs/adding-platforms.md
grep -q "Common Pitfalls" docs/adding-platforms.md

# 3. References all three components
grep -q "validator" docs/adding-platforms.md
grep -q "serializer" docs/adding-platforms.md
grep -q "cleaner" docs/adding-platforms.md

# 4. Has concrete examples
grep -q "claude-adapter.js" docs/adding-platforms.md
grep -q "claude-validator.js" docs/adding-platforms.md
grep -q "claude-serializer.js" docs/adding-platforms.md

# 5. Reasonable length (comprehensive)
wc -l docs/adding-platforms.md | awk '{if ($1 < 100) exit 1}'
```
  </verify>
  <done>
- docs/adding-platforms.md created with comprehensive checklist
- All 10 steps documented with explanations
- Code examples referencing existing implementations
- Testing strategy explained
- Common pitfalls documented
- Links to relevant phase summaries and docs
- Ready for contributors to add new platforms (e.g., Cursor, Windsurf)
  </done>
</task>

<task type="auto">
  <name>Task 6: Update test files and run full test suite</name>
  <files>
    tests/unit/frontmatter-serializer.test.js
    tests/unit/claude-serializer.test.js
    tests/unit/copilot-serializer.test.js
    tests/unit/codex-serializer.test.js
  </files>
  <action>
**Update existing test file:**

Rename and update the shared serializer test:
```bash
# Check if test exists
ls tests/unit/frontmatter-serializer.test.js
```

If the test file imports the old shared serializer, split it into per-platform tests:

**tests/unit/claude-serializer.test.js:**
```javascript
import { serializeFrontmatter } from '../../bin/lib/serialization/claude-serializer.js';

describe('Claude Serializer', () => {
  test('serializes arrays as block style', () => {
    const data = { skills: ['gsd-help', 'gsd-verify'] };
    const result = serializeFrontmatter(data);
    // Verify block style formatting
    expect(result).toContain('skills:\n  - gsd-help');
  });
  
  // More tests for Claude-specific formatting...
});
```

**tests/unit/copilot-serializer.test.js:**
```javascript
import { serializeFrontmatter } from '../../bin/lib/serialization/copilot-serializer.js';

describe('Copilot Serializer', () => {
  test('serializes arrays as flow style', () => {
    const data = { skills: ['gsd-help', 'gsd-verify'] };
    const result = serializeFrontmatter(data);
    // Verify flow style formatting
    expect(result).toContain("skills: ['gsd-help', 'gsd-verify']");
  });
  
  // More tests for Copilot-specific formatting...
});
```

**tests/unit/codex-serializer.test.js:**
```javascript
import { serializeFrontmatter } from '../../bin/lib/serialization/codex-serializer.js';

describe('Codex Serializer', () => {
  test('serializes arrays as flow style with special quoting', () => {
    const data = { skills: ['gsd-help', 'gsd-verify'] };
    const result = serializeFrontmatter(data);
    // Verify Codex-specific formatting
  });
  
  // More tests for Codex-specific formatting...
});
```

If the existing test is minimal or doesn't exist, create basic tests covering:
- Array serialization (block vs flow style)
- String escaping and quoting
- Nested objects
- Special characters

**Run full test suite:**
```bash
npm test 2>&1 | tee test-output.log
```

Analyze test results:
- All existing tests should pass (no regressions)
- New per-platform tests should pass
- Check coverage report if available

If any tests fail:
1. Read error messages carefully
2. Check if tests reference old shared serializer paths
3. Update test imports to use platform-specific serializers
4. Re-run until all tests pass

**Test validation criteria:**
- Zero test failures
- All serializer tests use platform-specific imports
- No references to old frontmatter-serializer.js in test files
  </action>
  <verify>
```bash
# 1. Per-platform test files exist
ls tests/unit/claude-serializer.test.js
ls tests/unit/copilot-serializer.test.js
ls tests/unit/codex-serializer.test.js

# 2. Tests import platform-specific serializers
grep -q "from.*claude-serializer" tests/unit/claude-serializer.test.js
grep -q "from.*copilot-serializer" tests/unit/copilot-serializer.test.js
grep -q "from.*codex-serializer" tests/unit/codex-serializer.test.js

# 3. Run full test suite
npm test 2>&1 | tee test-results.txt

# 4. Check for failures
! grep -i "FAIL" test-results.txt

# 5. Verify no old serializer references in tests
! grep -r "frontmatter-serializer.js" tests/ --include="*.js" | grep -v "claude-serializer\|copilot-serializer\|codex-serializer"
```
  </verify>
  <done>
- Test files updated to use platform-specific serializers
- Per-platform test files created (claude, copilot, codex)
- Full test suite executed
- All tests passing (zero failures)
- No references to old shared serializer in tests
- Migration verified: architecture changes introduced no regressions
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Documentation:**
   - docs/adding-platforms.md exists with comprehensive checklist
   - All steps documented (research → adapter → validator → serializer → cleaner → tests → docs)
   - Code examples reference existing implementations
   - Common pitfalls documented

2. **Testing:**
   - All existing tests still pass
   - New per-platform serializer tests created
   - Test imports reference platform-specific files
   - Zero test failures

3. **Architecture completeness:**
   - Per-platform pattern applied to validators (Phase 11)
   - Per-platform pattern applied to serializers/cleaners (Phase 12)
   - Module structure finalized (frontmatter/, serialization/, templates/)
   - Contributors can add new platforms following checklist

4. **Quality:**
   - No regressions introduced
   - All syntax checks pass
   - All test suites pass
   - Documentation is comprehensive and actionable
</verification>

<success_criteria>
Wave 4 complete (Phase 12 done) when:
- [ ] docs/adding-platforms.md created with 10-step checklist
- [ ] Code examples for all four components (adapter, validator, serializer, cleaner)
- [ ] Testing strategy documented
- [ ] Common pitfalls documented
- [ ] Per-platform test files created
- [ ] Full test suite passes (zero failures)
- [ ] No references to old shared files in tests
- [ ] Contributors can add new platforms independently
- [ ] Architecture is consistent across validation and serialization
</success_criteria>

<output>
After completion, create `.planning/phases/12-unify-frontmatter-structure-and-apply-adapter-pattern/12-03-SUMMARY.md`

Include:
- Documentation sections covered
- Test results (pass/fail counts)
- Files updated in test suite
- Migration verification results
- Phase 12 complete confirmation
- Architecture pattern now consistent across all frontmatter components
</output>
