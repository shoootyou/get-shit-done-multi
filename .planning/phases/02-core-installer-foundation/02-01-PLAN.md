---
phase: 02-core-installer-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - bin/install.js
  - bin/lib/errors/install-error.js
autonomous: true
must_haves:
  - bin: npm bin entry point exists at bin/install.js with shebang
  - executable: bin/install.js has execute permissions
  - cli-progress: cli-progress dependency added to package.json
  - error-types: Custom error classes with exit codes defined
  - structure: bin/lib/ directory structure created
---

# Phase 02 Plan 01: Foundation & Project Structure

## Objective

Establish the foundational structure for the installer: add required dependency (cli-progress), create bin entry point with proper shebang and permissions, set up lib directory structure, and define custom error types with exit codes. This creates the skeleton that subsequent modules will populate.

## Context

**From Phase 1:** Templates exist in `/templates/` with frontmatter corrections and template variables. Migration complete.

**What we're building:** Core installer for Claude Code that copies templates to user's `.claude/` directory with variable replacement.

**Phase 2 scope:** Claude only, basic CLI with flags (`--claude`, `--global`, `--local`, `--verbose`), no rollback yet, no interactive prompts yet.

**Dependencies available:** fs-extra, commander, chalk already installed. Need cli-progress for progress bars.

**Architecture decision:** ESM modules throughout, separation of concerns (io, rendering, paths, cli, errors).

## Tasks

<task name="add-cli-progress-dependency" type="auto">
  <files>package.json</files>
  <action>
    Add cli-progress as production dependency:
    
    ```bash
    npm install cli-progress --save
    ```
    
    Version: ^3.12.0 (latest stable, 5.5M+ weekly downloads)
    
    Verify installation:
    ```bash
    npm list cli-progress
    ```
    
    Rationale: Progress bars for multi-phase installation (skills, agents, shared). Better than spinners (ora) for showing % complete.
  </action>
  <verify>
    ```bash
    grep -q '"cli-progress"' package.json && echo "✓ Dependency added"
    npm list cli-progress | grep -q cli-progress && echo "✓ Installed"
    ```
  </verify>
  <done>cli-progress@^3.12.0 in package.json dependencies, node_modules populated</done>
</task>

<task name="create-bin-structure" type="auto">
  <files>
    bin/install.js
    bin/lib/.gitkeep
  </files>
  <action>
    Create bin directory structure and entry point:
    
    1. Create directories:
    ```bash
    mkdir -p bin/lib/{io,rendering,paths,cli,errors}
    ```
    
    2. Create entry point `bin/install.js`:
    ```javascript
    #!/usr/bin/env node
    
    /**
     * get-shit-done-multi installer
     * Entry point for npx get-shit-done-multi
     */
    
    import { fileURLToPath } from 'url';
    import { dirname } from 'path';
    
    // Get script directory in ESM (replaces __dirname)
    const __filename = fileURLToPath(import.meta.url);
    const __dirname = dirname(__filename);
    
    async function main() {
      console.log('get-shit-done-multi v2.0.0');
      console.log('Installation entry point created');
      
      // CLI orchestration will be added in Plan 03
    }
    
    // Execute with proper error handling
    main().catch(error => {
      console.error('Error:', error.message);
      process.exit(1);
    });
    ```
    
    3. Make executable:
    ```bash
    chmod +x bin/install.js
    ```
    
    4. Test NPX simulation:
    ```bash
    node bin/install.js
    ```
    
    Expected output: "get-shit-done-multi v2.0.0" + "Installation entry point created"
  </action>
  <verify>
    ```bash
    # Check shebang
    head -1 bin/install.js | grep -q '#!/usr/bin/env node' && echo "✓ Shebang correct"
    
    # Check executable permissions
    test -x bin/install.js && echo "✓ Executable"
    
    # Check directory structure
    test -d bin/lib/io && test -d bin/lib/rendering && test -d bin/lib/paths && test -d bin/lib/cli && test -d bin/lib/errors && echo "✓ Directory structure created"
    
    # Test execution
    node bin/install.js 2>&1 | grep -q "v2.0.0" && echo "✓ Entry point runs"
    ```
  </verify>
  <done>bin/install.js exists with shebang, executable permissions, ESM structure, and bin/lib/ subdirectories created</done>
</task>

<task name="define-error-types" type="auto">
  <files>bin/lib/errors/install-error.js</files>
  <action>
    Create custom error class with exit codes:
    
    ```javascript
    // bin/lib/errors/install-error.js
    
    /**
     * Custom error class for installation failures
     * Includes exit codes for different failure modes
     */
    
    export class InstallError extends Error {
      constructor(message, code = 1, details = null) {
        super(message);
        this.name = 'InstallError';
        this.code = code;
        this.details = details;
      }
    }
    
    /**
     * Exit codes
     */
    export const EXIT_CODES = {
      SUCCESS: 0,
      GENERAL_ERROR: 1,
      INVALID_ARGS: 2,
      MISSING_TEMPLATES: 3,
      PERMISSION_DENIED: 4,
      INSUFFICIENT_SPACE: 5
    };
    
    /**
     * Factory functions for common errors
     */
    export function invalidArgs(message, details = null) {
      return new InstallError(message, EXIT_CODES.INVALID_ARGS, details);
    }
    
    export function missingTemplates(message, details = null) {
      return new InstallError(message, EXIT_CODES.MISSING_TEMPLATES, details);
    }
    
    export function permissionDenied(message, details = null) {
      return new InstallError(message, EXIT_CODES.PERMISSION_DENIED, details);
    }
    
    export function insufficientSpace(message, details = null) {
      return new InstallError(message, EXIT_CODES.INSUFFICIENT_SPACE, details);
    }
    ```
    
    Test error types:
    ```javascript
    // Quick test in Node REPL
    import { InstallError, EXIT_CODES, invalidArgs } from './bin/lib/errors/install-error.js';
    
    const err = invalidArgs('Missing --claude flag');
    console.log(err.message, err.code); // Should show message and code 2
    ```
  </action>
  <verify>
    ```bash
    # Check file exists and has exports
    test -f bin/lib/errors/install-error.js && echo "✓ Error module exists"
    grep -q "export class InstallError" bin/lib/errors/install-error.js && echo "✓ InstallError class defined"
    grep -q "export const EXIT_CODES" bin/lib/errors/install-error.js && echo "✓ Exit codes defined"
    grep -q "export function invalidArgs" bin/lib/errors/install-error.js && echo "✓ Factory functions defined"
    
    # Test import (will verify ESM syntax is valid)
    node -e "import('./bin/lib/errors/install-error.js').then(m => console.log('✓ Module loads'))" 2>&1 | grep -q "Module loads"
    ```
  </verify>
  <done>bin/lib/errors/install-error.js created with InstallError class, EXIT_CODES constants, and factory functions for common errors</done>
</task>

## Verification

After completing all tasks:

```bash
# 1. Dependency check
npm list cli-progress | grep cli-progress

# 2. Structure check
ls -R bin/lib/

# 3. Entry point test
node bin/install.js

# 4. Error module test
node -e "import('./bin/lib/errors/install-error.js').then(m => console.log(m.EXIT_CODES))"

# 5. Permissions check
test -x bin/install.js && echo "Executable: OK"
```

Expected outcomes:
- cli-progress@3.12.0 listed
- bin/lib/ has io, rendering, paths, cli, errors subdirectories
- Entry point prints version message
- Error module loads and shows exit codes
- bin/install.js has execute permissions

## Success Criteria

- [ ] cli-progress dependency added to package.json (version ^3.12.0)
- [ ] bin/install.js created with shebang and executable permissions
- [ ] bin/install.js uses ESM imports (import.meta.url for __dirname)
- [ ] bin/lib/ directory structure exists (io, rendering, paths, cli, errors)
- [ ] Custom error class (InstallError) defined with exit codes
- [ ] Factory functions for common errors (invalidArgs, missingTemplates, etc.)
- [ ] Entry point runs without errors (node bin/install.js works)

## Output

**Files Created:**
- bin/install.js (entry point)
- bin/lib/errors/install-error.js (error types)
- bin/lib/{io,rendering,paths,cli}/ (directories)

**Dependencies Added:**
- cli-progress@^3.12.0

**Next:** Plan 02 will create the core modules (file operations, path resolver, template renderer, CLI utilities) that populate the lib/ structure.
