---
phase: 08.1-documentation-cleanup-and-fixes
plan: 03
type: execute
wave: 2
depends_on: [8.1-01, 8.1-02]
files_modified:
  - docs/ (broken links fixed)
  - package.json (link checker dependencies)
  - scripts/documentation/link-checker.js
autonomous: true
must_haves:
  truths:
    - All internal markdown links are valid (no 404s after file renaming)
    - External links validated (or documented as known issues)
  artifacts:
    - scripts/documentation/link-checker.js (automated link validation)
  wiring:
    - Link checker validates all .md files in docs/, root, specs/
  key_links:
    - Link checking MUST run after file renaming (Plan 01 dependency)
    - Link checking MUST run after content updates (Plan 02 dependency)
---

# Plan 8.1-03: Link Validation

## Objective

Validate all documentation links after file renaming and fix broken internal references.

## Context

**Why this plan exists:**
- Plan 01 renamed files (docs/*.md to lowercase)
- Plan 02 updated content and removed command-system.md
- Links may be broken after these changes

**What we're building on:**
- Plan 01: File renaming, script organization
- Plan 02: Content updates, deletions
- RESEARCH.md: markdown-link-check patterns

**What comes after:**
- Plan 8.1-04: Script audit and asset updates
- Phase 8.1 complete, ready for release

## Tasks

<task name="Install link checking dependencies" type="auto">
  <files>package.json, package-lock.json</files>
  <action>
Install link validation dependencies:

```bash
npm install --save-dev markdown-link-check@3.14.2 fast-glob@3.3.3
```

Verify installation:
```bash
npm list markdown-link-check fast-glob
```
  </action>
  <verify>Dependencies appear in devDependencies</verify>
  <done>Link checking libraries installed</done>
</task>

<task name="Create link checker script" type="auto">
  <files>scripts/documentation/link-checker.js</files>
  <action>
Create automated link checker per RESEARCH.md pattern:

```javascript
// scripts/documentation/link-checker.js
const markdownLinkCheck = require('markdown-link-check');
const fs = require('fs-extra');
const path = require('path');
const chalk = require('chalk');
const fg = require('fast-glob');

async function checkLinksInFile(filePath) {
  const markdown = await fs.readFile(filePath, 'utf8');
  
  const options = {
    baseUrl: 'file://' + path.dirname(path.resolve(filePath)),
    showProgressBar: false,
    timeout: 10000,
    retryOn429: true,
    retryCount: 3,
    aliveStatusCodes: [200, 206, 999], // 999 = LinkedIn blocks scrapers
    ignorePatterns: [
      { pattern: '^https://github.com/.*/blob/main' }, // May not exist on branches
      { pattern: '^mailto:' } // Skip email validation
    ]
  };
  
  return new Promise((resolve) => {
    markdownLinkCheck(markdown, options, (err, results) => {
      if (err) {
        console.error(chalk.red(`âœ— Error checking ${filePath}: ${err.message}`));
        resolve({ file: filePath, errors: [err.message], broken: [] });
        return;
      }
      
      const broken = results.filter(r => r.status === 'dead');
      const warnings = results.filter(r => r.status === 'error'); // DNS errors, timeouts
      
      if (broken.length > 0) {
        console.log(chalk.red(`\nâœ— ${filePath} - ${broken.length} broken links:`));
        broken.forEach(link => {
          console.log(chalk.red(`  ${link.link}`));
          console.log(chalk.dim(`    ${link.statusCode} ${link.err || ''}`));
        });
      } else if (warnings.length > 0) {
        console.log(chalk.yellow(`\nâš  ${filePath} - ${warnings.length} warnings:`));
        warnings.forEach(link => {
          console.log(chalk.yellow(`  ${link.link}`));
          console.log(chalk.dim(`    ${link.err || 'Timeout/DNS error'}`));
        });
      } else {
        console.log(chalk.green(`âœ“ ${filePath} - all links valid`));
      }
      
      resolve({
        file: filePath,
        total: results.length,
        broken: broken,
        warnings: warnings,
        passed: results.length - broken.length - warnings.length
      });
    });
  });
}

async function checkAllDocs() {
  console.log(chalk.cyan('\nðŸ” Checking documentation links...\n'));
  
  // Find all markdown files
  const files = await fg([
    'docs/**/*.md',
    'README.md',
    'CHANGELOG.md',
    'specs/skills/**/*.md',
    '!node_modules/**',
    '!.git/**',
    '!**/node_modules/**'
  ]);
  
  console.log(`Found ${files.length} markdown files to check\n`);
  
  const results = [];
  for (const file of files) {
    const result = await checkLinksInFile(file);
    results.push(result);
  }
  
  // Summary
  const totalBroken = results.reduce((sum, r) => sum + r.broken.length, 0);
  const totalWarnings = results.reduce((sum, r) => sum + r.warnings.length, 0);
  const filesWithIssues = results.filter(r => r.broken.length > 0 || r.warnings.length > 0);
  
  console.log(chalk.cyan('\nðŸ“Š Summary:\n'));
  console.log(`  Files checked: ${results.length}`);
  console.log(`  Files with broken links: ${filesWithIssues.filter(f => f.broken.length > 0).length}`);
  console.log(`  Total broken links: ${totalBroken}`);
  console.log(`  Total warnings: ${totalWarnings}`);
  
  if (totalBroken > 0) {
    console.log(chalk.red('\nâœ— Link checking failed\n'));
    process.exit(1);
  } else if (totalWarnings > 0) {
    console.log(chalk.yellow('\nâš  Link checking passed with warnings\n'));
    process.exit(0);
  } else {
    console.log(chalk.green('\nâœ… All links valid\n'));
    process.exit(0);
  }
}

// Run if called directly
if (require.main === module) {
  checkAllDocs().catch(err => {
    console.error(chalk.red(`Fatal error: ${err.message}`));
    process.exit(1);
  });
}

module.exports = { checkLinksInFile, checkAllDocs };
```

Make executable:
```bash
chmod +x scripts/documentation/link-checker.js
```

Add npm script to package.json:
```json
{
  "scripts": {
    "check-links": "node scripts/documentation/link-checker.js"
  }
}
```
  </action>
  <verify>
Run link checker:
```bash
npm run check-links
```

Should report results for all .md files.
  </verify>
  <done>Link checker created and validates all markdown files</done>
</task>

<task name="Fix broken links" type="auto">
  <files>docs/*.md, README.md, CHANGELOG.md, specs/skills/**/*.md</files>
  <action>
Fix broken internal links identified by link checker:

**Common patterns after Plan 01 file renaming:**

1. **Uppercase â†’ lowercase docs:**
```bash
# Find references to old uppercase names
grep -r "TROUBLESHOOTING.md\|MIGRATION-GUIDE.md\|COMMAND-COMPARISON.md" \
  docs/ README.md CHANGELOG.md specs/ \
  --include="*.md"

# Fix each occurrence (Claude will use edit tool)
# TROUBLESHOOTING.md â†’ troubleshooting.md
# MIGRATION-GUIDE.md â†’ migration-guide.md
# COMMAND-COMPARISON.md â†’ command-comparison.md
```

2. **command-system.md removal:**

Already handled in Plan 02 (deleted file and references).

3. **Relative path adjustments:**

If files were moved in Plan 01 script organization, update paths:
```bash
# Find references to moved scripts
grep -r "test-generate.js\|cleanup-legacy" docs/ README.md --include="*.md"

# Update paths if they moved to subfolders
```

4. **External link issues:**

For external links that fail (429, timeouts):
- Verify link is correct manually
- If valid but rate-limited, add to ignorePatterns in link-checker.js
- If broken, remove or replace with archived version

Run link checker after each batch of fixes:
```bash
npm run check-links
```

Iterate until all internal links pass.
  </action>
  <verify>
Final link check:
```bash
npm run check-links
```

Should report 0 broken internal links. External warnings acceptable if documented.
  </verify>
  <done>All broken links fixed, documentation cross-references valid</done>
</task>

<task name="Commit link validation" type="auto">
  <files>.planning/phases/08.1-*/8.1-03-PLAN.md</files>
  <action>
Commit all changes from this plan:

```bash
# Source git identity helpers
if ! type commit_as_user >/dev/null 2>&1; then
    source /Users/rodolfo/croonix-github/get-shit-done/.github/get-shit-done/workflows/git-identity-helpers.sh
fi

# Stage all changes
git add \
  package.json \
  package-lock.json \
  scripts/documentation/link-checker.js \
  docs/ \
  README.md \
  CHANGELOG.md \
  specs/

# Commit with user identity preserved
commit_as_user "feat(8.1): link validation

Phase 8.1 Plan 03:
- Link checker: Automated validation of all .md files
- Fixed broken internal links after file renaming
- Dependencies: markdown-link-check@3.14.2, fast-glob@3.3.3"
```
  </action>
  <verify>
Check commit exists:
```bash
git log -1 --oneline
```
  </verify>
  <done>Link validation committed</done>
</task>

## Verification Criteria

**Link Checking:**
- [ ] Link checker script validates all .md files
- [ ] Internal links pass validation (0 broken)
- [ ] External warnings documented if any
- [ ] npm script `check-links` runs successfully

## Success Criteria

**Observable behaviors (must_haves realized):**
1. All internal markdown links are valid âœ“
2. External links validated or documented âœ“

## Output Artifacts

**Created:**
- `scripts/documentation/link-checker.js` - Automated link validation

**Modified:**
- `docs/*.md` - Fixed broken links
- `README.md` - Fixed broken links
- `CHANGELOG.md` - Fixed broken links
- `specs/**/*.md` - Fixed broken links
- `package.json` - Added check-links script, dev dependencies
