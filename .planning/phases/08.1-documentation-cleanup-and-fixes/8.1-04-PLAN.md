---
phase: 08.1-documentation-cleanup-and-fixes
plan: 04
type: execute
wave: 2
depends_on: [8.1-01, 8.1-02]
files_modified:
  - scripts/ (non-essential removed)
  - assets/svg/*.svg
  - package.json (scripts removed if non-essential)
  - .planning/phases/08.1-*/DEPRECATED.md
autonomous: false
must_haves:
  truths:
    - Non-essential scripts removed with user confirmation (one-by-one)
    - DEPRECATED.md documents removed files with purpose and removal date
    - SVG assets show current install command and version
    - Package.json scripts reference only existing files
  artifacts:
    - scripts/audit/script-analyzer.js (usage analysis)
    - scripts/audit/removal-confirmer.js (interactive removal)
    - .planning/phases/08.1-*/DEPRECATED.md (removal documentation)
    - assets/svg/*.svg (updated install messages)
  wiring:
    - Script analyzer detects usage in package.json, source files, docs
    - Removal confirmer presents scripts one-by-one with context
    - DEPRECATED.md tracks removed files for historical reference
  key_links:
    - Script removal MUST preserve essential files (install.js, gsd-cli.js, core libs)
---

# Plan 8.1-04: Script Audit & Asset Updates

## Objective

Audit and remove non-essential scripts with user confirmation, update SVG assets, and create removal documentation.

## Context

**Why this plan exists:**
- Project has accumulated scripts that may no longer be needed
- SVG assets show outdated installation commands
- Need historical record of removed files

**What we're building on:**
- Plan 01: File renaming, script organization
- Plan 02: Content updates, deletions
- Plan 03: Link validation
- RESEARCH.md: depcheck, interactive audit patterns
- CONTEXT.md: Essential script criteria, DEPRECATED.md format

**What comes after:**
- Phase 8.1 complete, ready for release
- All documentation validated and polished

## Tasks

<task name="Create script analyzer" type="auto">
  <files>scripts/audit/script-analyzer.js</files>
  <action>
Create script analyzer per RESEARCH.md Pattern 3 (Interactive Script Audit):

```javascript
// scripts/audit/script-analyzer.js
const fs = require('fs-extra');
const path = require('path');
const fg = require('fast-glob');

/**
 * Analyze script usage across codebase
 * Per CONTEXT.md essential criteria:
 * - Used in package.json scripts, OR
 * - Called by install.js or core functionality, OR
 * - Referenced in documentation as user-facing tool, OR
 * - Part of CI/CD workflow
 */
async function analyzeScript(filePath) {
  const stat = await fs.stat(filePath);
  const content = await fs.readFile(filePath, 'utf8');
  const filename = path.basename(filePath);
  const relativePath = path.relative(process.cwd(), filePath);
  
  const usage = [];
  
  // 1. In package.json scripts?
  const pkgJson = await fs.readJson('package.json').catch(() => ({}));
  const inPackageScripts = Object.entries(pkgJson.scripts || {})
    .filter(([name, script]) => script.includes(filename))
    .map(([name]) => name);
  
  if (inPackageScripts.length) {
    usage.push(`package.json: ${inPackageScripts.join(', ')}`);
  }
  
  // 2. Called by install.js or core files?
  const coreFiles = [
    'bin/install.js',
    'bin/gsd-cli.js',
    'lib-ghcc/state-integration.js',
    'bin/lib/command-system/executor.js'
  ];
  
  const callers = [];
  for (const coreFile of coreFiles) {
    if (!await fs.pathExists(coreFile)) continue;
    
    const coreContent = await fs.readFile(coreFile, 'utf8');
    if (coreContent.includes(filename) || coreContent.includes(relativePath)) {
      callers.push(path.basename(coreFile));
    }
  }
  
  if (callers.length) {
    usage.push(`called by: ${callers.join(', ')}`);
  }
  
  // 3. Referenced in docs?
  const docFiles = await fg(['docs/**/*.md', 'README.md', 'specs/**/*.md']);
  const referencedInDocs = [];
  
  for (const docFile of docFiles) {
    const docContent = await fs.readFile(docFile, 'utf8');
    if (docContent.includes(filename) || docContent.includes(relativePath)) {
      referencedInDocs.push(path.basename(docFile));
    }
  }
  
  if (referencedInDocs.length) {
    usage.push(`docs: ${referencedInDocs.slice(0, 3).join(', ')}${referencedInDocs.length > 3 ? '...' : ''}`);
  }
  
  // 4. In GitHub workflows?
  const workflowFiles = await fg(['.github/workflows/**/*.yml']).catch(() => []);
  const inWorkflows = [];
  
  for (const workflowFile of workflowFiles) {
    const workflowContent = await fs.readFile(workflowFile, 'utf8');
    if (workflowContent.includes(filename) || workflowContent.includes(relativePath)) {
      inWorkflows.push(path.basename(workflowFile));
    }
  }
  
  if (inWorkflows.length) {
    usage.push(`CI: ${inWorkflows.join(', ')}`);
  }
  
  return {
    path: filePath,
    relativePath,
    filename,
    purpose: inferPurpose(content, filename),
    lastModified: stat.mtime.toISOString().split('T')[0],
    size: formatBytes(stat.size),
    usage: usage.length ? usage : ['Not detected'],
    essential: usage.length > 0 // Used = essential
  };
}

function inferPurpose(content, filename) {
  // Extract first comment or docstring
  const commentMatch = 
    content.match(/^\/\/\s*(.+)$/m) ||          // JS single-line
    content.match(/^#\s*(.+)$/m) ||              // Shell/Python comment
    content.match(/\/\*\*\s*\n\s*\*\s*(.+)/);    // JSDoc
  
  if (commentMatch) {
    return commentMatch[1].trim();
  }
  
  // Infer from filename
  if (filename.includes('test')) return 'Testing/validation';
  if (filename.includes('doc')) return 'Documentation generation';
  if (filename.includes('migration')) return 'Migration/upgrade utility';
  if (filename.includes('cleanup')) return 'Cleanup/maintenance';
  if (filename.includes('install')) return 'Installation';
  
  return 'Unknown';
}

function formatBytes(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
}

async function analyzeAllScripts() {
  // Find all script files (excluding core system and node_modules)
  const scriptFiles = await fg([
    'scripts/**/*.js',
    'scripts/**/*.sh',
    '*.js',
    '!bin/**',           // Core system - don't audit
    '!lib-ghcc/**',      // Core system - don't audit
    '!node_modules/**',
    '!.git/**'
  ]);
  
  const results = [];
  for (const file of scriptFiles) {
    const analysis = await analyzeScript(file);
    results.push(analysis);
  }
  
  return results;
}

module.exports = { analyzeScript, analyzeAllScripts };
```
  </action>
  <verify>
Test script analyzer:
```bash
node -e "require('./scripts/audit/script-analyzer').analyzeAllScripts().then(r => console.log(JSON.stringify(r, null, 2)))"
```

Should output analysis for each script file.
  </verify>
  <done>Script analyzer detects usage in package.json, core files, docs, and CI</done>
</task>

<task name="Create removal confirmer script" type="auto">
  <files>scripts/audit/removal-confirmer.js</files>
  <action>
Create interactive removal confirmer:

```javascript
// scripts/audit/removal-confirmer.js
const { analyzeAllScripts } = require('./script-analyzer');
const prompts = require('prompts');
const fs = require('fs-extra');
const chalk = require('chalk');
const path = require('path');

async function confirmRemovals() {
  console.log(chalk.cyan('\nðŸ” Analyzing project scripts...\n'));
  
  const scripts = await analyzeAllScripts();
  
  // Separate essential from non-essential
  const essential = scripts.filter(s => s.essential);
  const nonEssential = scripts.filter(s => !s.essential);
  
  console.log(chalk.green(`âœ“ ${essential.length} essential scripts (will keep)`));
  console.log(chalk.yellow(`âš  ${nonEssential.length} non-essential scripts (audit needed)\n`));
  
  if (essential.length > 0) {
    console.log(chalk.dim('Essential scripts:'));
    essential.forEach(s => {
      console.log(chalk.dim(`  - ${s.relativePath} (${s.usage.join(', ')})`));
    });
    console.log();
  }
  
  if (nonEssential.length === 0) {
    console.log(chalk.green('\nâœ… No non-essential scripts found\n'));
    return { kept: essential.length, removed: 0, removals: [] };
  }
  
  const toRemove = [];
  const toKeep = [];
  
  console.log(chalk.yellow('Auditing non-essential scripts:\n'));
  
  for (const script of nonEssential) {
    console.log(chalk.cyan(`\n${script.relativePath}`));
    console.log(`  Purpose: ${chalk.dim(script.purpose)}`);
    console.log(`  Last modified: ${chalk.dim(script.lastModified)}`);
    console.log(`  Size: ${chalk.dim(script.size)}`);
    console.log(`  Usage: ${chalk.dim(script.usage.join(', '))}`);
    
    const response = await prompts({
      type: 'select',
      name: 'action',
      message: 'Action?',
      choices: [
        { title: 'Keep', value: 'keep' },
        { title: 'Remove', value: 'remove' },
        { title: 'Skip for now', value: 'skip' }
      ],
      initial: 0
    });
    
    if (response.action === 'remove') {
      toRemove.push(script);
    } else if (response.action === 'keep') {
      toKeep.push(script);
    }
  }
  
  if (toRemove.length === 0) {
    console.log(chalk.green('\nâœ“ No files marked for removal\n'));
    return { kept: essential.length + toKeep.length, removed: 0, removals: [] };
  }
  
  // Final confirmation
  console.log(chalk.yellow(`\nâš   About to remove ${toRemove.length} files:\n`));
  toRemove.forEach(s => console.log(`  - ${s.relativePath}`));
  
  const finalConfirm = await prompts({
    type: 'confirm',
    name: 'proceed',
    message: 'Proceed with removal?',
    initial: false
  });
  
  if (!finalConfirm.proceed) {
    console.log(chalk.yellow('\nâš   Removal cancelled\n'));
    return { kept: essential.length + toKeep.length, removed: 0, removals: [] };
  }
  
  // Create DEPRECATED.md
  await createDeprecatedDoc(toRemove);
  
  // Remove files
  console.log(chalk.cyan('\nðŸ—‘  Removing files...\n'));
  for (const script of toRemove) {
    await fs.remove(script.path);
    console.log(chalk.red(`âœ“ Removed: ${script.relativePath}`));
  }
  
  console.log(chalk.green(`\nâœ… Removed ${toRemove.length} files\n`));
  console.log(chalk.dim(`Documentation: .planning/phases/08.1-*/DEPRECATED.md\n`));
  
  return {
    kept: essential.length + toKeep.length,
    removed: toRemove.length,
    removals: toRemove
  };
}

async function createDeprecatedDoc(removals) {
  const content = `# Deprecated Files - Phase 8.1

**Removal Date:** ${new Date().toISOString().split('T')[0]}

## Overview

These files were removed during Phase 8.1 documentation cleanup and script audit. They were identified as non-essential based on the following criteria:

- Not used in package.json scripts
- Not called by install.js or core functionality
- Not referenced in documentation
- Not part of CI/CD workflow

## Removed Files

| File | Purpose | Last Modified | Size | Reason |
|------|---------|---------------|------|--------|
${removals.map(r => `| ${r.relativePath} | ${r.purpose} | ${r.lastModified} | ${r.size} | ${r.usage[0] === 'Not detected' ? 'Unused' : 'Non-essential'} |`).join('\n')}

## Recovery

If any of these files are needed in the future, they can be recovered from git history:

\`\`\`bash
# Find file in history
git log --all --full-history -- path/to/file

# Restore file from specific commit
git checkout <commit-hash> -- path/to/file
\`\`\`

---
*Generated during Phase 8.1 script audit*
`;

  const phaseDir = '.planning/phases/08.1-documentation-cleanup-and-fixes';
  await fs.ensureDir(phaseDir);
  await fs.writeFile(path.join(phaseDir, 'DEPRECATED.md'), content);
}

// Run if called directly
if (require.main === module) {
  confirmRemovals().then(result => {
    console.log(`Final: ${result.kept} kept, ${result.removed} removed`);
  }).catch(err => {
    console.error(chalk.red(`Error: ${err.message}`));
    process.exit(1);
  });
}

module.exports = { confirmRemovals };
```

Make executable:
```bash
chmod +x scripts/audit/removal-confirmer.js
```
  </action>
  <verify>
Script exists and runs:
```bash
node scripts/audit/removal-confirmer.js --help 2>&1 | head -5
```
  </verify>
  <done>Interactive removal confirmer created with DEPRECATED.md generation</done>
</task>

<task name="Interactive script audit" type="checkpoint:human-action" gate="blocking">
  <what-built>
Script analyzer that detects usage patterns for all .js and .sh files in project.
  </what-built>
  <how-to-verify>
Run the interactive audit script:

```bash
node scripts/audit/removal-confirmer.js
```

For each script, you'll see:
- Filename and purpose
- Last modified date
- File size
- Usage (package.json scripts, core files, docs, CI)

Choose action for each:
- **Keep**: Essential script, preserve
- **Remove**: Non-essential, safe to delete
- **Skip**: Unsure, decide later

**Essential criteria (keep if ANY true):**
- Used in package.json scripts (npm run commands)
- Called by install.js, gsd-cli.js, or core libs
- Referenced in user-facing documentation
- Part of CI/CD workflow (.github/workflows/)

**Non-essential (safe to remove):**
- Old test files not in package.json
- Temporary scripts from development
- Duplicated functionality
- Abandoned experiments

The script will:
1. Show all non-essential files
2. Ask for confirmation for each
3. Create DEPRECATED.md documenting removals
4. Remove files you approve
  </how-to-verify>
  <resume-signal>
Type "done" when audit complete, or describe any issues encountered.
  </resume-signal>
</task>

<task name="Update SVG assets" type="auto">
  <files>assets/svg/*.svg</files>
  <action>
Update SVG assets per CONTEXT.md requirements:

**1. Find SVG files:**
```bash
find assets/ -name "*.svg" -type f
```

**2. Update install command in SVG:**

Current (old): `npx get-shit-done-cc`
New: `npx get-shit-done-multi --copilot`

Search and replace in SVG files:
```bash
# Find SVG with old command
grep -r "get-shit-done-cc" assets/

# Update each SVG (Claude will use edit tool)
# get-shit-done-cc â†’ get-shit-done-multi --copilot
```

**3. Update version number:**

Find version in SVG and update to current:
```bash
# Check current version
grep "version" package.json

# Update SVG version to match
```

**4. Update description:**

Remove "by TÃ‚CHES" if present (now multi-maintained):
```bash
grep -r "TÃ‚CHES" assets/

# Replace: "by TÃ‚CHES" â†’ "" (remove)
# Or: Update to "Multi-platform CLI workflow system"
```

**5. Verify visual rendering:**

Open SVG files in browser or viewer to ensure:
- Command is readable
- Version matches package.json
- Description is current
  </action>
  <verify>
Check SVG updates:
```bash
# Should show new command
grep "get-shit-done-multi" assets/svg/*.svg

# Should NOT show old command
grep "get-shit-done-cc" assets/svg/*.svg
# (empty output = success)

# Should match package.json version
PACKAGE_VERSION=$(grep '"version"' package.json | cut -d'"' -f4)
grep "$PACKAGE_VERSION" assets/svg/*.svg
```
  </verify>
  <done>SVG assets updated with current install command, version, and description</done>
</task>

<task name="Commit script audit and asset updates" type="auto">
  <files>.planning/phases/08.1-*/8.1-04-PLAN.md</files>
  <action>
Commit all changes from this plan:

```bash
# Source git identity helpers
if ! type commit_as_user >/dev/null 2>&1; then
    source /Users/rodolfo/croonix-github/get-shit-done/.github/get-shit-done/workflows/git-identity-helpers.sh
fi

# Stage all changes
git add \
  package.json \
  scripts/audit/ \
  assets/ \
  .planning/phases/08.1-*/DEPRECATED.md

# Commit with user identity preserved
commit_as_user "feat(8.1): script audit and asset updates

Phase 8.1 Plan 04:
- Script audit: Interactive removal with usage analysis
- DEPRECATED.md: Documents removed files with recovery instructions
- SVG assets: Updated install command, version, description"
```
  </action>
  <verify>
Check commit exists:
```bash
git log -1 --oneline
```
  </verify>
  <done>Script audit and asset updates committed</done>
</task>

## Verification Criteria

**Script Audit:**
- [ ] Script analyzer detects usage in package.json, core files, docs, CI
- [ ] Interactive audit presents scripts one-by-one with context
- [ ] Non-essential scripts removed with user confirmation
- [ ] DEPRECATED.md documents removed files

**SVG Assets:**
- [ ] Install command updated (`get-shit-done-multi --copilot`)
- [ ] Version matches package.json
- [ ] Description current (multi-maintained)

**Package.json:**
- [ ] Scripts reference only existing files
- [ ] Removed scripts not referenced

## Success Criteria

**Observable behaviors (must_haves realized):**
1. Non-essential scripts removed with user confirmation âœ“
2. DEPRECATED.md documents removed files âœ“
3. SVG assets show current install command and version âœ“
4. Package.json scripts reference only existing files âœ“

## Output Artifacts

**Created:**
- `scripts/audit/script-analyzer.js` - Usage analysis
- `scripts/audit/removal-confirmer.js` - Interactive removal
- `.planning/phases/08.1-*/DEPRECATED.md` - Removal documentation

**Modified:**
- `assets/svg/*.svg` - Updated install messages
- `package.json` - Removed scripts if non-essential

**Removed:**
- Non-essential scripts (documented in DEPRECATED.md)
