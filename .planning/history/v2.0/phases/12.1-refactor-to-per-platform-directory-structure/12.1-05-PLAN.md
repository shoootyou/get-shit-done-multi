---
phase: 12.1-refactor-to-per-platform-directory-structure
plan: "05"
type: execute
wave: 1
depends_on: ["12.1-04"]
files_modified:
  - bin/lib/platforms/claude/cleaner.js
  - bin/lib/platforms/copilot/cleaner.js
  - bin/lib/platforms/codex/cleaner.js
  - tests/integration/installation-output.test.js
  - tests/integration/validation-flow.test.js
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All cleaner files import from './serializer.js' (not platform-prefixed paths)"
    - "All integration tests import adapters from subdirectory paths"
    - "All imports resolve correctly (no MODULE_NOT_FOUND errors)"
    - "Full test suite passes after import fixes"
  artifacts:
    - path: "bin/lib/platforms/claude/cleaner.js"
      provides: "Claude cleaner with correct serializer import"
      line_pattern: "from './serializer.js'"
    - path: "bin/lib/platforms/copilot/cleaner.js"
      provides: "Copilot cleaner with correct serializer import"
      line_pattern: "from './serializer.js'"
    - path: "bin/lib/platforms/codex/cleaner.js"
      provides: "Codex cleaner with correct serializer import"
      line_pattern: "from './serializer.js'"
    - path: "tests/integration/installation-output.test.js"
      provides: "Integration test with correct adapter imports"
      line_pattern: "platforms/claude/adapter.js"
    - path: "tests/integration/validation-flow.test.js"
      provides: "Validation test with correct adapter import"
      line_pattern: "platforms/claude/adapter.js"
  key_links:
    - from: "bin/lib/platforms/claude/cleaner.js"
      to: "./serializer.js"
      via: "import statement"
      pattern: "from '\\./serializer\\.js'"
    - from: "bin/lib/platforms/copilot/cleaner.js"
      to: "./serializer.js"
      via: "import statement"
      pattern: "from '\\./serializer\\.js'"
    - from: "bin/lib/platforms/codex/cleaner.js"
      to: "./serializer.js"
      via: "import statement"
      pattern: "from '\\./serializer\\.js'"
    - from: "tests/integration/installation-output.test.js"
      to: "../../bin/lib/platforms/claude/adapter.js"
      via: "import statement"
      pattern: "platforms/claude/adapter\\.js"
    - from: "tests/integration/validation-flow.test.js"
      to: "../../bin/lib/platforms/claude/adapter.js"
      via: "import statement"
      pattern: "platforms/claude/adapter\\.js"
---

<objective>
Fix 7 broken import paths left over from Phase 12.1 directory restructuring.

**Purpose:** Close verification gaps that prevent tests from running and installations from succeeding.

**Output:** All import paths updated to match new per-platform directory structure, full test suite passing.
</objective>

<execution_context>
@.github/get-shit-done/workflows/execute-plan.md
@.github/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 12.1 Migration Context
@.planning/phases/12.1-refactor-to-per-platform-directory-structure/12.1-01-CONTEXT.md
@.planning/phases/12.1-refactor-to-per-platform-directory-structure/12.1-VERIFICATION.md

# What Was Already Completed
Phase 12.1 successfully restructured files into per-platform directories:
- bin/lib/platforms/claude/adapter.js, validator.js, serializer.js, cleaner.js
- bin/lib/platforms/copilot/adapter.js, validator.js, serializer.js, cleaner.js
- bin/lib/platforms/codex/adapter.js, validator.js, serializer.js, cleaner.js
- bin/lib/platforms/_shared/base-adapter.js, base-validator.js, etc.

Most imports were updated correctly, but 7 imports were missed and still reference old paths.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix cleaner serializer imports</name>
  <files>
    bin/lib/platforms/claude/cleaner.js
    bin/lib/platforms/copilot/cleaner.js
    bin/lib/platforms/codex/cleaner.js
  </files>
  <action>
Update import statements in all three cleaner files from platform-prefixed paths to simple relative paths:

**Claude cleaner (bin/lib/platforms/claude/cleaner.js):**
- Line 4: Change `from './claude-serializer.js'` to `from './serializer.js'`

**Copilot cleaner (bin/lib/platforms/copilot/cleaner.js):**
- Line 4: Change `from './copilot-serializer.js'` to `from './serializer.js'`

**Codex cleaner (bin/lib/platforms/codex/cleaner.js):**
- Line 4: Change `from './codex-serializer.js'` to `from './serializer.js'`

Use sed for precise single-line replacement:

```bash
# Claude
sed -i "s|from './claude-serializer.js'|from './serializer.js'|g" bin/lib/platforms/claude/cleaner.js

# Copilot
sed -i "s|from './copilot-serializer.js'|from './serializer.js'|g" bin/lib/platforms/copilot/cleaner.js

# Codex
sed -i "s|from './codex-serializer.js'|from './serializer.js'|g" bin/lib/platforms/codex/cleaner.js
```

Verify changes with grep:
```bash
grep "from './serializer.js'" bin/lib/platforms/*/cleaner.js
```

Expected: 3 matches (one per platform).
  </action>
  <verify>
All three cleaner files import from './serializer.js':
```bash
grep -n "serializeFrontmatter.*from" bin/lib/platforms/*/cleaner.js
```
Each should show: `import { serializeFrontmatter } from './serializer.js';`
  </verify>
  <done>
All cleaner files import from './serializer.js' (verified by grep), no platform-prefixed imports remain.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix integration test adapter imports</name>
  <files>
    tests/integration/installation-output.test.js
    tests/integration/validation-flow.test.js
  </files>
  <action>
Update adapter import paths in integration tests from old flat structure to new subdirectory structure:

**installation-output.test.js:**
- Line 7: Change `from '../../bin/lib/platforms/claude-adapter.js'` to `from '../../bin/lib/platforms/claude/adapter.js'`
- Line 8: Change `from '../../bin/lib/platforms/copilot-adapter.js'` to `from '../../bin/lib/platforms/copilot/adapter.js'`
- Line 9: Change `from '../../bin/lib/platforms/codex-adapter.js'` to `from '../../bin/lib/platforms/codex/adapter.js'`

**validation-flow.test.js:**
- Line 7: Change `from '../../bin/lib/platforms/claude-adapter.js'` to `from '../../bin/lib/platforms/claude/adapter.js'`

Use sed for precise replacement:

```bash
# installation-output.test.js (3 imports)
sed -i "s|platforms/claude-adapter.js|platforms/claude/adapter.js|g" tests/integration/installation-output.test.js
sed -i "s|platforms/copilot-adapter.js|platforms/copilot/adapter.js|g" tests/integration/installation-output.test.js
sed -i "s|platforms/codex-adapter.js|platforms/codex/adapter.js|g" tests/integration/installation-output.test.js

# validation-flow.test.js (1 import)
sed -i "s|platforms/claude-adapter.js|platforms/claude/adapter.js|g" tests/integration/validation-flow.test.js
```

Verify all adapter imports now use subdirectory paths:
```bash
grep "from.*platforms/.*/adapter.js" tests/integration/*.test.js
```

Expected: 4 matches with subdirectory paths (claude/adapter.js, copilot/adapter.js, codex/adapter.js).
  </action>
  <verify>
All integration test imports use subdirectory paths:
```bash
grep -n "Adapter.*from" tests/integration/installation-output.test.js tests/integration/validation-flow.test.js
```
Each should show paths like `platforms/claude/adapter.js` (not `platforms/claude-adapter.js`).
  </verify>
  <done>
All integration test adapter imports use new subdirectory paths (verified by grep), no old flat paths remain.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify all imports resolve</name>
  <files>
    (verification only - no file modifications)
  </files>
  <action>
Run full test suite to verify all import paths now resolve correctly:

```bash
npm test
```

Expected outcome:
- No MODULE_NOT_FOUND errors
- All tests pass (unit + integration)
- Test suite completes successfully

If any import errors remain, diagnose with:
```bash
node --experimental-loader=./bin/lib/platforms/claude/cleaner.js
node --experimental-loader=./tests/integration/installation-output.test.js
```

All imports should resolve without errors.
  </action>
  <verify>
Test suite passes completely:
```bash
npm test 2>&1 | tee test-output.txt
grep -E "(PASS|FAIL|ERROR)" test-output.txt
```
Expected: All PASS, no FAIL or ERROR.
  </verify>
  <done>
Full test suite passes with no import resolution errors. All 7 broken imports are fixed.
  </done>
</task>

</tasks>

<verification>

## Import Path Verification

**Cleaner files:**
```bash
grep "from './serializer.js'" bin/lib/platforms/*/cleaner.js | wc -l
# Expected: 3
```

**Integration tests:**
```bash
grep "platforms/.*/adapter.js" tests/integration/*.test.js | wc -l
# Expected: 4
```

**No old paths remain:**
```bash
# Should return nothing
grep -r "claude-adapter.js\|copilot-adapter.js\|codex-adapter.js" tests/integration/
grep -r "claude-serializer.js\|copilot-serializer.js\|codex-serializer.js" bin/lib/platforms/
```

## Test Suite Verification

```bash
npm test
# Expected: All tests pass, no MODULE_NOT_FOUND errors
```

</verification>

<success_criteria>

Phase 12.1 gaps closed when:
- [x] All 3 cleaner files import from './serializer.js' (not platform-prefixed)
- [x] installation-output.test.js imports from platforms/{platform}/adapter.js (3 imports)
- [x] validation-flow.test.js imports from platforms/claude/adapter.js (1 import)
- [x] No old import paths remain (claude-adapter.js, claude-serializer.js, etc.)
- [x] Full test suite passes with no import errors
- [x] All 7 gaps from VERIFICATION.md are resolved
- [x] Re-verification would show 27/27 must-haves passing (100%)

</success_criteria>

<output>
After completion, create `.planning/phases/12.1-refactor-to-per-platform-directory-structure/12.1-05-SUMMARY.md`
</output>
