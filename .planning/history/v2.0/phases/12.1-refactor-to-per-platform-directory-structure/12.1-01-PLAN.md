---
phase: 12.1-refactor-to-per-platform-directory-structure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bin/lib/platforms/claude/adapter.js
  - bin/lib/platforms/claude/validator.js
  - bin/lib/platforms/claude/serializer.js
  - bin/lib/platforms/claude/cleaner.js
  - bin/lib/installer/install-skills.js
  - tests/unit/platforms/claude/serializer.test.js
autonomous: true

must_haves:
  truths:
    - Claude platform files are in platforms/claude/ directory
    - All imports to Claude platform files resolve correctly
    - Install test with --claude flag succeeds
  artifacts:
    - path: "bin/lib/platforms/claude/adapter.js"
      provides: "ClaudeAdapter class"
      exports: ["ClaudeAdapter"]
    - path: "bin/lib/platforms/claude/validator.js"
      provides: "ClaudeValidator class"
      exports: ["ClaudeValidator"]
    - path: "bin/lib/platforms/claude/serializer.js"
      provides: "serializeFrontmatter function"
      exports: ["serializeFrontmatter"]
    - path: "bin/lib/platforms/claude/cleaner.js"
      provides: "cleanFrontmatter function"
      exports: ["cleanFrontmatter"]
    - path: "tests/unit/platforms/claude/serializer.test.js"
      provides: "Claude serializer tests"
      min_lines: 100
  key_links:
    - from: "bin/lib/platforms/claude/adapter.js"
      to: "./serializer.js"
      via: "import statement"
      pattern: "from.*serializer\\.js"
    - from: "bin/lib/installer/install-skills.js"
      to: "../platforms/claude/validator.js"
      via: "import statement"
      pattern: "from.*claude/validator"
---

<objective>
Migrate Claude platform files from domain-based structure (frontmatter/, serialization/, platforms/) to platform-based structure (platforms/claude/).

Purpose: Improve encapsulation and make adding new platforms easier by grouping all Claude-specific code together.
Output: Claude platform files in platforms/claude/ with all imports updated and working.
</objective>

<execution_context>
@.github/get-shit-done/workflows/execute-plan.md
@.github/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12.1-refactor-to-per-platform-directory-structure/12.1-01-CONTEXT.md
@.planning/phases/12.1-refactor-to-per-platform-directory-structure/12.1-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Migrate Claude platform source files</name>
  <files>
    bin/lib/platforms/claude/adapter.js
    bin/lib/platforms/claude/validator.js
    bin/lib/platforms/claude/serializer.js
    bin/lib/platforms/claude/cleaner.js
  </files>
  <action>
Create target directory and move Claude platform files using git mv to preserve history:

1. Create directory:
   ```bash
   mkdir -p bin/lib/platforms/claude
   ```

2. Move files (preserves git history):
   ```bash
   git mv bin/lib/frontmatter/claude-validator.js bin/lib/platforms/claude/validator.js
   git mv bin/lib/serialization/claude-serializer.js bin/lib/platforms/claude/serializer.js
   git mv bin/lib/serialization/claude-cleaner.js bin/lib/platforms/claude/cleaner.js
   git mv bin/lib/platforms/claude-adapter.js bin/lib/platforms/claude/adapter.js
   ```

3. Update internal imports within moved files:
   - In adapter.js: Change `from '../serialization/claude-serializer.js'` to `from './serializer.js'` (same directory now)
   - In validator.js: Keep base-validator import as-is (will be updated in Plan 04)
   - Pattern: Use sed to update paths

Named exports remain unchanged (ClaudeAdapter, ClaudeValidator, serializeFrontmatter, cleanFrontmatter).
  </action>
  <verify>
Run: `ls -la bin/lib/platforms/claude/` shows 4 files (adapter.js, validator.js, serializer.js, cleaner.js)
Run: `git status` shows 4 renames (R) for Claude files
Run: `node --eval "import('./bin/lib/platforms/claude/adapter.js').then(() => console.log('OK'))"` succeeds
  </verify>
  <done>
Claude platform files exist in platforms/claude/ directory with git rename history preserved.
  </done>
</task>

<task type="auto">
  <name>Migrate Claude platform test files</name>
  <files>tests/unit/platforms/claude/serializer.test.js</files>
  <action>
Create test directory and move Claude test files using git mv:

1. Create directory:
   ```bash
   mkdir -p tests/unit/platforms/claude
   ```

2. Move test file:
   ```bash
   git mv tests/unit/claude-serializer.test.js tests/unit/platforms/claude/serializer.test.js
   ```

3. Update imports in test file:
   - Change `from '../../bin/lib/serialization/claude-serializer.js'` to `from '../../../../bin/lib/platforms/claude/serializer.js'`
   - Use sed for path updates

Test structure now mirrors source structure (bin/lib/platforms/claude → tests/unit/platforms/claude).
  </action>
  <verify>
Run: `ls -la tests/unit/platforms/claude/` shows serializer.test.js
Run: `git status` shows rename (R) for test file
Run: `grep -r "from.*serialization/claude" tests/unit/` returns nothing (old import paths removed)
  </verify>
  <done>
Claude test files exist in tests/unit/platforms/claude/ mirroring source structure.
  </done>
</task>

<task type="auto">
  <name>Update imports in files that use Claude platform</name>
  <files>bin/lib/installer/install-skills.js</files>
  <action>
Update all imports that reference Claude platform files:

1. Find all files that import Claude modules:
   ```bash
   grep -r "from.*frontmatter/claude-validator" bin/lib/ --include="*.js"
   grep -r "from.*serialization/claude-serializer" bin/lib/ --include="*.js"
   grep -r "from.*serialization/claude-cleaner" bin/lib/ --include="*.js"
   ```

2. Update imports in install-skills.js:
   - `from '../frontmatter/claude-validator.js'` → `from '../platforms/claude/validator.js'`
   - `from '../serialization/claude-cleaner.js'` → `from '../platforms/claude/cleaner.js'`

3. Use sed for updates (handles both quote types):
   ```bash
   sed -i '' "s|['\"]../frontmatter/claude-validator.js['\"]|'../platforms/claude/validator.js'|g" bin/lib/installer/install-skills.js
   sed -i '' "s|['\"]../serialization/claude-cleaner.js['\"]|'../platforms/claude/cleaner.js'|g" bin/lib/installer/install-skills.js
   ```

4. Verify no old imports remain:
   ```bash
   grep -r "frontmatter/claude\|serialization/claude" bin/lib/ tests/ --include="*.js"
   ```
   Should return no results.
  </action>
  <verify>
Run: `grep -r "from.*platforms/claude/validator" bin/lib/installer/install-skills.js` succeeds
Run: `grep -r "frontmatter/claude\|serialization/claude" bin/lib/ tests/ --include="*.js"` returns no results
Run: `node bin/lib/installer/install-skills.js` (dry run if possible) or validate imports resolve
  </verify>
  <done>
All files that use Claude platform import from new locations (platforms/claude/).
  </done>
</task>

<task type="auto">
  <name>Validate Claude migration with install test</name>
  <files>N/A</files>
  <action>
Test the migration by running a full install test in /tmp:

1. Create test directory:
   ```bash
   mkdir -p /tmp/gsd-test-claude-migration
   cd /tmp/gsd-test-claude-migration
   ```

2. Run installer with absolute path:
   ```bash
   node /Users/rodolfo/croonix-github/gsd/get-shit-done-multi/bin/install.js --claude --yes
   ```

3. Verify installation succeeds (exit code 0)

4. Check that Claude skills/agents were installed:
   ```bash
   ls -la .claude/skills/ .claude/agents/
   ```

5. Clean up test directory:
   ```bash
   cd /
   rm -rf /tmp/gsd-test-claude-migration
   ```

If install fails, rollback migration:
```bash
git reset --hard HEAD  # if uncommitted
# or
git reset --hard HEAD~1  # if already committed
```
  </action>
  <verify>
Install test succeeds with exit code 0
Test directory contains .claude/skills/ and .claude/agents/ directories
No errors in install output
  </verify>
  <done>
Claude platform migration validated with successful install test in /tmp.
  </done>
</task>

</tasks>

<verification>
1. All Claude platform files exist in bin/lib/platforms/claude/
2. All Claude test files exist in tests/unit/platforms/claude/
3. No files remain in bin/lib/frontmatter/ or bin/lib/serialization/ with 'claude' in name
4. All imports to Claude platform files use new paths
5. Git history preserved (git log --follow shows original commits)
6. Install test with --claude succeeds
</verification>

<success_criteria>
- Claude platform completely migrated to platforms/claude/ directory
- All imports updated and resolving correctly
- Git rename history preserved for all moved files
- Install test validates migration success
- No references to old paths (frontmatter/claude-*, serialization/claude-*) remain in codebase
</success_criteria>

<output>
After completion, create `.planning/phases/12.1-refactor-to-per-platform-directory-structure/12.1-01-SUMMARY.md`
</output>
