---
phase: 03-multi-platform-support
plan: 02
type: execute
wave: 2
depends_on: [03-01]
files_modified:
  - bin/lib/platforms/claude-adapter.js
  - bin/lib/platforms/copilot-adapter.js
  - bin/lib/platforms/codex-adapter.js
  - bin/lib/platforms/registry.js
autonomous: true
must_haves:
  - truth: "ClaudeAdapter transforms tools to capitalized comma-separated string"
    observable: "transformTools('Read, Write, Bash') returns 'Read, Write, Bash' unchanged. No metadata in transformFrontmatter(). getCommandPrefix() returns '/gsd-'"
  - truth: "CopilotAdapter transforms tools to lowercase array with mappings"
    observable: "transformTools('Read, Write, Bash') returns ['read', 'edit', 'execute']. Adds metadata block to frontmatter. getCommandPrefix() returns '/gsd-'"
  - truth: "CodexAdapter transforms tools same as Copilot but with different prefix"
    observable: "transformTools('Read, Write, Bash') returns ['read', 'edit', 'execute']. Adds metadata block. getCommandPrefix() returns '$gsd-' (NOT '/gsd-')"
  - truth: "Each adapter is ISOLATED with complete implementation"
    observable: "ClaudeAdapter extends PlatformAdapter. CopilotAdapter extends PlatformAdapter. CodexAdapter extends PlatformAdapter (NOT CopilotAdapter). No inheritance between concrete adapters"
  - truth: "Adapters registered in singleton registry"
    observable: "adapterRegistry.get('claude') returns ClaudeAdapter instance. adapterRegistry.getSupportedPlatforms() returns ['claude', 'copilot', 'codex']"
  - key_link: "Adapters → orchestrator (Wave 3 will call adapter methods)"
  - key_link: "Registry → CLI (Wave 3 will use getSupportedPlatforms() for validation)"
---

# Plan 03-02: Platform Adapters (Claude, Copilot, Codex)

## Objective
Implement three complete, isolated platform adapters (ClaudeAdapter, CopilotAdapter, CodexAdapter) and register them in the singleton registry.

## Context

**Depends On:** Plan 03-01 (base adapter and registry must exist)

**Prior Work:**
- Plan 03-01 created PlatformAdapter base class with 6 abstract methods
- Plan 03-01 created AdapterRegistry singleton (empty, ready for registration)
- Research documented tool mappings and frontmatter requirements per platform

**This Plan Creates:**
- ClaudeAdapter: Capitalized tools, no metadata, `.md` extension, `/gsd-` prefix
- CopilotAdapter: Lowercase tools with mappings, metadata block, `.agent.md` extension, `/gsd-` prefix
- CodexAdapter: Same as Copilot but `$gsd-` prefix (ISOLATED, no inheritance)
- Registration of all three adapters in adapterRegistry

**Why Wave 2:**
- All three adapters depend on base adapter (03-01)
- All three can be built in parallel (no interdependencies)
- Registry update happens after all three exist

**Architectural Rule (CRITICAL):**
Per ARCHITECTURE-DECISION.md and PLATFORM-02: Each adapter MUST extend ONLY PlatformAdapter. NO inheritance between ClaudeAdapter, CopilotAdapter, CodexAdapter. Code duplication between CopilotAdapter and CodexAdapter is INTENTIONAL and REQUIRED. Platform isolation over DRY.

## Tasks

<task name="create-claude-adapter" type="auto">
  <files>bin/lib/platforms/claude-adapter.js</files>
  <action>
Create ClaudeAdapter with platform-specific transformations:

```javascript
// bin/lib/platforms/claude-adapter.js
import { PlatformAdapter } from './base-adapter.js';

/**
 * Platform adapter for Claude Code
 * Tools: Capitalized comma-separated string
 * Frontmatter: No metadata block
 * File extension: .md
 * Command prefix: /gsd-
 */
export class ClaudeAdapter extends PlatformAdapter {
  constructor() {
    super('claude');
  }
  
  /**
   * Get file extension for Claude agents
   * @returns {string}
   */
  getFileExtension() {
    return '.md';
  }
  
  /**
   * Get target installation directory
   * @param {boolean} isGlobal - Global vs local installation
   * @returns {string}
   */
  getTargetDir(isGlobal) {
    return isGlobal ? '~/.claude' : '.claude';
  }
  
  /**
   * Get command prefix for Claude
   * @returns {string}
   */
  getCommandPrefix() {
    return '/gsd-';
  }
  
  /**
   * Get path reference prefix
   * @returns {string}
   */
  getPathReference() {
    return '.claude';
  }
  
  /**
   * Transform tools for Claude (keep capitalized)
   * @param {string} tools - Comma-separated tools from template
   * @returns {string} Unchanged for Claude
   */
  transformTools(tools) {
    // Claude uses capitalized comma-separated string
    // Template already has correct format: "Read, Write, Bash"
    return tools;
  }
  
  /**
   * Transform frontmatter for Claude
   * @param {Object} data - Frontmatter object from template
   * @returns {Object}
   */
  transformFrontmatter(data) {
    // Claude: minimal frontmatter, no metadata block
    return {
      name: data.name,
      description: data.description,
      tools: this.transformTools(data.tools || '')
    };
  }
}
```

Per PLATFORM-03: Claude keeps tools capitalized, no metadata, uses .md extension.
  </action>
  <verify>
cat bin/lib/platforms/claude-adapter.js
node -e "
import('./bin/lib/platforms/claude-adapter.js').then(m => {
  const adapter = new m.ClaudeAdapter();
  console.log('Platform:', adapter.platformName);
  console.log('Extension:', adapter.getFileExtension());
  console.log('Prefix:', adapter.getCommandPrefix());
  console.log('Tools:', adapter.transformTools('Read, Write, Bash'));
  console.log('Frontmatter:', JSON.stringify(adapter.transformFrontmatter({
    name: 'test',
    description: 'Test skill',
    tools: 'Read, Write'
  })));
});
"
  </verify>
  <done>
ClaudeAdapter created with 6 methods implemented. transformTools() keeps capitalized format. transformFrontmatter() includes only name, description, tools (no metadata).
  </done>
</task>

<task name="create-copilot-adapter" type="auto">
  <files>bin/lib/platforms/copilot-adapter.js</files>
  <action>
Create CopilotAdapter with platform-specific transformations:

```javascript
// bin/lib/platforms/copilot-adapter.js
import { PlatformAdapter } from './base-adapter.js';

/**
 * Platform adapter for GitHub Copilot CLI
 * Tools: Lowercase array with mappings
 * Frontmatter: Includes metadata block
 * File extension: .agent.md
 * Command prefix: /gsd-
 */
export class CopilotAdapter extends PlatformAdapter {
  constructor() {
    super('copilot');
    
    // Tool mappings: Claude names → Copilot aliases
    // Per TEMPLATE-02B and PLATFORM-04
    this.toolMappings = {
      'Read': 'read',
      'Write': 'edit',
      'Edit': 'edit',
      'Bash': 'execute',
      'Grep': 'search',
      'Glob': 'search',
      'Task': 'agent'
    };
  }
  
  /**
   * Get file extension for Copilot agents
   * @returns {string}
   */
  getFileExtension() {
    return '.agent.md';
  }
  
  /**
   * Get target installation directory
   * @param {boolean} isGlobal - Global vs local installation
   * @returns {string}
   */
  getTargetDir(isGlobal) {
    return isGlobal ? '~/.copilot' : '.github';
  }
  
  /**
   * Get command prefix for Copilot
   * @returns {string}
   */
  getCommandPrefix() {
    return '/gsd-';
  }
  
  /**
   * Get path reference prefix
   * @returns {string}
   */
  getPathReference() {
    return '.github';
  }
  
  /**
   * Transform tools for Copilot (lowercase with mappings)
   * @param {string} tools - Comma-separated tools from template
   * @returns {Array<string>} Lowercase array
   */
  transformTools(tools) {
    // Convert comma-separated string to array
    const toolsArray = tools.split(',').map(t => t.trim());
    
    // Apply mappings: Claude names → Copilot aliases
    return toolsArray.map(tool => {
      return this.toolMappings[tool] || tool.toLowerCase();
    });
  }
  
  /**
   * Transform frontmatter for Copilot
   * @param {Object} data - Frontmatter object from template
   * @returns {Object}
   */
  transformFrontmatter(data) {
    // Copilot: includes metadata block per PLATFORM-04
    return {
      name: data.name,
      description: data.description,
      tools: this.transformTools(data.tools || ''),
      metadata: {
        platform: 'copilot',
        generated: new Date().toISOString().split('T')[0],
        templateVersion: '1.0.0',
        projectVersion: '2.0.0',
        projectName: 'get-shit-done-multi'
      }
    };
  }
}
```

Per PLATFORM-04: Copilot uses lowercase tool names with mappings (Bash→execute), includes metadata, uses .agent.md extension.
  </action>
  <verify>
cat bin/lib/platforms/copilot-adapter.js
node -e "
import('./bin/lib/platforms/copilot-adapter.js').then(m => {
  const adapter = new m.CopilotAdapter();
  console.log('Platform:', adapter.platformName);
  console.log('Extension:', adapter.getFileExtension());
  console.log('Prefix:', adapter.getCommandPrefix());
  console.log('Tools:', JSON.stringify(adapter.transformTools('Read, Write, Bash')));
  const fm = adapter.transformFrontmatter({
    name: 'test',
    description: 'Test skill',
    tools: 'Read, Bash'
  });
  console.log('Has metadata:', !!fm.metadata);
  console.log('Tools format:', Array.isArray(fm.tools) ? 'array' : 'string');
});
"
  </verify>
  <done>
CopilotAdapter created with 6 methods implemented. transformTools() returns lowercase array with mappings (Bash→execute, Read→read). transformFrontmatter() includes metadata block.
  </done>
</task>

<task name="create-codex-adapter" type="auto">
  <files>bin/lib/platforms/codex-adapter.js</files>
  <action>
Create CodexAdapter as ISOLATED implementation (NO inheritance from CopilotAdapter):

```javascript
// bin/lib/platforms/codex-adapter.js
import { PlatformAdapter } from './base-adapter.js';

/**
 * Platform adapter for Codex CLI
 * Tools: Lowercase array with mappings (SAME AS COPILOT)
 * Frontmatter: Includes metadata block (SAME AS COPILOT)
 * File extension: .agent.md (SAME AS COPILOT)
 * Command prefix: $gsd- (DIFFERENT from Copilot)
 * 
 * ARCHITECTURAL NOTE:
 * This adapter is 95% identical to CopilotAdapter but extends
 * ONLY PlatformAdapter (not CopilotAdapter). Code duplication
 * is INTENTIONAL per ARCHITECTURE-DECISION.md and PLATFORM-02.
 * Platform isolation over DRY principle.
 */
export class CodexAdapter extends PlatformAdapter {
  constructor() {
    super('codex');
    
    // Tool mappings: Claude names → Codex aliases
    // DUPLICATED from CopilotAdapter - this is INTENTIONAL
    // Per PLATFORM-04B and ARCHITECTURE-DECISION.md
    this.toolMappings = {
      'Read': 'read',
      'Write': 'edit',
      'Edit': 'edit',
      'Bash': 'execute',
      'Grep': 'search',
      'Glob': 'search',
      'Task': 'agent'
    };
  }
  
  /**
   * Get file extension for Codex agents
   * @returns {string}
   */
  getFileExtension() {
    return '.agent.md';
  }
  
  /**
   * Get target installation directory
   * @param {boolean} isGlobal - Global vs local installation
   * @returns {string}
   */
  getTargetDir(isGlobal) {
    return isGlobal ? '~/.codex' : '.codex';
  }
  
  /**
   * Get command prefix for Codex
   * @returns {string}
   */
  getCommandPrefix() {
    // ONLY DIFFERENCE from Copilot: $ instead of /
    return '$gsd-';
  }
  
  /**
   * Get path reference prefix
   * @returns {string}
   */
  getPathReference() {
    return '.codex';
  }
  
  /**
   * Transform tools for Codex (lowercase with mappings)
   * DUPLICATED from CopilotAdapter - platform isolation
   * @param {string} tools - Comma-separated tools from template
   * @returns {Array<string>} Lowercase array
   */
  transformTools(tools) {
    // Convert comma-separated string to array
    const toolsArray = tools.split(',').map(t => t.trim());
    
    // Apply mappings: Claude names → Codex aliases
    return toolsArray.map(tool => {
      return this.toolMappings[tool] || tool.toLowerCase();
    });
  }
  
  /**
   * Transform frontmatter for Codex
   * DUPLICATED from CopilotAdapter with different platform value
   * @param {Object} data - Frontmatter object from template
   * @returns {Object}
   */
  transformFrontmatter(data) {
    // Codex: includes metadata block per PLATFORM-04B
    return {
      name: data.name,
      description: data.description,
      tools: this.transformTools(data.tools || ''),
      metadata: {
        platform: 'codex', // Different from Copilot
        generated: new Date().toISOString().split('T')[0],
        templateVersion: '1.0.0',
        projectVersion: '2.0.0',
        projectName: 'get-shit-done-multi'
      }
    };
  }
}
```

Per PLATFORM-04B and ARCHITECTURE-DECISION.md: CodexAdapter extends ONLY PlatformAdapter. Code is duplicated from CopilotAdapter (intentional). Only difference is command prefix: `$gsd-` vs `/gsd-`.
  </action>
  <verify>
cat bin/lib/platforms/codex-adapter.js
node -e "
import('./bin/lib/platforms/codex-adapter.js').then(m => {
  const adapter = new m.CodexAdapter();
  console.log('Platform:', adapter.platformName);
  console.log('Prefix:', adapter.getCommandPrefix()); // Should be \$gsd-
  console.log('Tools:', JSON.stringify(adapter.transformTools('Read, Write, Bash')));
  console.log('Extends PlatformAdapter:', Object.getPrototypeOf(m.CodexAdapter).name);
});
"
  </verify>
  <done>
CodexAdapter created extending ONLY PlatformAdapter (not CopilotAdapter). getCommandPrefix() returns '$gsd-' (different from Copilot's '/gsd-'). transformTools() and transformFrontmatter() are duplicated implementations.
  </done>
</task>

<task name="register-adapters" type="auto">
  <files>bin/lib/platforms/registry.js</files>
  <action>
Update registry.js to import and register all three adapters:

Add after AdapterRegistry class definition, before singleton export:

```javascript
import { ClaudeAdapter } from './claude-adapter.js';
import { CopilotAdapter } from './copilot-adapter.js';
import { CodexAdapter } from './codex-adapter.js';
```

Update AdapterRegistry constructor to register adapters:

```javascript
class AdapterRegistry {
  constructor() {
    this.adapters = new Map();
    this._initialize();
  }
  
  /**
   * Initialize registry with platform adapters
   * @private
   */
  _initialize() {
    // Register all three platform adapters
    this.register('claude', new ClaudeAdapter());
    this.register('copilot', new CopilotAdapter());
    this.register('codex', new CodexAdapter());
  }
  
  // ... rest of methods unchanged ...
}
```

Registry now initializes with all three adapters on construction.
  </action>
  <verify>
cat bin/lib/platforms/registry.js
node -e "
import('./bin/lib/platforms/registry.js').then(m => {
  const platforms = m.adapterRegistry.getSupportedPlatforms();
  console.log('Registered platforms:', platforms);
  console.log('Has claude:', m.adapterRegistry.has('claude'));
  console.log('Has copilot:', m.adapterRegistry.has('copilot'));
  console.log('Has codex:', m.adapterRegistry.has('codex'));
  console.log('Claude prefix:', m.adapterRegistry.get('claude').getCommandPrefix());
  console.log('Codex prefix:', m.adapterRegistry.get('codex').getCommandPrefix());
});
"
  </verify>
  <done>
AdapterRegistry imports and registers all three adapters. getSupportedPlatforms() returns ['claude', 'copilot', 'codex']. get() returns correct adapter instances.
  </done>
</task>

## Verification

After all tasks complete:

```bash
# Verify all adapter files exist
ls -la bin/lib/platforms/*.js

# Test adapter isolation (no cross-inheritance)
node -e "
import('./bin/lib/platforms/claude-adapter.js').then(m1 => {
  import('./bin/lib/platforms/copilot-adapter.js').then(m2 => {
    import('./bin/lib/platforms/codex-adapter.js').then(m3 => {
      console.log('ClaudeAdapter parent:', Object.getPrototypeOf(m1.ClaudeAdapter).name);
      console.log('CopilotAdapter parent:', Object.getPrototypeOf(m2.CopilotAdapter).name);
      console.log('CodexAdapter parent:', Object.getPrototypeOf(m3.CodexAdapter).name);
      console.log('✓ All extend PlatformAdapter directly');
    });
  });
});
"

# Test tool transformations
node -e "
import('./bin/lib/platforms/registry.js').then(m => {
  const claude = m.adapterRegistry.get('claude');
  const copilot = m.adapterRegistry.get('copilot');
  const codex = m.adapterRegistry.get('codex');
  
  const input = 'Read, Write, Bash';
  console.log('Input:', input);
  console.log('Claude output:', claude.transformTools(input));
  console.log('Copilot output:', JSON.stringify(copilot.transformTools(input)));
  console.log('Codex output:', JSON.stringify(codex.transformTools(input)));
});
"

# Test command prefixes
node -e "
import('./bin/lib/platforms/registry.js').then(m => {
  console.log('Claude prefix:', m.adapterRegistry.get('claude').getCommandPrefix());
  console.log('Copilot prefix:', m.adapterRegistry.get('copilot').getCommandPrefix());
  console.log('Codex prefix:', m.adapterRegistry.get('codex').getCommandPrefix());
  console.log('✓ Codex uses $ prefix');
});
"

# Test frontmatter transformations
node -e "
import('./bin/lib/platforms/registry.js').then(m => {
  const data = { name: 'test', description: 'Test', tools: 'Read, Bash' };
  
  const claudeFm = m.adapterRegistry.get('claude').transformFrontmatter(data);
  const copilotFm = m.adapterRegistry.get('copilot').transformFrontmatter(data);
  const codexFm = m.adapterRegistry.get('codex').transformFrontmatter(data);
  
  console.log('Claude has metadata:', !!claudeFm.metadata);
  console.log('Copilot has metadata:', !!copilotFm.metadata);
  console.log('Codex has metadata:', !!codexFm.metadata);
  console.log('Copilot tools format:', Array.isArray(copilotFm.tools) ? 'array' : 'string');
  console.log('Codex tools format:', Array.isArray(codexFm.tools) ? 'array' : 'string');
});
"
```

## Success Criteria

- [ ] Three adapter files exist: claude-adapter.js, copilot-adapter.js, codex-adapter.js
- [ ] Each adapter extends ONLY PlatformAdapter (no cross-inheritance)
- [ ] ClaudeAdapter: transformTools() keeps capitalized, no metadata in frontmatter
- [ ] CopilotAdapter: transformTools() returns lowercase array, includes metadata
- [ ] CodexAdapter: transformTools() returns lowercase array, includes metadata
- [ ] Codex getCommandPrefix() returns '$gsd-' (not '/gsd-')
- [ ] Claude and Copilot getCommandPrefix() return '/gsd-'
- [ ] AdapterRegistry contains all three adapters
- [ ] getSupportedPlatforms() returns ['claude', 'copilot', 'codex']
- [ ] Tool mappings work correctly: Bash→execute, Read→read, etc.

## Output

Three complete platform adapters ready for orchestrator integration (Wave 3).

Git commit:
```
feat(platform): add Claude, Copilot, and Codex adapters

- ClaudeAdapter: capitalized tools, no metadata, .md extension
- CopilotAdapter: lowercase tools with mappings, metadata block, .agent.md
- CodexAdapter: same as Copilot but $gsd- prefix (ISOLATED implementation)
- All three registered in AdapterRegistry singleton

Per PLATFORM-03, PLATFORM-04, PLATFORM-04B requirements
Adheres to ARCHITECTURE-DECISION: platform isolation over DRY
Ready for Wave 3: orchestrator integration
```
