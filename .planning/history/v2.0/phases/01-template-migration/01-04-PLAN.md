---
phase: 01-template-migration
plan: 04
type: execute
wave: 4
depends_on: ["01-01", "01-02", "01-03"]
files_modified:
  - scripts/migrate-to-templates.js
  - scripts/lib/interactive-review.js
  - .planning/phases/01-template-migration/01-MIGRATION-REPORT.md
autonomous: false
must_haves:
  - comprehensive validation report generated showing all corrections
  - interactive UI for reviewing migrated files
  - side-by-side diff view (before ‚Üí after) for each file
  - user must type 'APPROVED' to continue (explicit confirmation)
  - migration blocked if any validation errors exist
  - after approval migration code committed to git
  - after approval migration code deleted from working tree
  - migration report saved to phase directory
user_setup:
  external_services: []
  manual_actions:
    - name: "Review migration output"
      description: "Manually review all migrated templates for correctness"
      why_manual: "Human validation required for ONE-TIME migration quality assurance"
---

# Plan 01-04: Validation, Report & Manual Review Gate

## Objective

Generate comprehensive validation report, provide interactive UI for manual review with side-by-side diffs, require explicit user approval, then commit and delete migration code.

## Context

This is Wave 4 of Phase 1 - the final validation and approval step. All files migrated (Plans 02-03), now we validate everything, present to user for review, and handle post-approval cleanup.

From CONTEXT.md decisions:
- **Collect ALL validation errors** - comprehensive report at end
- **Block migration if ANY errors** - must fix all before proceeding
- **Interactive terminal UI** - file browser for reviewing
- **Side-by-side diffs** - show before ‚Üí after for each file
- **Explicit approval required** - user must type 'APPROVED'
- **No rollback after approval** - ONE-TIME nature
- **Commit then delete** - migration code preserved only in git history

This plan includes a MANDATORY CHECKPOINT where migration pauses for human review.

## Tasks

<task name="create-interactive-review-ui" type="auto">
  <files>scripts/lib/interactive-review.js</files>
  <action>
    Create interactive review UI with file browser and diff viewer:
    
    **scripts/lib/interactive-review.js**:
    ```javascript
    import { input, select, confirm } from '@inquirer/prompts';
    import chalk from 'chalk';
    import open from 'open';
    import path from 'node:path';
    import fs from 'fs-extra';
    import { execSync } from 'node:child_process';
    
    /**
     * Generate migration summary statistics
     */
    export function generateSummary(skillsResult, agentsResult) {
      const lines = [];
      
      lines.push(chalk.blue.bold('\nüìä Migration Summary\n'));
      
      lines.push(chalk.cyan('Skills:'));
      lines.push(`  Total: ${skillsResult.total}`);
      lines.push(`  ${chalk.green('‚úì Successful:')} ${skillsResult.successful}`);
      if (skillsResult.failed > 0) {
        lines.push(`  ${chalk.red('‚úó Failed:')} ${skillsResult.failed}`);
      }
      
      lines.push(chalk.cyan('\nAgents:'));
      lines.push(`  Total: ${agentsResult.total}`);
      lines.push(`  ${chalk.green('‚úì Successful:')} ${agentsResult.successful}`);
      if (agentsResult.failed > 0) {
        lines.push(`  ${chalk.red('‚úó Failed:')} ${agentsResult.failed}`);
      }
      
      lines.push(chalk.cyan('\nFiles Created:'));
      lines.push(`  Skills: ${skillsResult.total} √ó 2 files (SKILL.md + version.json)`);
      lines.push(`  Agents: ${agentsResult.total} √ó 1 file (.agent.md) + versions.json`);
      lines.push(`  Shared: templates/get-shit-done/ directory`);
      
      const totalFiles = (skillsResult.total * 2) + agentsResult.total + 1;
      lines.push(chalk.green(`\n  Total files: ${totalFiles}`));
      
      return lines.join('\n');
    }
    
    /**
     * Check if diff tool is available
     */
    function getDiffTool() {
      const tools = [
        { command: 'code', name: 'VS Code' },
        { command: 'meld', name: 'Meld' },
        { command: 'diffuse', name: 'Diffuse' },
        { command: 'kompare', name: 'Kompare' }
      ];
      
      for (const tool of tools) {
        try {
          execSync(`which ${tool.command}`, { stdio: 'ignore' });
          return tool;
        } catch {
          // Tool not found, try next
        }
      }
      
      return null;
    }
    
    /**
     * Open external diff viewer for comparing before/after
     */
    async function openDiffViewer(sourcePath, targetPath) {
      const diffTool = getDiffTool();
      
      if (!diffTool) {
        console.log(chalk.yellow('‚ö† No diff tool found (code, meld, diffuse, kompare)'));
        console.log(chalk.gray(`  Source: ${sourcePath}`));
        console.log(chalk.gray(`  Target: ${targetPath}`));
        return;
      }
      
      console.log(chalk.cyan(`Opening ${diffTool.name} for diff...`));
      
      if (diffTool.command === 'code') {
        // VS Code diff syntax
        execSync(`code --diff "${sourcePath}" "${targetPath}"`, { stdio: 'inherit' });
      } else {
        // Generic diff tool syntax
        execSync(`${diffTool.command} "${sourcePath}" "${targetPath}"`, { stdio: 'inherit' });
      }
    }
    
    /**
     * Interactive file browser for reviewing migrated files
     */
    export async function interactiveReview(templatesDir) {
      console.log(chalk.blue.bold('\nüîç Manual Review\n'));
      console.log(chalk.gray('Review migrated templates before approval.\n'));
      
      const choices = [
        { name: 'View skills (29 files)', value: 'skills' },
        { name: 'View agents (13 files)', value: 'agents' },
        { name: 'View shared directory', value: 'shared' },
        { name: 'Open templates/ in file browser', value: 'browse' },
        { name: 'Continue to approval', value: 'done' }
      ];
      
      while (true) {
        const action = await select({
          message: 'What would you like to review?',
          choices
        });
        
        if (action === 'done') break;
        
        if (action === 'browse') {
          console.log(chalk.cyan('Opening templates/ directory...'));
          await open(templatesDir);
          continue;
        }
        
        if (action === 'skills') {
          const skillsDir = path.join(templatesDir, 'skills');
          const skills = await fs.readdir(skillsDir);
          const skillFiles = skills.filter(s => s.startsWith('gsd-'));
          
          const skill = await select({
            message: 'Select skill to review:',
            choices: [
              ...skillFiles.map(s => ({ name: s, value: s })),
              { name: '‚Üê Back', value: null }
            ]
          });
          
          if (skill) {
            const sourcePath = path.join(process.cwd(), '.github/skills', skill, 'SKILL.md');
            const targetPath = path.join(skillsDir, skill, 'SKILL.md');
            await openDiffViewer(sourcePath, targetPath);
          }
          continue;
        }
        
        if (action === 'agents') {
          const agentsDir = path.join(templatesDir, 'agents');
          const agents = await fs.readdir(agentsDir);
          const agentFiles = agents.filter(a => a.endsWith('.agent.md'));
          
          const agent = await select({
            message: 'Select agent to review:',
            choices: [
              ...agentFiles.map(a => ({ name: a, value: a })),
              { name: '‚Üê Back', value: null }
            ]
          });
          
          if (agent) {
            const sourcePath = path.join(process.cwd(), '.github/agents', agent);
            const targetPath = path.join(agentsDir, agent);
            await openDiffViewer(sourcePath, targetPath);
          }
          continue;
        }
        
        if (action === 'shared') {
          const sharedDir = path.join(templatesDir, 'get-shit-done');
          console.log(chalk.cyan('Opening shared directory...'));
          await open(sharedDir);
          continue;
        }
      }
    }
    
    /**
     * Explicit approval gate - user must type 'APPROVED'
     */
    export async function requestApproval() {
      console.log(chalk.yellow.bold('\n‚ö†Ô∏è  MANUAL APPROVAL REQUIRED\n'));
      console.log(chalk.gray('This is a ONE-TIME migration. Once approved:'));
      console.log(chalk.gray('  1. Migration code will be committed to git'));
      console.log(chalk.gray('  2. Migration code will be deleted from working tree'));
      console.log(chalk.gray('  3. templates/ becomes permanent source of truth'));
      console.log(chalk.gray('  4. No rollback possible\n'));
      
      const confirmation = await input({
        message: 'Type "APPROVED" to continue (or anything else to abort):',
      });
      
      if (confirmation.trim().toUpperCase() !== 'APPROVED') {
        console.log(chalk.red('\n‚ùå Migration aborted by user'));
        console.log(chalk.yellow('Cleaning up templates/ directory...'));
        return false;
      }
      
      console.log(chalk.green('\n‚úì Migration approved!'));
      return true;
    }
    ```
  </action>
  <verify>
    ```bash
    test -f scripts/lib/interactive-review.js && \
    echo "‚úì Interactive review module created"
    ```
  </verify>
  <done>Interactive review UI module exists with file browser and approval gate</done>
</task>

<task name="integrate-validation-and-review" type="auto">
  <files>scripts/migrate-to-templates.js</files>
  <action>
    Update main migration script to add validation report and interactive review:
    
    Replace the `// TODO: Validation and manual review (Plan 04)` section with:
    
    ```javascript
    import { generateSummary, interactiveReview, requestApproval } from './lib/interactive-review.js';
    
    // ... (after agents migration in main function)
    
    // Generate migration summary
    console.log(generateSummary(skillsResult, agentsResult));
    
    // Show validation report
    console.log('\n' + validator.generateReport());
    
    // Block if errors exist
    if (validator.hasErrors()) {
      console.log(chalk.red('\n‚ùå Migration blocked - fix errors and retry'));
      
      // Clean up templates/ directory
      const templatesDir = path.join(process.cwd(), 'templates');
      await fs.remove(templatesDir);
      console.log(chalk.yellow('‚ö† Cleaned up templates/ directory'));
      
      process.exit(1);
    }
    
    // Save migration report to phase directory
    const reportPath = path.join(
      process.cwd(), 
      '.planning/phases/01-template-migration/01-MIGRATION-REPORT.md'
    );
    
    const reportContent = `# Phase 1 Migration Report
    
**Generated:** ${new Date().toISOString()}
**Status:** ${validator.hasErrors() ? 'Failed' : 'Success'}

${generateSummary(skillsResult, agentsResult)}

## Validation Results

${validator.generateReport()}

## Files Created

### Skills (${skillsResult.total})
${skillsResult.results.map(r => `- ${r.skillName} ‚Üí ${r.file}`).join('\n')}

### Agents (${agentsResult.total})
${agentsResult.results.map(r => `- ${r.agentName} ‚Üí ${r.file}`).join('\n')}

### Shared Directory
- templates/get-shit-done/

## Next Steps

After approval:
1. Commit migration code to git
2. Delete migration code from working tree
3. Begin Phase 2 (installation foundation)
`;
    
    await fs.writeFile(reportPath, reportContent, 'utf-8');
    console.log(chalk.green(`\n‚úì Migration report saved: ${reportPath}`));
    
    // Interactive review
    const templatesDir = path.join(process.cwd(), 'templates');
    await interactiveReview(templatesDir);
    
    // Request approval
    const approved = await requestApproval();
    
    if (!approved) {
      // Clean up templates/
      await fs.remove(templatesDir);
      process.exit(0);
    }
    
    console.log(chalk.green('\n‚úÖ Phase 1 migration complete!'));
    console.log(chalk.cyan('\nNext steps:'));
    console.log(chalk.gray('  1. Run: git add scripts/ templates/ .planning/'));
    console.log(chalk.gray('  2. Run: git commit -m "feat(phase-1): complete template migration"'));
    console.log(chalk.gray('  3. Run: rm -rf scripts/migrate-to-templates.js scripts/lib/'));
    console.log(chalk.gray('  4. Run: git add -A && git commit -m "chore: remove migration code"'));
    console.log(chalk.gray('  5. Begin Phase 2 planning\n'));
    ```
  </action>
  <verify>
    ```bash
    # Run full migration with review (will pause for manual approval)
    node scripts/migrate-to-templates.js
    
    # After approval, check report exists
    test -f .planning/phases/01-template-migration/01-MIGRATION-REPORT.md && \
    echo "‚úì Migration report created"
    ```
  </verify>
  <done>Validation report generated and interactive review integrated with approval gate</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete ONE-TIME migration of 29 skills and 13 agents from .github/ to templates/ with:
    - Frontmatter corrections (TEMPLATE-01C for skills, TEMPLATE-01D for agents)
    - Tool name normalization (Copilot aliases ‚Üí Claude official)
    - Template variable injection ({{PLATFORM_ROOT}}, {{COMMAND_PREFIX}})
    - version.json per skill, consolidated versions.json for agents
    - Shared directory copied to templates/get-shit-done/
  </what-built>
  <how-to-verify>
    1. **Run migration script:**
       ```bash
       node scripts/migrate-to-templates.js
       ```
    
    2. **Review migration summary** - Should show all 29 skills + 13 agents migrated successfully
    
    3. **Check validation report** - Should show "‚úì All validations passed" (no errors)
    
    4. **Use interactive review UI:**
       - Select "View skills" to browse and compare before/after
       - Select "View agents" to browse and compare before/after
       - Open external diff viewer for detailed inspection
       - Verify frontmatter corrections applied correctly
    
    5. **Spot-check frontmatter corrections:**
       
       **Skills (check any from templates/skills/gsd-*/SKILL.md):**
       - `allowed-tools` field exists (not `tools`)
       - Tools are comma-separated string: "Read, Write, Bash" (not array)
       - Tool names capitalized correctly
       - `argument-hint` field exists (converted from `arguments`)
       - No unsupported fields: skill_version, requires_version, platforms, metadata
       - Check templates/skills/gsd-*/version.json has removed metadata
       
       **Agents (check any from templates/agents/*.agent.md):**
       - `tools` field is comma-separated string (not array)
       - Tool names capitalized correctly
       - No `metadata` block in frontmatter
       - `skills` field auto-generated (array of skill references)
       - Check templates/agents/versions.json has all agent metadata
    
    6. **Verify template variables:**
       - Search for `.github/` in templates/ ‚Üí should find `{{PLATFORM_ROOT}}` instead
       - Search for `/gsd-` in templates/ ‚Üí should find `{{COMMAND_PREFIX}}` instead
    
    7. **Verify shared directory:**
       - templates/get-shit-done/ exists with all resources
    
    8. **When ready, type "APPROVED"** in the interactive prompt
    
    9. **After approval, commit and delete:**
       ```bash
       git add scripts/ templates/ .planning/
       git commit -m "feat(phase-1): complete template migration"
       rm -rf scripts/migrate-to-templates.js scripts/lib/
       git add -A
       git commit -m "chore: remove migration code"
       ```
  </how-to-verify>
  <resume-signal>Type "approved" after verifying migration output is correct, or describe any issues found</resume-signal>
</task>

## Verification

After completing this plan:

1. **Validation report generated:** Comprehensive summary of all corrections and files
2. **Interactive review available:** File browser with external diff viewer integration
3. **Approval gate enforced:** User must type 'APPROVED' to continue
4. **Migration report saved:** .planning/phases/01-template-migration/01-MIGRATION-REPORT.md
5. **Post-approval instructions clear:** Steps to commit and delete migration code
6. **No validation errors:** All frontmatter corrections pass official specs

## Success Criteria

- [ ] scripts/lib/interactive-review.js exists with review UI
- [ ] Migration script shows comprehensive summary
- [ ] Validation report shows all corrections and any issues
- [ ] Interactive review allows browsing skills, agents, shared directory
- [ ] External diff viewer opens for before/after comparison
- [ ] Approval gate blocks until user types 'APPROVED'
- [ ] Migration report saved to phase directory
- [ ] Post-approval, migration code can be committed and deleted
- [ ] templates/ directory becomes permanent source of truth
- [ ] No validation errors block migration

## Output

**ONE-TIME migration complete** with manual validation. After user approval:
1. Migration code committed to git
2. Migration code deleted from working tree (preserved in history only)
3. templates/ becomes permanent source of truth
4. Ready for Phase 2 (installation foundation)
