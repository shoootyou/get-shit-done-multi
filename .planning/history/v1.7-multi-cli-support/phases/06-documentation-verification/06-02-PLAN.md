---
phase: 06-documentation-verification
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - lib-ghcc/verification/diagnostic-test.js
  - lib-ghcc/verification/cli-detector.js
  - lib-ghcc/verification/command-verifier.js
  - lib-ghcc/verification/agent-verifier.js
  - lib-ghcc/verification/diagnostic-runner.js
  - commands/gsd/verify-installation.md
autonomous: true

must_haves:
  truths:
    - "User can run /gsd:verify-installation and see CLI detection status"
    - "Verification shows which commands are available in current CLI"
    - "Verification shows which agents work in current CLI"
    - "Each diagnostic test shows pass/fail/warn status with icons"
    - "Failed tests include actionable fix suggestions"
  artifacts:
    - path: "lib-ghcc/verification/diagnostic-test.js"
      provides: "Base DiagnosticTest class and test runner framework"
      min_lines: 60
      exports: ["DiagnosticTest", "runDiagnostics"]
    - path: "lib-ghcc/verification/cli-detector.js"
      provides: "Detect which CLIs are installed and GSD-enabled"
      min_lines: 80
      exports: ["CLIInstalledTest", "SkillRegisteredTest"]
    - path: "lib-ghcc/verification/command-verifier.js"
      provides: "Verify GSD commands are accessible"
      min_lines: 50
      exports: ["CommandAvailableTest"]
    - path: "lib-ghcc/verification/agent-verifier.js"
      provides: "Verify agent compatibility for current CLI"
      min_lines: 60
      exports: ["AgentCapabilityTest"]
    - path: "commands/gsd/verify-installation.md"
      provides: "/gsd:verify-installation command definition"
      contains: "Run comprehensive installation verification"
  key_links:
    - from: "commands/gsd/verify-installation.md"
      to: "lib-ghcc/verification/diagnostic-runner.js"
      via: "require() and call runDiagnostics()"
      pattern: "runDiagnostics"
    - from: "lib-ghcc/verification/diagnostic-runner.js"
      to: "lib-ghcc/verification/*-verifier.js"
      via: "instantiate and run test classes"
      pattern: "new.*Test\\("
---

<objective>
Create comprehensive verification system using "doctor" pattern with modular diagnostic tests for CLI detection, command availability, and agent compatibility.

Purpose: Enable users to verify GSD installation works correctly, troubleshoot issues, and understand which features are available in their CLI. Satisfies success criteria #4 from Phase 6.
Output: Verification command that runs diagnostic tests and provides clear pass/fail/warn status with fix suggestions.
</objective>

<execution_context>
@.github/skills/get-shit-done/get-shit-done/workflows/execute-plan.md
@.github/skills/get-shit-done/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-documentation-verification/06-RESEARCH.md

# Existing infrastructure to leverage
@lib-ghcc/detect.js
@bin/lib/orchestration/capability-matrix.js
@bin/lib/command-system/registry.js
</context>

<tasks>

<task type="auto">
  <name>Create diagnostic test framework</name>
  <files>lib-ghcc/verification/diagnostic-test.js, lib-ghcc/verification/diagnostic-runner.js</files>
  <action>
Create modular diagnostic test framework following research Pattern 2: CLI Verification "Doctor" Pattern.

**diagnostic-test.js:**
Export base DiagnosticTest class:
```javascript
class DiagnosticTest {
  constructor(name, description) {
    this.name = name;
    this.description = description;
  }
  
  async run() {
    // Return: { status: 'pass'|'fail'|'warn', message: string, fixes: string[] }
    throw new Error('Must implement run()');
  }
}
```

**diagnostic-runner.js:**
Export runDiagnostics(tests) function:
- Iterate through test array
- Call test.run() for each
- Format output with icons: ✓ (pass), ✗ (fail), ⚠ (warn)
- Print fix suggestions for failed tests
- Return summary: { passed: N, failed: N, warned: N, results: [] }

Use child_process.spawn for CLI checks, zero npm dependencies.
Follow Salesforce CLI doctor pattern from research.
  </action>
  <verify>
```bash
node -e "const { DiagnosticTest, runDiagnostics } = require('./lib-ghcc/verification/diagnostic-test'); console.log(DiagnosticTest && runDiagnostics ? 'PASS' : 'FAIL')"
```
  </verify>
  <done>DiagnosticTest base class and runDiagnostics() runner exist, exports work, framework ready for concrete test implementations</done>
</task>

<task type="auto">
  <name>Create CLI detection and command verification tests</name>
  <files>lib-ghcc/verification/cli-detector.js, lib-ghcc/verification/command-verifier.js</files>
  <action>
Create concrete diagnostic tests for CLI detection and command availability.

**cli-detector.js:**
Export CLIInstalledTest and SkillRegisteredTest classes extending DiagnosticTest.

CLIInstalledTest:
- Check if CLI executable exists: spawn(cliCommand, ['--version'], {timeout: 5000})
- Status: pass if exit code 0, fail if not found
- Fixes: ["Install ${cli} from ${url}"]

SkillRegisteredTest:
- Check if GSD skill directory exists (use lib-ghcc/detect.js getConfigPaths)
- Check if SKILL.md or prompts exist
- Status: pass if registered, warn if installed but not registered, fail if not installed
- Fixes: ["Run npx get-shit-done-cc --${cli}", "Run ${cli} skill reload"]

**command-verifier.js:**
Export CommandAvailableTest class.

CommandAvailableTest:
- Load command registry (bin/lib/command-system/registry.js)
- Check if all 24 GSD commands are registered
- Status: pass if all available, warn if some missing, fail if none
- Fixes: ["Run npx get-shit-done-cc --${cli} to reinstall", "Check ${cli} skill/prompt directory"]

Use fs.existsSync, child_process.spawn, zero npm dependencies.
Follow research: CLI availability checking pattern.
  </action>
  <verify>
```bash
node -e "const { CLIInstalledTest, SkillRegisteredTest } = require('./lib-ghcc/verification/cli-detector'); const { CommandAvailableTest } = require('./lib-ghcc/verification/command-verifier'); console.log(CLIInstalledTest && CommandAvailableTest ? 'PASS' : 'FAIL')"
```
  </verify>
  <done>CLIInstalledTest, SkillRegisteredTest, CommandAvailableTest classes exist, extend DiagnosticTest, implement run() with status and fixes</done>
</task>

<task type="auto">
  <name>Create agent verification and wire verification command</name>
  <files>lib-ghcc/verification/agent-verifier.js, commands/gsd/verify-installation.md</files>
  <action>
Create agent capability test and wire into /gsd:verify-installation command.

**agent-verifier.js:**
Export AgentCapabilityTest class extending DiagnosticTest.

AgentCapabilityTest:
- Load capability matrix (bin/lib/orchestration/capability-matrix.js)
- Detect current CLI (lib-ghcc/detect.js detectCLI())
- Check agent support level for current CLI
- Status: pass if full, warn if partial, fail if unsupported
- Include notes from capability matrix in message
- Fixes: ["Use ${otherCLI} for this agent", "See docs/agent-capabilities.md"]

**verify-installation.md:**
Create command frontmatter:
```yaml
---
name: verify-installation
category: setup
description: Run comprehensive installation verification
arguments: []
examples:
  - "/gsd:verify-installation"
---
```

Command prompt:
```javascript
const { runDiagnostics } = require('../../lib-ghcc/verification/diagnostic-runner');
const { CLIInstalledTest, SkillRegisteredTest } = require('../../lib-ghcc/verification/cli-detector');
const { CommandAvailableTest } = require('../../lib-ghcc/verification/command-verifier');
const { AgentCapabilityTest } = require('../../lib-ghcc/verification/agent-verifier');

const tests = [
  new CLIInstalledTest('Claude Code', 'claude'),
  new CLIInstalledTest('Copilot CLI', 'gh-copilot'),
  new CLIInstalledTest('Codex CLI', 'codex'),
  new SkillRegisteredTest('Current CLI'),
  new CommandAvailableTest(),
  new AgentCapabilityTest('gsd-executor'),
  new AgentCapabilityTest('gsd-planner'),
  // ... other agents
];

runDiagnostics(tests).then(summary => {
  console.log(`\n✓ ${summary.passed} passed`);
  console.log(`⚠ ${summary.warned} warnings`);
  console.log(`✗ ${summary.failed} failed`);
});
```

Follow research: Verification pattern with specific failure modes and fix suggestions.
  </action>
  <verify>
```bash
# Verify command file exists and has correct structure
grep -q "name: verify-installation" commands/gsd/verify-installation.md && \
grep -q "runDiagnostics" commands/gsd/verify-installation.md && \
echo "PASS" || echo "FAIL"
```
  </verify>
  <done>/gsd:verify-installation command exists, runs all diagnostic tests, shows pass/fail/warn with icons and fix suggestions, INSTALL-08 requirement satisfied</done>
</task>

</tasks>

<verification>
Run verification command manually:
```bash
# Load and execute command (simulated - AI agent will actually run it)
node -e "const verify = require('./commands/gsd/verify-installation.md'); // Execute verification"
```

Check test framework works:
```bash
# Test that diagnostic tests can be instantiated and run
node -e "
const { CLIInstalledTest } = require('./lib-ghcc/verification/cli-detector');
const test = new CLIInstalledTest('Test CLI', 'test-cli');
test.run().then(result => console.log(result.status ? 'PASS' : 'FAIL'));
"
```
</verification>

<success_criteria>
- [ ] DiagnosticTest base class exists with run() interface
- [ ] runDiagnostics() executes tests and formats output with icons
- [ ] CLIInstalledTest detects if CLI executables are installed
- [ ] SkillRegisteredTest verifies GSD skill/prompt registration
- [ ] CommandAvailableTest checks all 24 GSD commands are accessible
- [ ] AgentCapabilityTest checks agent support for current CLI
- [ ] /gsd:verify-installation command integrates all tests
- [ ] Verification output includes pass/fail/warn status for each test
- [ ] Failed tests show actionable fix suggestions
- [ ] All verification uses Node.js built-ins only (zero dependencies)
- [ ] INSTALL-08 requirement satisfied: Post-install verification confirms commands accessible
</success_criteria>

<output>
After completion, create `.planning/phases/06-documentation-verification/06-02-SUMMARY.md`
</output>
