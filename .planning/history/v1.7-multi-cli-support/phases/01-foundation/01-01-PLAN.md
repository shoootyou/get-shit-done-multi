---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bin/lib/paths.js
  - bin/lib/detect.js
autonomous: true

must_haves:
  truths:
    - "Developer gets correct CLI config paths for all three CLIs on any platform"
    - "Installer can detect which CLIs are currently installed"
  artifacts:
    - path: "bin/lib/paths.js"
      provides: "Cross-platform path utilities"
      exports: ["getConfigPaths", "expandTilde", "ensureDirExists"]
      min_lines: 80
    - path: "bin/lib/detect.js"
      provides: "CLI installation detection"
      exports: ["detectInstalledCLIs", "getDetectedCLIsMessage"]
      min_lines: 60
  key_links:
    - from: "bin/lib/detect.js"
      to: "bin/lib/paths.js"
      via: "require('./paths')"
      pattern: "const.*=.*require\\(['\"]\\./paths['\"]\\)"
---

<objective>
Create foundational utility modules for cross-platform path handling and CLI detection.

Purpose: Establish reliable, tested path utilities and CLI detection logic that all subsequent installation code will depend on. These modules must work identically on Mac, Windows, and Linux without string concatenation or hardcoded separators.

Output: Two new modules (`lib/paths.js`, `lib/detect.js`) providing path utilities and CLI detection capabilities.
</objective>

<execution_context>
@.github/skills/get-shit-done/workflows/execute-plan.md
@.github/skills/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/codebase/STACK.md
@.planning/codebase/ARCHITECTURE.md
@bin/install.js
</context>

<tasks>

<task type="auto">
  <name>Create path utilities module</name>
  <files>bin/lib/paths.js</files>
  <action>
Create `bin/lib/paths.js` with Node.js built-in modules only (no npm dependencies). Implement:

1. **getConfigPaths(cli)** - Returns {global, local} paths for 'claude', 'copilot', 'codex'
   - Use `os.homedir()` for home directory (NOT process.env.HOME)
   - Use `path.join()` for ALL path construction (NO string concatenation with `/` or `\\`)
   - Claude global: `path.join(home, '.claude')`
   - Claude local: `path.join(process.cwd(), '.claude')`
   - Copilot global: `path.join(home, '.config', 'github-copilot-cli')`
   - Copilot local: `path.join(process.cwd(), '.github')`
   - Codex global: `path.join(home, '.codex')`
   - Codex local: `path.join(process.cwd(), '.codex')`

2. **expandTilde(filePath)** - Expands `~/` to home directory
   - Check if path starts with `~/`
   - Replace with `path.join(os.homedir(), filePath.slice(2))`
   - Return unchanged if no tilde

3. **ensureDirExists(dirPath)** - Creates directory with parents, idempotent
   - Use `fs.mkdirSync(dirPath, {recursive: true})`
   - Wrap in try-catch, return true/false for success

Follow research patterns from 01-RESEARCH.md Pattern 1, 3, and 4. Add JSDoc comments for each function.
  </action>
  <verify>
Run `node -e "const p = require('./bin/lib/paths'); console.log(JSON.stringify(p.getConfigPaths('codex'), null, 2))"`

Expected output contains `.codex` path without hardcoded separators.
  </verify>
  <done>
- `bin/lib/paths.js` exists
- Exports getConfigPaths, expandTilde, ensureDirExists
- All path operations use path.join(), no string concatenation
- Functions have JSDoc comments
  </done>
</task>

<task type="auto">
  <name>Create CLI detection module</name>
  <files>bin/lib/detect.js</files>
  <action>
Create `bin/lib/detect.js` using Node.js built-ins and `lib/paths.js`. Implement:

1. **detectInstalledCLIs()** - Returns {claude: bool, copilot: bool, codex: bool}
   - Import getConfigPaths from './paths'
   - For each CLI, get global path via getConfigPaths(cli).global
   - Check if directory exists with `fs.existsSync(globalPath)`
   - Return object with true/false for each CLI

2. **getDetectedCLIsMessage(detected)** - Returns human-readable message
   - Takes detected object from detectInstalledCLIs()
   - Returns string like "Detected: Claude Code, Codex CLI" or "No CLIs detected"
   - Format with checkmarks: "✓ Claude Code" for installed, "✗ Codex CLI" for not installed

Follow research Pattern 6 from 01-RESEARCH.md. Add JSDoc comments. Module must work on all platforms (Mac/Windows/Linux).
  </action>
  <verify>
Run `node -e "const d = require('./bin/lib/detect'); console.log(d.detectInstalledCLIs()); console.log(d.getDetectedCLIsMessage(d.detectInstalledCLIs()))"`

Should show detected CLIs on current system without errors.
  </verify>
  <done>
- `bin/lib/detect.js` exists
- Exports detectInstalledCLIs, getDetectedCLIsMessage
- Imports and uses lib/paths.js correctly
- Detection logic checks standard config directories
- Functions have JSDoc comments
  </done>
</task>

</tasks>

<verification>
1. Both modules export expected functions
2. All path operations use path.join() (no `/` or `\\` in code)
3. Detection works on current platform
4. No npm dependencies used (only Node.js built-ins)
</verification>

<success_criteria>
- `bin/lib/paths.js` and `bin/lib/detect.js` created
- Path utilities return platform-appropriate paths using path.join()
- CLI detection correctly identifies installed CLIs
- Zero npm dependencies, only Node.js built-ins
- Code follows research patterns from 01-RESEARCH.md
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md` following the summary template.
</output>
