---
phase: 01-foundation
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Codex CLI installation completes successfully on Mac"
    - "CLI detection correctly identifies installed CLIs"
    - "Path handling uses platform-appropriate separators"
    - "Installation produces clear success message"
  artifacts: []
  key_links:
    - from: "bin/install.js"
      to: "bin/lib/detect.js"
      via: "CLI detection called during install"
      pattern: "detectInstalledCLIs\\(\\)"
---

<objective>
Verify cross-platform installation infrastructure works correctly through comprehensive testing.

Purpose: Ensure the foundation modules (paths, detection, installation, upgrades) work reliably on the current platform and handle edge cases gracefully. This verification catches integration issues before Phase 2 builds on this foundation.

Output: Verified installation system with documented test results confirming all installation scenarios work correctly.
</objective>

<execution_context>
@.github/skills/get-shit-done/workflows/execute-plan.md
@.github/skills/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@bin/install.js
@bin/lib/paths.js
@bin/lib/detect.js
@bin/lib/upgrade.js
</context>

<tasks>

<task type="auto">
  <name>Automated installation testing</name>
  <files>None (testing only)</files>
  <action>
Run comprehensive automated tests of the installation system:

1. **Test path utilities**
   ```bash
   node -e "const p = require('./bin/lib/paths'); \
     console.log('Codex global:', p.getConfigPaths('codex').global); \
     console.log('Codex local:', p.getConfigPaths('codex').local); \
     console.log('Expand tilde:', p.expandTilde('~/.codex')); \
     console.log('Current platform paths use platform separator');"
   ```
   Verify: Paths use correct separator for current platform (no mixed `/` and `\\`)

2. **Test CLI detection**
   ```bash
   node -e "const d = require('./bin/lib/detect'); \
     const detected = d.detectInstalledCLIs(); \
     console.log('Detected CLIs:', detected); \
     console.log('Message:', d.getDetectedCLIsMessage(detected));"
   ```
   Verify: Detection correctly identifies installed CLIs on current system

3. **Test upgrade module**
   ```bash
   node -e "const u = require('./bin/lib/upgrade'); \
     console.log('Functions exported:', Object.keys(u));"
   ```
   Verify: All three functions exported (preserveUserData, restoreUserData, cleanOrphanedFiles)

4. **Test installer help**
   ```bash
   node bin/install.js --help
   ```
   Verify: Help text includes --codex, --codex-global options with descriptions

5. **Test dry-run installation** (create test directory first)
   ```bash
   mkdir -p /tmp/gsd-test-install
   cd /tmp/gsd-test-install
   node $OLDPWD/bin/install.js --codex
   ls -la .codex/skills/get-shit-done/
   cd $OLDPWD
   ```
   Verify: Files copied to `.codex/skills/get-shit-done/` without errors

Document all test results (what was tested, what passed, any issues found).
  </action>
  <verify>
All automated tests pass without errors. Test output logged and reviewed.
  </verify>
  <done>
- Path utilities work correctly on current platform
- CLI detection identifies installed CLIs
- Upgrade module functions are accessible
- Installer help displays Codex options
- Test installation completes successfully
- All tests documented
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete installation infrastructure for Codex CLI support:
- Cross-platform path utilities (bin/lib/paths.js)
- CLI auto-detection (bin/lib/detect.js)
- Codex installation support in installer (bin/install.js)
- Version upgrade module (bin/lib/upgrade.js)
  </what-built>
  <how-to-verify>
**Test installation scenarios:**

1. **View help text:**
   ```bash
   node bin/install.js --help
   ```
   ✓ Confirm --codex and --codex-global options are documented with clear descriptions

2. **Check CLI detection:**
   ```bash
   node -e "const d = require('./bin/lib/detect'); console.log(d.getDetectedCLIsMessage(d.detectInstalledCLIs()))"
   ```
   ✓ Verify it correctly identifies which CLIs are installed on your system

3. **Test local Codex installation:**
   ```bash
   # In a test directory
   mkdir -p /tmp/gsd-codex-test && cd /tmp/gsd-codex-test
   node /path/to/get-shit-done/bin/install.js --codex
   ls -la .codex/skills/get-shit-done/
   ```
   ✓ Confirm files are installed to `.codex/skills/get-shit-done/` directory
   ✓ Confirm success message is clear and includes next steps
   ✓ Confirm no error messages or warnings

4. **Verify path handling:**
   ```bash
   node -e "const p = require('./bin/lib/paths'); console.log(JSON.stringify(p.getConfigPaths('codex'), null, 2))"
   ```
   ✓ Paths use platform-appropriate separators (not mixed `/` and `\\`)
   ✓ Home directory correctly resolved

5. **Code review:**
   - Open `bin/install.js` and search for `/` or `\\` in string concatenation
   - ✓ Confirm all path construction uses `path.join()`, not string concatenation
   - Open `bin/lib/paths.js` and `bin/lib/detect.js`
   - ✓ Confirm no hardcoded path separators

**Expected results:**
- All commands run without errors
- Paths are platform-appropriate
- CLI detection works correctly
- Installation completes with clear messaging
- Code uses path.join() consistently

**If any test fails:** Describe what failed and what error appeared. Include full error message if available.
  </how-to-verify>
  <resume-signal>
Type "approved" if all verification steps pass and installation works correctly.

If issues found, describe them in detail (which test, what failed, exact error message) so they can be fixed before proceeding.
  </resume-signal>
</task>

</tasks>

<verification>
1. All automated tests pass
2. Manual verification confirms installation works
3. CLI detection works correctly
4. Path handling is cross-platform safe
5. No hardcoded path separators in code
</verification>

<success_criteria>
- Automated tests confirm all modules work correctly
- Manual testing verifies installation completes successfully
- CLI detection correctly identifies installed CLIs
- All path operations use path.join() consistently
- Clear success messaging displayed after installation
- No errors or warnings during installation
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md` following the summary template.

Include test results in summary:
- What was tested (automated and manual)
- What passed/failed
- Any edge cases discovered
- Platform tested on (Mac/Windows/Linux)
</output>
