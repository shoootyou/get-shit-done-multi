---
phase: 06-orchestration-validation
plan: 03
type: execute
wave: 3
depends_on: [06-01, 06-02]
files_modified:
  - bin/lib/orchestration/orchestration-test-suite.js
  - bin/lib/orchestration/test-scenarios/parallel-spawning.json
  - bin/lib/orchestration/test-scenarios/sequential-spawning.json
  - bin/lib/orchestration/test-scenarios/structured-returns.json
  - bin/lib/orchestration/test-scenarios/reference-resolution.json
  - .planning/phases/06-orchestration-validation/06-VALIDATION-REPORT.md
autonomous: true
must_haves:
  - Integration test suite exists that runs all 4 validators (structured returns, parallel spawn, sequential spawn, reference resolution)
  - Test scenarios cover 3 high-complexity orchestrators (new-project, new-milestone, execute-phase)
  - Test scenarios validate 2 mid-complexity commands (research-phase, plan-phase)
  - Validation report documents pass/fail status for each orchestration pattern
  - Report includes specific issues found and recommendations for fixes
---

# Phase 6, Plan 3: Integration Suite + Report

## Objective

Create comprehensive orchestration validation test suite that runs all validators from Plans 1-2 against real commands, generates detailed report documenting orchestration pattern health across the 29 migrated GSD commands.

## Context

**From RESEARCH.md:**
- High-complexity orchestrators to test: gsd-new-project, gsd-new-milestone, gsd-execute-phase
- Mid-complexity commands: gsd-research-phase, gsd-plan-phase, gsd-debug, gsd-map-codebase
- Validation dimensions: structured returns, parallel spawning, sequential spawning, @-references

**Wave 3 scope:** Integrate all validators, create test scenarios, run comprehensive validation, generate report.

**Dependencies:** Plans 1-2 provide all 4 validation modules.

**Completion:** This plan completes Phase 6, report feeds into Phase 7 (multi-platform testing).

## Tasks

<task name="create-test-scenarios" type="auto">
  <files>
    bin/lib/orchestration/test-scenarios/parallel-spawning.json
    bin/lib/orchestration/test-scenarios/sequential-spawning.json
    bin/lib/orchestration/test-scenarios/structured-returns.json
    bin/lib/orchestration/test-scenarios/reference-resolution.json
  </files>
  <action>
Create JSON test scenario files for each orchestration pattern.

**parallel-spawning.json:**
```json
{
  "scenarios": [
    {
      "name": "gsd-new-project parallel spawning",
      "command": "gsd-new-project",
      "expectedAgents": [
        "gsd-project-researcher:stack",
        "gsd-project-researcher:features", 
        "gsd-project-researcher:architecture",
        "gsd-project-researcher:pitfalls"
      ],
      "testPrompt": "Create project: Todo app with React",
      "minParallelism": 0.7
    },
    {
      "name": "gsd-new-milestone parallel spawning",
      "command": "gsd-new-milestone",
      "expectedAgents": [
        "gsd-project-researcher:requirements",
        "gsd-project-researcher:constraints"
      ],
      "testPrompt": "Create milestone: User authentication",
      "minParallelism": 0.7
    }
  ]
}
```

**sequential-spawning.json:**
```json
{
  "scenarios": [
    {
      "name": "gsd-research-phase checkpoint continuation",
      "command": "gsd-research-phase",
      "checkpointPattern": ".continue-here.md",
      "expectedRespawn": true,
      "testPrompt": "Research phase 1"
    },
    {
      "name": "gsd-plan-phase with verification loop",
      "command": "gsd-plan-phase",
      "checkpointPattern": "PLAN.md",
      "expectedRespawn": false,
      "testPrompt": "Plan phase 1"
    }
  ]
}
```

**structured-returns.json:**
```json
{
  "scenarios": [
    {
      "name": "gsd-phase-researcher return format",
      "command": "gsd-phase-researcher",
      "expectedStatus": "research_complete",
      "expectedHeaders": ["## RESEARCH COMPLETE"],
      "requiredFields": ["Phase:", "Confidence:", "File Created:"]
    },
    {
      "name": "gsd-planner return format",
      "command": "gsd-planner",
      "expectedStatus": "plan_complete",
      "expectedHeaders": ["## PLANNING COMPLETE"],
      "requiredFields": ["Plans:", "Wave Structure:", "Next Steps:"]
    },
    {
      "name": "gsd-executor return format",
      "command": "gsd-executor",
      "expectedStatus": "execution_complete",
      "expectedHeaders": ["## EXECUTION COMPLETE"],
      "requiredFields": ["Plan:", "Tasks:", "Status:"]
    }
  ]
}
```

**reference-resolution.json:**
```json
{
  "scenarios": [
    {
      "name": "gsd-execute-phase @-references",
      "command": "gsd-execute-phase",
      "expectedReferences": [
        "@.planning/STATE.md",
        "@.planning/ROADMAP.md",
        "@{plan_path}"
      ],
      "variableSubstitution": {
        "plan_path": ".planning/phases/01-foundation/01-01-PLAN.md"
      }
    },
    {
      "name": "gsd-new-project @-references",
      "command": "gsd-new-project",
      "expectedReferences": [
        "@.planning/STATE.md",
        "@specs/skills/_shared.yml"
      ],
      "variableSubstitution": {}
    }
  ]
}
```

**Format:** JSON for easy parsing, human-readable structure, extensible for Phase 7.
  </action>
  <verify>
```bash
# Validate JSON syntax
for file in \
  bin/lib/orchestration/test-scenarios/parallel-spawning.json \
  bin/lib/orchestration/test-scenarios/sequential-spawning.json \
  bin/lib/orchestration/test-scenarios/structured-returns.json \
  bin/lib/orchestration/test-scenarios/reference-resolution.json; do
  
  echo "Validating $file..."
  if ! node -e "JSON.parse(require('fs').readFileSync('$file', 'utf8'))"; then
    echo "ERROR: Invalid JSON in $file"
    exit 1
  fi
done

echo "✓ All test scenarios valid JSON"
```
  </verify>
  <done>
Test scenario files exist with structured test cases for all 4 orchestration patterns.
  </done>
</task>

<task name="create-integration-test-suite" type="auto">
  <files>bin/lib/orchestration/orchestration-test-suite.js</files>
  <action>
Create integration test suite that orchestrates all validators and generates report.

**Main function: runOrchestrationValidation(options)**

Input: 
- options.scenarios: Array of scenario file paths (default: all 4)
- options.outputReport: Path for validation report (default: .planning/phases/06-orchestration-validation/06-VALIDATION-REPORT.md)

Output: Object with { totalTests: number, passed: number, failed: number, results: array }

**Logic:**
1. Load all test scenarios from JSON files
2. For each scenario:
   - Run appropriate validator (parallel-spawn, sequential-spawn, structured-return, reference-resolver)
   - Capture result (pass/fail, timing, errors)
   - Log progress to console
3. Aggregate results
4. Generate markdown report
5. Return summary object

**Report structure:**
```markdown
# Phase 6: Orchestration Validation Report

**Generated:** {timestamp}
**Total Tests:** {total}
**Passed:** {passed} ✓
**Failed:** {failed} ✗

## Summary by Pattern

### Parallel Spawning ({X}/{Y} passed)
- ✓ gsd-new-project parallel spawning (4 agents, 2.3s, 85% parallel)
- ✗ gsd-new-milestone parallel spawning (expected 2 agents, found 1)

### Sequential Spawning ({X}/{Y} passed)
...

### Structured Returns ({X}/{Y} passed)
...

### Reference Resolution ({X}/{Y} passed)
...

## Issues Found

| Priority | Pattern | Command | Issue | Recommendation |
|----------|---------|---------|-------|----------------|
| HIGH | parallel | gsd-new-milestone | Only 1 of 2 agents spawned | Check Task() calls in SKILL.md |
| MEDIUM | reference | gsd-execute-phase | @{plan_path} not resolved | Add variable interpolation before @ resolution |

## Recommendations

1. **High priority:** Fix gsd-new-milestone parallel spawning
2. **Medium priority:** Add variable interpolation to gsd-execute-phase
3. **Low priority:** Standardize structured return format across agents

## Next Steps

Phase 7: Multi-platform testing with validated orchestration patterns.
```

**Integration:** Import validators from Plans 1-2:
```javascript
const structuredReturnParser = require('./structured-return-parser');
const parallelSpawnValidator = require('./parallel-spawn-validator');
const sequentialSpawnValidator = require('./sequential-spawn-validator');
const referenceResolver = require('./reference-resolver');
```

**Error handling:**
- Validator throws: Catch, log, mark test as failed
- Scenario load error: Skip scenario, log warning
- Report write error: Log to console, continue
  </action>
  <verify>
```bash
# Check module loads
node -e "
const suite = require('./bin/lib/orchestration/orchestration-test-suite');
console.assert(typeof suite.runOrchestrationValidation === 'function', 'Should export runOrchestrationValidation');
console.log('✓ Integration test suite module loaded');
"

# Dry run (will fully test in next task)
```
  </verify>
  <done>
Integration test suite exists, orchestrates all validators, generates comprehensive validation report.
  </done>
</task>

<task name="run-validation-suite" type="auto">
  <files>.planning/phases/06-orchestration-validation/06-VALIDATION-REPORT.md</files>
  <action>
Run orchestration validation suite and generate report.

**Steps:**
1. Execute integration test suite:
```bash
node bin/lib/orchestration/orchestration-test-suite.js
```

2. Capture output to .planning/phases/06-orchestration-validation/06-VALIDATION-REPORT.md

3. Review results:
   - Count pass/fail by pattern
   - Identify high-priority issues
   - Document recommendations

4. Log summary to console

**Expected output:**
- Report file with structured markdown
- Console output showing progress and summary
- Exit code 0 if all tests pass, 1 if any fail

**Manual validation points:**
- Review each failed test
- Verify error messages are actionable
- Check report formatting is correct
- Ensure recommendations are specific

**Note:** Some tests may fail if orchestration patterns have issues - this is expected and valuable feedback for Phase 7.
  </action>
  <verify>
```bash
# Check report was created
if [ ! -f .planning/phases/06-orchestration-validation/06-VALIDATION-REPORT.md ]; then
  echo "ERROR: Validation report not created"
  exit 1
fi

# Check report has required sections
for section in "Summary by Pattern" "Issues Found" "Recommendations"; do
  if ! grep -q "$section" .planning/phases/06-orchestration-validation/06-VALIDATION-REPORT.md; then
    echo "ERROR: Report missing section: $section"
    exit 1
  fi
done

# Display summary
echo "Validation Report Summary:"
grep -A 3 "^## Summary" .planning/phases/06-orchestration-validation/06-VALIDATION-REPORT.md

echo ""
echo "✓ Validation report generated"
```
  </verify>
  <done>
Validation suite executed, comprehensive report generated documenting orchestration pattern health.
  </done>
</task>

## Verification

After all tasks complete, verify:

```bash
# 1. Check all test scenario files exist
ls -l bin/lib/orchestration/test-scenarios/*.json

# 2. Validate JSON syntax
for f in bin/lib/orchestration/test-scenarios/*.json; do
  node -e "JSON.parse(require('fs').readFileSync('$f', 'utf8'))"
done

# 3. Run integration test suite
node bin/lib/orchestration/orchestration-test-suite.js

# 4. Review validation report
cat .planning/phases/06-orchestration-validation/06-VALIDATION-REPORT.md

# 5. Check summary statistics
grep "Total Tests:" .planning/phases/06-orchestration-validation/06-VALIDATION-REPORT.md
grep "Passed:" .planning/phases/06-orchestration-validation/06-VALIDATION-REPORT.md
grep "Failed:" .planning/phases/06-orchestration-validation/06-VALIDATION-REPORT.md
```

## Success Criteria

- [ ] 4 test scenario JSON files exist with valid syntax
- [ ] Integration test suite runs all validators
- [ ] Test suite covers 3 high-complexity orchestrators
- [ ] Test suite covers 2+ mid-complexity commands
- [ ] Validation report exists with structured markdown
- [ ] Report documents pass/fail by pattern
- [ ] Report includes specific issues and recommendations
- [ ] Phase 6 goal achieved: Orchestration patterns validated

## Output

Complete orchestration validation infrastructure:
1. **Test scenarios** - 4 JSON files defining test cases
2. **Integration suite** - orchestration-test-suite.js coordinating validators
3. **Validation report** - 06-VALIDATION-REPORT.md documenting results

**Report feeds into:** Phase 7 (Multi-Platform Testing) - validates orchestration works across Claude/Copilot/Codex.

**Phase 6 Complete** - Orchestration patterns validated, ready for multi-platform deployment.
