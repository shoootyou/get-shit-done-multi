---
phase: 3.5
plan: "03.5-02"
title: "Standalone Validation Script"
type: implementation
autonomous: true
priority: HIGH
estimated_duration: 25 min
parent_phase: 3
wave: 2
---

# Plan 03.5-02: Standalone Validation Script

## Objective

Create `scripts/validate-installation.js` - a standalone script that users can run to verify their GSD installation is correct, independent of the install process.

## Requirements

**Must Have:**
- Accept path as CLI argument or use cwd
- Check for expected skills
- Validate SKILL.md files exist and are non-empty
- Validate folder structure (gsd-*/SKILL.md)
- Clear pass/fail output
- Exit codes for CI/CD

**Should Have:**
- Check agents installation
- Validate frontmatter structure
- Check for legacy skill
- Detailed error messages

**Nice to Have:**
- Fix suggestions
- JSON output mode
- Verbose mode

## Script Specification

```javascript
#!/usr/bin/env node
/**
 * Validate GSD installation
 * Usage: scripts/validate-installation.js [path] [--platform copilot|claude|codex]
 */

const fs = require('fs');
const path = require('path');

// Expected skills for each platform
const EXPECTED_SKILLS = {
  copilot: ['gsd-help', 'gsd-execute-phase', 'gsd-new-project', 'gsd-new-milestone'],
  claude: ['gsd-help', 'gsd-execute-phase', 'gsd-new-project', 'gsd-new-milestone'],
  codex: ['gsd-help', 'gsd-execute-phase', 'gsd-new-project', 'gsd-new-milestone']
};

// Platform-specific paths
const PLATFORM_PATHS = {
  copilot: { skills: '.github/skills', agents: '.github/agents' },
  claude: { skills: '.claude/skills', agents: '.claude/agents' },
  codex: { skills: '.codex/skills', agents: '.codex/agents' }
};

function validateInstallation(basePath, platform) {
  const results = {
    success: true,
    checks: [],
    errors: [],
    warnings: []
  };
  
  const paths = PLATFORM_PATHS[platform];
  const skillsDir = path.join(basePath, paths.skills);
  const agentsDir = path.join(basePath, paths.agents);
  
  // Check 1: Skills directory exists
  if (!fs.existsSync(skillsDir)) {
    results.success = false;
    results.errors.push(`Skills directory not found: ${skillsDir}`);
    return results;
  }
  results.checks.push({ name: 'Skills directory exists', status: 'pass' });
  
  // Check 2: Expected skills present
  const expectedSkills = EXPECTED_SKILLS[platform];
  const missingSkills = [];
  const foundSkills = [];
  
  for (const skillName of expectedSkills) {
    const skillPath = path.join(skillsDir, skillName, 'SKILL.md');
    if (fs.existsSync(skillPath)) {
      const stats = fs.statSync(skillPath);
      if (stats.size > 0) {
        foundSkills.push(skillName);
        results.checks.push({ name: `Skill: ${skillName}`, status: 'pass', size: stats.size });
      } else {
        results.success = false;
        results.errors.push(`Skill file is empty: ${skillName}/SKILL.md`);
      }
    } else {
      missingSkills.push(skillName);
      results.success = false;
      results.errors.push(`Skill not found: ${skillName}/SKILL.md`);
    }
  }
  
  // Check 3: Agents directory exists
  if (fs.existsSync(agentsDir)) {
    const agentFiles = fs.readdirSync(agentsDir).filter(f => f.endsWith('.agent.md'));
    results.checks.push({ name: `Agents installed`, status: 'pass', count: agentFiles.length });
  } else {
    results.warnings.push(`Agents directory not found: ${agentsDir}`);
  }
  
  // Check 4: Legacy skill exists (for Copilot)
  if (platform === 'copilot') {
    const legacyPath = path.join(skillsDir, 'get-shit-done', 'SKILL.md');
    if (fs.existsSync(legacyPath)) {
      results.checks.push({ name: 'Legacy skill (get-shit-done)', status: 'pass' });
    } else {
      results.warnings.push('Legacy skill not found (non-critical)');
    }
  }
  
  return results;
}

// CLI execution
if (require.main === module) {
  const args = process.argv.slice(2);
  const targetPath = args[0] || process.cwd();
  const platform = args.includes('--platform') 
    ? args[args.indexOf('--platform') + 1] 
    : 'copilot';
  
  console.log(`Validating ${platform} installation at: ${targetPath}\n`);
  
  const results = validateInstallation(targetPath, platform);
  
  // Print results
  console.log('Checks:');
  results.checks.forEach(check => {
    const status = check.status === 'pass' ? '✓' : '✗';
    let msg = `  ${status} ${check.name}`;
    if (check.size) msg += ` (${(check.size / 1024).toFixed(1)} KB)`;
    if (check.count !== undefined) msg += ` (${check.count})`;
    console.log(msg);
  });
  
  if (results.errors.length > 0) {
    console.log('\nErrors:');
    results.errors.forEach(err => console.log(`  ✗ ${err}`));
  }
  
  if (results.warnings.length > 0) {
    console.log('\nWarnings:');
    results.warnings.forEach(warn => console.log(`  ⚠ ${warn}`));
  }
  
  if (results.success) {
    console.log(`\n✓ Installation valid`);
    process.exit(0);
  } else {
    console.log(`\n✗ Installation invalid`);
    process.exit(1);
  }
}

module.exports = { validateInstallation };
```

## Tasks

### Task 1: Create Validation Script
**File:** `scripts/validate-installation.js`  
**Content:** Full script as specified above

**Acceptance:**
- Script is executable (chmod +x)
- Accepts path argument
- Accepts --platform flag
- Returns proper exit codes

### Task 2: Add to package.json Scripts
**File:** `package.json`

**Add:**
```json
{
  "scripts": {
    "validate": "node scripts/validate-installation.js",
    "validate:copilot": "node scripts/validate-installation.js .github --platform copilot",
    "validate:claude": "node scripts/validate-installation.js .claude --platform claude",
    "validate:codex": "node scripts/validate-installation.js .codex --platform codex"
  }
}
```

**Acceptance:**
- Can run with `npm run validate`
- Platform-specific shortcuts work

### Task 3: Create Test Cases
**Action:** Test the validation script

**Test 1: Valid installation**
```bash
node scripts/validate-installation.js /tmp/gsd-test-correct --platform copilot
# Expected: All checks pass, exit 0
```

**Test 2: Missing skill**
```bash
# Setup: Create incomplete install
mkdir -p /tmp/test-incomplete/.github/skills/gsd-help
touch /tmp/test-incomplete/.github/skills/gsd-help/SKILL.md
# Test
node scripts/validate-installation.js /tmp/test-incomplete --platform copilot
# Expected: Errors for missing skills, exit 1
```

**Test 3: Empty SKILL.md**
```bash
# Setup
mkdir -p /tmp/test-empty/.github/skills/gsd-help
touch /tmp/test-empty/.github/skills/gsd-help/SKILL.md
# Test
node scripts/validate-installation.js /tmp/test-empty --platform copilot
# Expected: Error "Skill file is empty", exit 1
```

**Test 4: Current directory**
```bash
cd /workspace
node scripts/validate-installation.js
# Expected: Validates workspace .github/skills/, pass
```

### Task 4: Documentation
**File:** `scripts/README.md` (create if doesn't exist)

**Content:**
```markdown
# GSD Scripts

## validate-installation.js

Validates that GSD installation is correct and complete.

**Usage:**
```bash
# Validate current directory (default: copilot)
node scripts/validate-installation.js

# Validate specific path
node scripts/validate-installation.js /path/to/project

# Validate specific platform
node scripts/validate-installation.js /path --platform claude
node scripts/validate-installation.js /path --platform copilot
node scripts/validate-installation.js /path --platform codex
```

**Exit codes:**
- 0: Installation valid
- 1: Installation invalid (errors found)

**Example output:**
```
Validating copilot installation at: /workspace

Checks:
  ✓ Skills directory exists
  ✓ Skill: gsd-help (11.0 KB)
  ✓ Skill: gsd-execute-phase (8.5 KB)
  ✓ Skill: gsd-new-project (24.1 KB)
  ✓ Skill: gsd-new-milestone (19.3 KB)
  ✓ Agents installed (13)
  ✓ Legacy skill (get-shit-done)

✓ Installation valid
```
```

**Acceptance:**
- Documentation is clear
- Examples are accurate
- Exit codes documented

## Success Criteria

1. ✅ Script validates skills presence
2. ✅ Script validates file sizes (not empty)
3. ✅ Script checks agents installation
4. ✅ Script provides clear output
5. ✅ Script returns proper exit codes
6. ✅ Script works with all 3 platforms
7. ✅ Documentation complete

## Integration

**With install.js:**
After plan 03.5-01, install.js can call this for validation:
```javascript
const { validateInstallation } = require('../scripts/validate-installation.js');
const validation = validateInstallation(projectDir, 'copilot');
```

**With CI/CD:**
```yaml
- name: Validate installation
  run: node scripts/validate-installation.js --platform copilot
```

## Notes

- Standalone script can be used independently
- Useful for debugging user installations
- Can be integrated into install.js
- Provides foundation for automated testing
