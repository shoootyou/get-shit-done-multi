---
phase: 04.1-installation-quality-copilot-spec-compliance
plan: 02
subsystem: template-system
tags: [mustache, conditionals, platform-specific, tool-references]

# Dependency graph
requires:
  - phase: 03-01
    provides: Template system with Mustache rendering
provides:
  - Platform-specific tool references in agent prompt content
  - Mustache conditionals for Bash/execute and Grep/Glob/search tools
affects: [04.1-03, agent-generation, platform-compliance]

# Tech tracking
tech-stack:
  added: []
  patterns: [mustache-conditionals-for-prose, platform-specific-tool-naming]

key-files:
  created: []
  modified:
    - specs/agents/gsd-codebase-mapper.md
    - specs/agents/gsd-planner.md

key-decisions:
  - "Use Mustache conditionals in prose content for platform-specific tool references"
  - "Claude agents reference Bash/Grep/Glob tools"
  - "Copilot agents reference execute/search tools (search combines grep+glob)"

patterns-established:
  - "Platform conditionals in agent prompts: {{#isClaude}}Bash tool{{/isClaude}}{{#isCopilot}}execute tool{{/isCopilot}}"
  - "Tool reference clarity: Match PRIMARY aliases (Copilot search deduplicates grep+glob)"

# Metrics
duration: 3.6min
completed: 2026-01-22
---

# Phase 04.1 Plan 02: Update Tool References in Agent Prompts Summary

**Agent prompts now use Mustache conditionals for platform-specific tool names (Bash/execute, Grep/Glob/search) preventing Copilot user confusion**

## Performance

- **Duration:** 3.6 min (216 seconds)
- **Started:** 2026-01-22T09:37:01Z
- **Completed:** 2026-01-22T09:40:37Z
- **Tasks:** 3
- **Files modified:** 2 specs, 4 test outputs

## Accomplishments
- Added Mustache conditionals to 2 agent specs (gsd-codebase-mapper, gsd-planner)
- Claude versions reference "Bash tool", "Grep tool", "Glob tool"
- Copilot versions reference "execute tool", "search tool"
- Zero cross-contamination between platform-generated agents
- 100% verification pass rate (conditionals render correctly)

## Task Commits

Each task was committed atomically:

1. **Task 1: Update gsd-codebase-mapper prompts** - `df4f83d` (refactor)
2. **Task 2: Update gsd-planner prompts** - `76b3c62` (refactor)
3. **Task 3: Test conditional rendering** - `13b6b55` (test)

**Plan metadata:** [to be committed] (docs: complete plan)

## Files Created/Modified
- `specs/agents/gsd-codebase-mapper.md` - Added conditionals for tool exclusion verification section
- `specs/agents/gsd-planner.md` - Added conditionals for checkpoint anti-patterns examples
- `test-output/claude/agents/gsd-codebase-mapper.md` - Claude-specific rendering
- `test-output/copilot/agents/gsd-codebase-mapper.agent.md` - Copilot-specific rendering
- `test-output/claude/agents/gsd-planner.md` - Claude-specific rendering
- `test-output/copilot/agents/gsd-planner.agent.md` - Copilot-specific rendering

## Decisions Made

**1. Conditional placement strategy**
- **Decision:** Use block conditionals for multi-line sections, inline for single references
- **Rationale:** Block conditionals cleaner for lists (gsd-codebase-mapper lines 115-122), inline for prose (gsd-planner line 594)
- **Impact:** Maintains readability in specs while ensuring correct rendering

**2. Copilot search tool messaging**
- **Decision:** Note that "search tool" combines grep+glob functionality
- **Rationale:** Copilot dedups similar tools to PRIMARY alias, users need context that search covers both
- **Impact:** Prevents confusion when Copilot users see single tool instead of two

**3. Tool reference consistency**
- **Decision:** Always use "tool" suffix ("Bash tool" not just "Bash")
- **Rationale:** Matches GSD documentation style, clearer in prose
- **Impact:** Consistent phrasing across all agents

## Deviations from Plan

None - plan executed exactly as written.

All tasks completed:
- Task 1: gsd-codebase-mapper conditionals added (lines 115-122)
- Task 2: gsd-planner conditionals added (lines 594, 627-632)
- Task 3: Both agents generated and verified for both platforms

Verification results:
- Spec conditionals count: 2 pairs (gsd-codebase-mapper), 3 pairs (gsd-planner)
- Claude agents: Bash tool (1), Grep tool (1), Glob tool (1) - as expected
- Copilot agents: execute tool (1), search tool (2) - as expected
- Cross-contamination check: PASSED (no Bash in Copilot, no execute in Claude)

## Issues Encountered

None - template system worked as designed. Mustache conditionals rendered correctly on first attempt.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

**Ready for 04.1-03:** Installation workflow verification
- Template specs now have platform-specific tool references
- Generation tested and verified
- No warnings expected from tool reference naming

**Blocks cleared:**
- Copilot users will no longer see Claude-specific tool names
- Agent content matches available tools per platform

**For next plan:**
- Run full installation workflow
- Verify zero warnings from tool references
- Test both `--copilot` and default (Claude) generation

---
*Phase: 04.1-installation-quality-copilot-spec-compliance*
*Completed: 2026-01-22*
