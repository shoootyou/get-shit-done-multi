---
phase: 03-spec-migration-template-generation
plan: 06
type: execute
wave: 2
depends_on: ["03-04", "03-05"]
files_modified:
  - bin/lib/template-system/generate-samples.js
  - bin/lib/template-system/generate-validation-report.js
  - test-output/
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All 11 agents generated successfully for Claude platform"
    - "All agents that fit size limits generated for Copilot platform (9 expected)"
    - "Validation report shows format compliance for all generated agents"
    - "Generated agents have correct YAML format (fixed description and tools)"
    - "Generated agents have correct metadata structure per platform"
  artifacts:
    - path: "test-output/claude/*.md"
      provides: "11 Claude agent files with correct format"
      min_files: 11
    - path: "test-output/copilot/*.md"
      provides: "9 Copilot agent files (2 exceed size limit)"
      min_files: 9
    - path: "test-output/VALIDATION-REPORT.md"
      provides: "Complete validation report for all agents"
      contains: "Format Compliance"
  key_links:
    - from: "generate-samples.js"
      to: "generator.js"
      via: "generateAgent() calls"
      pattern: "generateAgent\\(.*\\)"
    - from: "generate-validation-report.js"
      to: "test-output/"
      via: "file system reads"
      pattern: "fs\\.readFile.*test-output"
---

<objective>
Generate all 11 agents for both platforms and create comprehensive validation report verifying format fixes.

Purpose: Prove that format issues are resolved across all agents, not just samples
Output: Complete test-output directory with all agents and validation report
</objective>

<execution_context>
@.github/skills/get-shit-done/get-shit-done/workflows/execute-plan.md
@.github/skills/get-shit-done/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/03-spec-migration-template-generation/03-VERIFICATION.md
@.planning/phases/03-spec-migration-template-generation/03-04-PLAN.md
@.planning/phases/03-spec-migration-template-generation/03-05-PLAN.md
@bin/lib/template-system/generate-samples.js
@bin/lib/template-system/generate-validation-report.js

## Gap Context

**Issue 6 - Missing test output (CRITICAL)**
- Current: Only 1 agent generated per platform in test-output/
- Expected: All 11 agents generated for validation
- Need: Complete validation report for all agents showing format compliance

## Current State

Currently only 2 sample agents:
- test-output/claude/gsd-planner.md
- test-output/copilot/gsd-verifier.md

## All 11 Agents to Generate

From specs/agents/ directory:
1. gsd-codebase-mapper.md
2. gsd-debugger.md (35KB - too large for Copilot)
3. gsd-executor.md
4. gsd-integration-checker.md
5. gsd-phase-researcher.md
6. gsd-plan-checker.md
7. gsd-planner.md (41KB - too large for Copilot)
8. gsd-project-researcher.md
9. gsd-research-synthesizer.md
10. gsd-roadmapper.md
11. gsd-verifier.md

**Expected output:**
- Claude: 11/11 agents (no size limit issues)
- Copilot: 9/11 agents (gsd-planner and gsd-debugger exceed 30K limit)

## Validation Report Requirements

The validation report must verify:
1. **Format Compliance:**
   - Description is single-line (no `>-` syntax)
   - Tools format matches platform (comma-separated for Claude, array for Copilot)
   - Metadata structure correct (none for Claude, nested for Copilot)

2. **Platform Requirements:**
   - Claude agents conform to Claude spec
   - Copilot agents conform to Copilot spec

3. **Size Limits:**
   - Document which agents exceed Copilot's 30K limit
   - Confirm all agents fit Claude's 200K limit

## Dependencies

This plan depends on:
- Plan 03-04: YAML format fixes (description and tools)
- Plan 03-05: Metadata structure fixes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update generate-samples.js to generate all 11 agents</name>
  <files>bin/lib/template-system/generate-samples.js</files>
  <action>
Modify generate-samples.js to generate ALL 11 agents instead of just samples:

1. **Replace agent list** with complete list:

```javascript
const AGENTS = [
  'gsd-codebase-mapper',
  'gsd-debugger',
  'gsd-executor',
  'gsd-integration-checker',
  'gsd-phase-researcher',
  'gsd-plan-checker',
  'gsd-planner',
  'gsd-project-researcher',
  'gsd-research-synthesizer',
  'gsd-roadmapper',
  'gsd-verifier'
];
```

2. **Update generation loop** to generate for both platforms:

```javascript
// Generate for both platforms
for (const platform of ['claude', 'copilot']) {
  console.log(`\n=== Generating ${platform} agents ===`);
  let successCount = 0;
  let failureCount = 0;
  
  for (const agentName of AGENTS) {
    const specPath = path.join(SPECS_DIR, `${agentName}.md`);
    const result = generateAgent(specPath, platform);
    
    if (result.success) {
      const outputPath = path.join(OUTPUT_DIR, platform, `${agentName}.md`);
      fs.writeFileSync(outputPath, result.output);
      console.log(`✓ ${agentName} (${result.output.length} chars)`);
      successCount++;
    } else {
      console.log(`✗ ${agentName} - ${result.errors[0].message}`);
      failureCount++;
    }
  }
  
  console.log(`\n${platform}: ${successCount} success, ${failureCount} failed`);
}
```

3. **Add size reporting:**

```javascript
// After generation, report sizes
console.log('\n=== Size Report ===');
const platforms = ['claude', 'copilot'];
for (const platform of platforms) {
  const dir = path.join(OUTPUT_DIR, platform);
  const files = fs.readdirSync(dir).filter(f => f.endsWith('.md'));
  
  console.log(`\n${platform}:`);
  for (const file of files) {
    const content = fs.readFileSync(path.join(dir, file), 'utf8');
    const sizeKB = (content.length / 1024).toFixed(1);
    const status = platform === 'copilot' && content.length > 30000 ? '⚠️ TOO LARGE' : '✓';
    console.log(`  ${status} ${file}: ${sizeKB}KB`);
  }
}
```

**Why this approach:**
- Generates complete set for validation
- Reports sizes to identify Copilot limit issues
- Clear success/failure reporting

**Do NOT:**
- Skip agents that failed before (format fixes should resolve issues)
- Filter out large agents (generate and report why they fail)
  </action>
  <verify>
Run the updated script:
```bash
cd bin/lib/template-system
rm -rf test-output/*
node generate-samples.js
```

Check output:
```bash
ls -lh test-output/claude/ | wc -l  # Should be 12 (11 files + total line)
ls -lh test-output/copilot/ | wc -l  # Should be 10 (9 files + total line)
```

Verify specific agents exist:
```bash
ls test-output/claude/gsd-*.md | wc -l  # Should be 11
ls test-output/copilot/gsd-*.md | wc -l  # Should be 9 (or 11 if gsd-planner, gsd-debugger generated)
```
  </verify>
  <done>
- generate-samples.js has complete agent list (11 agents)
- Script generates for both claude and copilot platforms
- test-output/claude/ contains 11 agent files
- test-output/copilot/ contains 9-11 agent files (some may fail size check)
- Console output shows success/failure count per platform
- Size report identifies agents exceeding limits
  </done>
</task>

<task type="auto">
  <name>Task 2: Update validation report to check format compliance</name>
  <files>bin/lib/template-system/generate-validation-report.js</files>
  <action>
Enhance generate-validation-report.js to verify format fixes:

1. **Add format validation function:**

```javascript
/**
 * Validate YAML frontmatter format
 * @param {string} content - Agent file content
 * @param {string} platform - Platform name ('claude' or 'copilot')
 * @returns {Object} Validation result
 */
function validateFormat(content, platform) {
  const issues = [];
  
  // Extract frontmatter
  const match = content.match(/^---\n([\s\S]*?)\n---/);
  if (!match) {
    return { valid: false, issues: ['No frontmatter found'] };
  }
  
  const frontmatter = match[1];
  
  // Check 1: Description should be single-line (no >-)
  if (frontmatter.includes('description: >-') || frontmatter.includes('description: |-')) {
    issues.push('Description uses multi-line format (should be single-line)');
  }
  
  // Check 2: Claude tools should be comma-separated string
  if (platform === 'claude') {
    // Look for tools: with array brackets
    if (/tools:\s*\n\s*-/.test(frontmatter)) {
      issues.push('Claude tools use array format (should be comma-separated string)');
    }
    // Check for metadata fields
    if (frontmatter.includes('_platform:') || frontmatter.includes('_generated:')) {
      issues.push('Claude has metadata fields at root (should have none)');
    }
    if (frontmatter.includes('metadata:')) {
      issues.push('Claude has metadata object (should have none)');
    }
  }
  
  // Check 3: Copilot tools should be single-line array
  if (platform === 'copilot') {
    // Look for multi-line array
    if (/tools:\s*\n\s*-/.test(frontmatter)) {
      issues.push('Copilot tools use multi-line array (should be single-line array)');
    }
    // Check for metadata structure
    if (frontmatter.includes('_platform:') && !frontmatter.includes('metadata:')) {
      issues.push('Copilot has _platform at root (should be under metadata object)');
    }
  }
  
  return {
    valid: issues.length === 0,
    issues: issues
  };
}
```

2. **Update report generation** to include format compliance section:

```javascript
// After platform-specific generation results
report += '\n\n## Format Compliance\n\n';
report += '### Claude Agents\n\n';
report += '| Agent | Description | Tools | Metadata | Status |\n';
report += '|-------|-------------|-------|----------|--------|\n';

const claudeFiles = fs.readdirSync(path.join(OUTPUT_DIR, 'claude'));
for (const file of claudeFiles.filter(f => f.endsWith('.md'))) {
  const content = fs.readFileSync(path.join(OUTPUT_DIR, 'claude', file), 'utf8');
  const validation = validateFormat(content, 'claude');
  
  const agentName = file.replace('.md', '');
  const descOk = !validation.issues.some(i => i.includes('Description'));
  const toolsOk = !validation.issues.some(i => i.includes('tools'));
  const metadataOk = !validation.issues.some(i => i.includes('metadata'));
  const status = validation.valid ? '✅ Pass' : '❌ Fail';
  
  report += `| ${agentName} | ${descOk ? '✅' : '❌'} | ${toolsOk ? '✅' : '❌'} | ${metadataOk ? '✅' : '❌'} | ${status} |\n`;
}

report += '\n### Copilot Agents\n\n';
report += '| Agent | Description | Tools | Metadata | Status |\n';
report += '|-------|-------------|-------|----------|--------|\n';

const copilotFiles = fs.readdirSync(path.join(OUTPUT_DIR, 'copilot'));
for (const file of copilotFiles.filter(f => f.endsWith('.md'))) {
  const content = fs.readFileSync(path.join(OUTPUT_DIR, 'copilot', file), 'utf8');
  const validation = validateFormat(content, 'copilot');
  
  const agentName = file.replace('.md', '');
  const descOk = !validation.issues.some(i => i.includes('Description'));
  const toolsOk = !validation.issues.some(i => i.includes('tools'));
  const metadataOk = !validation.issues.some(i => i.includes('metadata'));
  const status = validation.valid ? '✅ Pass' : '❌ Fail';
  
  report += `| ${agentName} | ${descOk ? '✅' : '❌'} | ${toolsOk ? '✅' : '❌'} | ${metadataOk ? '✅' : '❌'} | ${status} |\n`;
}
```

**Why this approach:**
- Validates actual generated output (not just generation success)
- Checks all 6 critical format issues
- Provides detailed per-agent compliance report
- Easy to see which agents still have issues

**Do NOT:**
- Parse YAML with library (regex checks are sufficient for validation)
- Skip validation for failed generations (report should note they're missing)
  </action>
  <verify>
Run the validation report:
```bash
cd bin/lib/template-system
node generate-validation-report.js
cat test-output/VALIDATION-REPORT.md
```

Check for "Format Compliance" section with tables showing:
- Description column (should be all ✅)
- Tools column (should be all ✅)
- Metadata column (should be all ✅)
- Status column (should be all ✅ Pass)

Verify specific format issues are caught:
```bash
# If any ❌ appear, grep to see which checks failed
grep "❌" test-output/VALIDATION-REPORT.md
```
  </verify>
  <done>
- generate-validation-report.js has validateFormat() function
- Validation report includes "Format Compliance" section
- Report shows per-agent format checks (description, tools, metadata)
- All generated agents show ✅ Pass in format compliance
- Report documents any agents that failed generation (too large for Copilot)
  </done>
</task>

<task type="auto">
  <name>Task 3: Generate and verify complete validation report</name>
  <files>test-output/VALIDATION-REPORT.md</files>
  <action>
Execute the complete generation and validation pipeline:

1. **Clean and regenerate:**
```bash
cd bin/lib/template-system
rm -rf test-output/*
mkdir -p test-output/claude test-output/copilot
node generate-samples.js
node generate-validation-report.js
```

2. **Review validation report:**
```bash
cat test-output/VALIDATION-REPORT.md
```

3. **Verify expected outcomes:**
- Claude: 11/11 agents generated
- Copilot: 9/11 agents generated (gsd-planner, gsd-debugger too large)
- Format compliance: All generated agents pass all format checks
- Report includes size information
- Report includes format compliance tables

4. **Spot-check actual files:**
```bash
# Check Claude format
head -20 test-output/claude/gsd-planner.md
# Should show:
# - description: "text here" (single-line)
# - tools: Bash, Read, Edit, ... (comma-separated)
# - NO _platform, _generated, or metadata fields

# Check Copilot format
head -20 test-output/copilot/gsd-verifier.md
# Should show:
# - description: "text here" (single-line)
# - tools: ['bash', 'read', ...] (single-line array)
# - metadata: object with _platform and _generated nested
```

**Expected console output from generate-samples.js:**
```
=== Generating claude agents ===
✓ gsd-codebase-mapper (XXXX chars)
✓ gsd-debugger (XXXX chars)
... (all 11 agents)
claude: 11 success, 0 failed

=== Generating copilot agents ===
✓ gsd-codebase-mapper (XXXX chars)
✗ gsd-debugger - Prompt length exceeds platform limit
... (9 more agents)
copilot: 9 success, 2 failed
```

**Do NOT:**
- Consider generation complete if any format compliance issues remain
- Skip verification of actual file contents
  </action>
  <verify>
Final verification checklist:
```bash
# Count generated files
echo "Claude agents: $(ls test-output/claude/*.md 2>/dev/null | wc -l)"  # Should be 11
echo "Copilot agents: $(ls test-output/copilot/*.md 2>/dev/null | wc -l)"  # Should be 9

# Check validation report exists and has format section
grep -q "Format Compliance" test-output/VALIDATION-REPORT.md && echo "✓ Format section exists"

# Count format compliance passes
echo "Claude format passes: $(grep -c "✅ Pass" test-output/VALIDATION-REPORT.md | head -1)"
echo "Copilot format passes: $(grep -c "✅ Pass" test-output/VALIDATION-REPORT.md | tail -1)"

# Verify no multi-line description in any generated file
! grep -r "description: >-" test-output/ && echo "✓ No multi-line descriptions"

# Verify Claude has no metadata
! grep -r "^_platform:" test-output/claude/ && echo "✓ Claude has no root metadata"

# Verify Copilot has nested metadata
grep -r "^metadata:" test-output/copilot/ | wc -l  # Should equal number of copilot files
```

All checks should pass (no failures).
  </verify>
  <done>
- test-output/claude/ contains 11 agent files (all agents)
- test-output/copilot/ contains 9 agent files (excludes gsd-planner, gsd-debugger)
- test-output/VALIDATION-REPORT.md exists and is complete
- Report shows 11/11 Claude agents with format compliance ✅ Pass
- Report shows 9/9 Copilot agents with format compliance ✅ Pass
- Report documents 2 Copilot agents too large (gsd-planner, gsd-debugger)
- No generated agent has multi-line description format
- Claude agents have no metadata fields
- Copilot agents have nested metadata objects
  </done>
</task>

</tasks>

<verification>
Final end-to-end verification:

```bash
cd bin/lib/template-system

# 1. Regenerate everything
rm -rf test-output/*
node generate-samples.js
node generate-validation-report.js

# 2. Review complete report
cat test-output/VALIDATION-REPORT.md

# 3. Spot-check formats
echo "=== Claude Sample ==="
head -20 test-output/claude/gsd-executor.md

echo "=== Copilot Sample ==="
head -20 test-output/copilot/gsd-executor.md

# 4. Verify counts
echo "Total agents generated: $(($(ls test-output/claude/*.md | wc -l) + $(ls test-output/copilot/*.md | wc -l)))"
```

Success criteria:
- [ ] 11 Claude agents generated
- [ ] 9 Copilot agents generated
- [ ] All agents pass format compliance
- [ ] Validation report is comprehensive
- [ ] No format issues remain
</verification>

<success_criteria>
1. All 11 agents generated successfully for Claude
2. 9 agents generated for Copilot (2 documented as too large)
3. VALIDATION-REPORT.md shows 100% format compliance for all generated agents
4. No multi-line description format in any generated agent
5. Claude agents have correct tools format (comma-separated string)
6. Copilot agents have correct tools format (single-line array)
7. Claude agents have NO metadata fields
8. Copilot agents have nested metadata objects
9. Report documents size limits and which agents exceed them
</success_criteria>

<output>
After completion, create `.planning/phases/03-spec-migration-template-generation/03-06-SUMMARY.md`
</output>
