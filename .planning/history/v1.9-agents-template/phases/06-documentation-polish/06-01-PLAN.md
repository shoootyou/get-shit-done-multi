---
phase: 06-documentation-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ARCHITECTURE.md
  - CONTRIBUTING.md
  - docs/TROUBLESHOOTING.md
autonomous: true

must_haves:
  goal: "Technical documentation enables maintainers to understand design decisions and contributors to extend the system"
  
  observable_truths:
    - "Maintainer reads ARCHITECTURE.md and understands why template-based generation was chosen over static files"
    - "Maintainer reads ARCHITECTURE.md and understands the platform abstraction layer design"
    - "Contributor reads CONTRIBUTING.md and can add a new agent without help"
    - "Contributor reads CONTRIBUTING.md and can run the test suite to validate changes"
    - "Documentation references actual code structure in lib-ghcc/templates/"
  
  required_artifacts:
    - "ARCHITECTURE.md exists at project root"
    - "CONTRIBUTING.md exists at project root"
    - "ARCHITECTURE.md documents template system (spec-parser, context-builder, engine, generator)"
    - "ARCHITECTURE.md documents platform abstraction (tool-mapper, field-transformer, validators)"
    - "ARCHITECTURE.md includes design decisions from STATE.md"
    - "CONTRIBUTING.md documents how to add new agents to specs/agents/"
    - "CONTRIBUTING.md documents testing workflow (npm test, test:generation, test:installation, test:invocation)"
  
  required_wiring:
    - "ARCHITECTURE.md references lib-ghcc/templates/ structure"
    - "ARCHITECTURE.md references bin/lib/template-system/ modules"
    - "CONTRIBUTING.md references npm test scripts"
    - "CONTRIBUTING.md references specs/agents/ directory"
  
  key_links:
    - "ARCHITECTURE.md → lib-ghcc/templates/generator.js (generation flow)"
    - "ARCHITECTURE.md → bin/lib/template-system/tool-mapper.js (tool mapping)"
    - "CONTRIBUTING.md → scripts/test-cross-platform.js (test orchestration)"
    - "CONTRIBUTING.md → specs/agents/gsd-verifier.md (example spec)"
---

# Phase 6 Plan 1: Technical Documentation

**Create comprehensive technical documentation for maintainers and contributors**

## Objective

Create ARCHITECTURE.md documenting the template system design and CONTRIBUTING.md enabling contributors to extend the system with confidence.

## Context

**What exists:**
- Template system in lib-ghcc/templates/ (generator, registry, validator, types)
- Platform abstraction in bin/lib/template-system/ (tool-mapper, field-transformer, validators)
- 13 agent specs in specs/agents/ (spec-as-template format)
- Test infrastructure (208 tests, E2E orchestration)
- Design decisions accumulated in STATE.md (169 decisions from 5 phases)

**What's needed:**
- ARCHITECTURE.md explaining WHY the system works this way
- CONTRIBUTING.md explaining HOW to extend it

**Goal:**
New maintainer can understand the system. New contributor can add an agent.

## Tasks

<task name="create-architecture-doc" type="auto">
  <files>ARCHITECTURE.md</files>
  <action>
Create ARCHITECTURE.md at project root documenting the multi-platform template system.

Structure:
1. **Overview** - Why template-based generation (single source, platform optimization, zero drift)
2. **Template System Architecture**
   - Spec-as-template format (Mustache variables, YAML frontmatter + markdown body)
   - Generation pipeline: parse → render → transform → validate → write
   - Module breakdown:
     - lib-ghcc/templates/generator.js (orchestrates generation)
     - lib-ghcc/templates/validator.js (template validation)
     - lib-ghcc/templates/registry.js (spec tracking)
     - lib-ghcc/templates/types.js (type definitions)
3. **Platform Abstraction Layer**
   - Tool mapping (canonical names → platform-specific)
   - Field transformation (metadata, tools format, platform fields)
   - Validation (platform-specific rules)
   - Module breakdown:
     - bin/lib/template-system/tool-mapper.js (bidirectional lookup, PRIMARY aliases)
     - bin/lib/template-system/field-transformer.js (platform capability flags)
     - bin/lib/template-system/validators.js (platform validators)
4. **Design Decisions** - Pull key decisions from STATE.md:
   - Why gray-matter + Mustache (battle-tested, zero dependencies)
   - Why spec-as-template (single source of truth)
   - Why install-time generation (no runtime overhead)
   - Why bidirectional tool mapper (accepts all variants)
   - Why PRIMARY aliases for Copilot (official spec compliance)
5. **Platform Support Matrix** - Structured comparison table:
   
   | Feature | Claude | Copilot |
   |---------|--------|---------|
   | Tools Format | String ("Bash, Read, Edit") | Array (["execute", "edit", "search"]) |
   | Tool Naming | Uppercase (Bash, Grep, Task) | PRIMARY aliases (execute, search, agent) |
   | Metadata Structure | No metadata field | Nested under metadata object |
   | Size Limits | No hard limit | 30K character limit |
   | Conditionals | {{#isClaude}}...{{/isClaude}} | {{#isCopilot}}...{{/isCopilot}} |
   | MCP Support | Yes (via tools) | Yes (via tools) |
   | Model Selection | Via model parameter | Via model parameter |
   
   Include examples showing actual rendered output for both platforms.
6. **Generated Output**
   - Claude: string tools, no metadata, uppercase tool names
   - Copilot: array tools, nested metadata, PRIMARY aliases (execute, edit, search, agent)
   - Size considerations (Copilot 30K limit, agent splitting pattern)
6. **File Structure**
   - specs/agents/ (template specs)
   - agents/ (generated Claude agents)
   - .github/copilot/agents/ (generated Copilot agents)
   - lib-ghcc/templates/ (template system)
   - bin/lib/template-system/ (platform abstraction)

Include code examples from actual modules showing template rendering and tool mapping.

Reference docs/TESTING-CROSS-PLATFORM.md for testing architecture.
Reference docs/AGENT-SPLIT-PATTERN.md for size optimization pattern.
  </action>
  <verify>
    <command>test -f ARCHITECTURE.md && wc -l ARCHITECTURE.md</command>
    <expected>ARCHITECTURE.md exists with substantial content (200+ lines)</expected>
  </verify>
  <done>ARCHITECTURE.md created documenting template system, platform abstraction, and design decisions</done>
</task>

<task name="create-contributing-doc" type="auto">
  <files>CONTRIBUTING.md</files>
  <action>
Create CONTRIBUTING.md at project root documenting how to contribute.

Structure:
1. **Getting Started**
   - Clone repo, install dependencies
   - Run tests: `npm test` (all), `npm run test:generation` (generation only), etc.
   - Test structure: generation → installation → invocation
2. **Adding a New Agent**
   - Step 1: Create spec in specs/agents/new-agent.md
   - Step 2: Use YAML frontmatter with Mustache conditionals
   - Step 3: Test generation: `npm run test:generation`
   - Step 4: Test installation: `npm run test:installation`
   - Step 5: Manual validation with actual CLI
   - Example: Walk through gsd-verifier.md as template
3. **Modifying Existing Agents**
   - Edit spec in specs/agents/
   - Regenerate: Run install.js or generation tests
   - Validate: Test suite catches format issues
4. **Platform Conditionals**
   - Use {{#isClaude}}...{{/isClaude}} for Claude-specific sections
   - Use {{#isCopilot}}...{{/isCopilot}} for Copilot-specific sections
   - Tool references: {{toolBash}} (renders "Bash" for Claude, "execute" for Copilot)
   - Example from actual spec
5. **Testing Workflow**
   - Unit tests: Individual module tests
   - Integration tests: Full generation pipeline
   - Installation tests: File placement, format validation
   - Invocation tests: Actual CLI execution (requires CLIs installed)
   - E2E orchestration: scripts/test-cross-platform.js
6. **Code Style**
   - CommonJS modules (require/module.exports)
   - No build step (Node.js native)
   - Follow existing patterns in lib-ghcc/
   - Use gray-matter for frontmatter parsing
7. **Pull Request Guidelines**
   - Run full test suite before PR
   - Update documentation if adding features
   - Atomic commits with conventional commit messages
   - Reference issue if fixing bug

Include practical examples and command outputs.
  </action>
  <verify>
    <command>test -f CONTRIBUTING.md && wc -l CONTRIBUTING.md</command>
    <expected>CONTRIBUTING.md exists with substantial content (150+ lines)</expected>
  </verify>
  <done>CONTRIBUTING.md created enabling contributors to add agents and run tests</done>
</task>

<task name="create-troubleshooting-guide" type="auto">
  <files>docs/TROUBLESHOOTING.md</files>
  <action>
Create docs/TROUBLESHOOTING.md documenting common errors and solutions.

Structure:
1. **Installation Errors**
   - npm install failures
     - Symptom: "Cannot find module" errors
     - Cause: Incomplete installation
     - Solution: `rm -rf node_modules && npm install`
   - Permission errors
     - Symptom: EACCES errors during global install
     - Cause: npm permission issues
     - Solution: Use npx or fix npm permissions
   - Platform detection failures
     - Symptom: "Could not detect platform" warning
     - Cause: CLI not in expected location
     - Solution: Install CLI first, or use --local flag

2. **Validation Failures**
   - Tool name validation errors
     - Symptom: "Unknown tool name: X"
     - Cause: Tool name not in canonical set
     - Solution: Check tool-mapper.js CANONICAL_TOOLS list
   - Spec validation errors
     - Symptom: "Invalid frontmatter" during generation
     - Cause: YAML syntax error in spec
     - Solution: Validate YAML with yamllint or online validator
   - Size limit exceeded (Copilot)
     - Symptom: "Agent exceeds 30K limit"
     - Cause: Agent too large for Copilot
     - Solution: Use agent splitting pattern (see AGENT-SPLIT-PATTERN.md)

3. **Generation Errors**
   - Template rendering failures
     - Symptom: Mustache syntax errors
     - Cause: Unclosed {{#conditionals}} or invalid variables
     - Solution: Check template syntax, ensure matching {{/conditionals}}
   - File write errors
     - Symptom: "Cannot write to agents/"
     - Cause: Directory doesn't exist or no permissions
     - Solution: Check directory exists and is writable
   - Platform transformation errors
     - Symptom: Tools not transformed correctly
     - Cause: field-transformer.js mapping issue
     - Solution: Check TOOL_MAPPING in field-transformer.js

4. **Runtime Errors**
   - Agent not found errors
     - Symptom: "Agent X not found" when invoking
     - Cause: Agent not generated or in wrong location
     - Solution: Re-run install, check agents/ or .github/copilot/agents/
   - Tool invocation failures
     - Symptom: "Tool Y failed to execute"
     - Cause: Tool not available in CLI
     - Solution: Check CLI version, update if needed
   - Checkpoint parsing errors
     - Symptom: Agent stops at unexpected point
     - Cause: Checkpoint markup incorrect
     - Solution: Check checkpoint structure in spec

5. **Platform Detection Issues**
   - Claude not detected
     - Symptom: Installation skips Claude agent generation
     - Cause: Claude CLI not installed or not in PATH
     - Solution: Install Claude CLI or use --local flag
   - Copilot not detected
     - Symptom: Installation skips Copilot agent generation with --copilot flag
     - Cause: GitHub Copilot CLI not installed
     - Solution: Install gh copilot extension

6. **Agent Invocation Problems**
   - Agent doesn't respond
     - Symptom: No output when calling agent
     - Cause: Agent not properly registered
     - Solution: Restart CLI or check agent registration
   - Wrong platform agent invoked
     - Symptom: Getting Claude output on Copilot CLI
     - Cause: Generated wrong platform agents
     - Solution: Re-run install with correct flag (--copilot)
   - Model selection not working
     - Symptom: Agent uses wrong model
     - Cause: Model parameter not supported by CLI
     - Solution: Check CLI version for model support

7. **Getting Help**
   - Check documentation: ARCHITECTURE.md, CONTRIBUTING.md
   - Run tests: `npm test` to validate installation
   - Enable debug mode: Set DEBUG=gsd:* environment variable
   - Report issues: GitHub Issues with error messages and logs
   - Community: See GitHub Discussions for common questions

Include concrete error messages, causes, and solutions throughout.
Provide copy-pasteable commands for quick fixes.
Reference relevant documentation for deeper understanding.
  </action>
  <verify>
    <command>test -f docs/TROUBLESHOOTING.md && grep -q "Installation Errors" docs/TROUBLESHOOTING.md && grep -q "Runtime Errors" docs/TROUBLESHOOTING.md</command>
    <expected>TROUBLESHOOTING.md exists with error categories</expected>
  </verify>
  <done>TROUBLESHOOTING.md created documenting common errors and solutions</done>
</task>

## Verification

**Format validation:**
```bash
# All files exist
test -f ARCHITECTURE.md && test -f CONTRIBUTING.md && test -f docs/TROUBLESHOOTING.md && echo "✓ Files created"

# Reasonable content length
[ $(wc -l < ARCHITECTURE.md) -gt 200 ] && echo "✓ ARCHITECTURE.md has substantial content"
[ $(wc -l < CONTRIBUTING.md) -gt 150 ] && echo "✓ CONTRIBUTING.md has substantial content"
[ $(wc -l < docs/TROUBLESHOOTING.md) -gt 100 ] && echo "✓ TROUBLESHOOTING.md has substantial content"
```

**Content validation (manual):**
- [ ] ARCHITECTURE.md explains template system modules
- [ ] ARCHITECTURE.md explains platform abstraction layer
- [ ] ARCHITECTURE.md includes platform comparison table
- [ ] ARCHITECTURE.md includes key design decisions
- [ ] CONTRIBUTING.md shows how to add new agent
- [ ] CONTRIBUTING.md documents test workflow
- [ ] TROUBLESHOOTING.md covers common error categories
- [ ] All documents reference actual code structure

## Success Criteria

1. ✅ ARCHITECTURE.md exists at project root
2. ✅ ARCHITECTURE.md documents template system (generator, validator, registry)
3. ✅ ARCHITECTURE.md documents platform abstraction (tool-mapper, field-transformer, validators)
4. ✅ ARCHITECTURE.md includes structured platform comparison table
5. ✅ ARCHITECTURE.md includes design decisions from phases 1-5
6. ✅ CONTRIBUTING.md exists at project root
7. ✅ CONTRIBUTING.md documents how to add new agents
8. ✅ CONTRIBUTING.md documents testing workflow (npm scripts)
9. ✅ docs/TROUBLESHOOTING.md exists with error categories and solutions
10. ✅ All documents reference actual code structure

## Output

- `ARCHITECTURE.md` - Technical design documentation with platform comparison table
- `CONTRIBUTING.md` - Contributor guide
- `docs/TROUBLESHOOTING.md` - Common errors and solutions guide
